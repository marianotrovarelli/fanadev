{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"react\"","webpack:///external \"@grafana/ui\"","webpack:///external \"@emotion/css\"","webpack:///external \"@grafana/runtime\"","webpack:///external \"lodash\"","webpack:///external \"@grafana/data\"","webpack:///../node_modules/semver/semver.js","webpack:///../node_modules/react-use/node_modules/tslib/tslib.es6.js","webpack:///../node_modules/debounce-promise/dist/index.js","webpack:///../node_modules/process/browser.js","webpack:///../node_modules/tslib/tslib.es6.js","webpack:///./editor/expressions.ts","webpack:///./components/ConfigEditor/ConfigHelp.tsx","webpack:///./types.ts","webpack:///./test/selectors.ts","webpack:///./components/ConfigEditor/ConnectionConfig.tsx","webpack:///./components/ConfigEditor/DatabaseConfig.tsx","webpack:///./components/ConfigEditor/QueryConfig.tsx","webpack:///./components/ConfigEditor/refreshSchema.ts","webpack:///./components/ConfigEditor/TrackingConfig.tsx","webpack:///./components/ConfigEditor/index.tsx","webpack:///./editor/types.ts","webpack:///./common/responseHelpers.ts","webpack:///./editor/guards.ts","webpack:///./KustoExpressionParser.ts","webpack:///./schema/mapper.ts","webpack:///./schema/AdxSchemaMapper.ts","webpack:///./schema/cache.ts","webpack:///./migrations/annotation.ts","webpack:///./query_builder.ts","webpack:///./response_parser.ts","webpack:///./datasource.ts","webpack:///./components/SchemaMessages.tsx","webpack:///./migrations/expression.ts","webpack:///./migrations/query.ts","webpack:///../node_modules/react-use/esm/useAsyncFn.js","webpack:///../node_modules/react-use/esm/useMountedState.js","webpack:///../node_modules/react-use/esm/useAsync.js","webpack:///./editor/components/QueryEditorSection.tsx","webpack:///./components/QueryEditorToolbar.tsx","webpack:///./components/QueryEditorResultFormat.tsx","webpack:///./monaco/kusto_code_editor.ts","webpack:///./monaco/KustoMonacoEditor.tsx","webpack:///./components/Suggestions.ts","webpack:///./components/RawQueryEditor.tsx","webpack:///./editor/components/field/QueryEditorField.tsx","webpack:///./schema/AdxSchemaResolver.ts","webpack:///./editor/components/field/QueryEditorFieldSection.tsx","webpack:///./editor/builders/QueryEditorFieldBuilder.ts","webpack:///./editor/components/QueryEditorRepeater.tsx","webpack:///../node_modules/react-use/esm/useEffectOnce.js","webpack:///./editor/components/operators/parser.ts","webpack:///./editor/components/operators/QueryEditorBoolOperator.tsx","webpack:///./editor/components/operators/QueryEditorMultiOperator.tsx","webpack:///./editor/components/operators/QueryEditorNumberOperator.tsx","webpack:///./editor/components/operators/QueryEditorSingleOperator.tsx","webpack:///./editor/components/operators/QueryEditorStringOperator.tsx","webpack:///./editor/components/operators/QueryEditorOperator.tsx","webpack:///./editor/components/filter/QueryEditorFieldAndOperator.tsx","webpack:///./editor/components/filter/QueryEditorFilterSection.tsx","webpack:///./editor/builders/QueryEditorOperatorBuilder.ts","webpack:///./editor/builders/QueryEditorFilterBuilder.ts","webpack:///./editor/components/field/QueryEditorFunctionParameterSection.tsx","webpack:///./editor/components/reduce/QueryEditorReduce.tsx","webpack:///./editor/components/reduce/QueryEditorReduceSection.tsx","webpack:///./editor/builders/QueryEditorFunctionBuilder.tsx","webpack:///./editor/builders/QueryEditorReduceBuilder.ts","webpack:///./editor/components/groupBy/QueryEditorGroupBy.tsx","webpack:///./editor/components/groupBy/QueryEditorGroupBySection.tsx","webpack:///./editor/builders/QueryEditorIntervalBuilder.ts","webpack:///./editor/builders/QueryEditorGroupByBuilder.ts","webpack:///./components/VisualQueryEditorSections.tsx","webpack:///./editor/index.ts","webpack:///./components/VisualQueryEditor.tsx","webpack:///./components/QueryEditor.tsx","webpack:///./module.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__WEBPACK_EXTERNAL_MODULE__0__","__WEBPACK_EXTERNAL_MODULE__1__","__WEBPACK_EXTERNAL_MODULE__2__","__WEBPACK_EXTERNAL_MODULE__3__","__WEBPACK_EXTERNAL_MODULE__4__","__WEBPACK_EXTERNAL_MODULE__5__","debug","process","env","NODE_DEBUG","test","args","Array","slice","arguments","unshift","SEMVER_SPEC_VERSION","MAX_SAFE_INTEGER","Number","re","src","tokens","R","tok","NUMERICIDENTIFIER","NUMERICIDENTIFIERLOOSE","NONNUMERICIDENTIFIER","MAINVERSION","MAINVERSIONLOOSE","PRERELEASEIDENTIFIER","PRERELEASEIDENTIFIERLOOSE","PRERELEASE","PRERELEASELOOSE","BUILDIDENTIFIER","BUILD","FULLPLAIN","FULL","LOOSEPLAIN","LOOSE","GTLT","XRANGEIDENTIFIERLOOSE","XRANGEIDENTIFIER","XRANGEPLAIN","XRANGEPLAINLOOSE","XRANGE","XRANGELOOSE","COERCE","COERCERTL","RegExp","LONETILDE","TILDETRIM","TILDE","TILDELOOSE","LONECARET","CARETTRIM","CARET","CARETLOOSE","COMPARATORLOOSE","COMPARATOR","COMPARATORTRIM","HYPHENRANGE","HYPHENRANGELOOSE","STAR","parse","version","options","loose","includePrerelease","SemVer","length","er","TypeError","this","trim","match","raw","major","minor","patch","prerelease","split","map","id","num","build","format","valid","v","clean","replace","join","toString","compare","other","compareMain","comparePre","compareIdentifiers","a","b","undefined","compareBuild","inc","release","identifier","push","isNaN","Error","diff","version1","version2","eq","v1","v2","prefix","defaultResult","numeric","anum","bnum","gt","lt","neq","gte","lte","cmp","op","Comparator","comp","semver","ANY","operator","rcompareIdentifiers","compareLoose","versionA","versionB","rcompare","sort","list","rsort","Range","range","set","parseRange","filter","isSatisfiable","comparators","result","remainingComparators","testComparator","pop","every","otherComparator","intersects","isX","toLowerCase","hyphenReplace","$0","from","fM","fm","fp","fpr","fb","to","tM","tm","tp","tpr","tb","testSet","allowed","satisfies","outside","hilo","gtfn","ltefn","ltfn","ecomp","high","low","forEach","comparator","rangeTmp","sameDirectionIncreasing","sameDirectionDecreasing","sameSemVer","differentDirectionsInclusive","oppositeDirectionsLessThan","oppositeDirectionsGreaterThan","comps","hr","compRe","_","M","pr","ret","replaceCaret","replaceCarets","replaceTilde","replaceTildes","gtlt","xM","xm","xp","anyX","replaceXRange","replaceXRanges","replaceStars","parseComparator","some","thisComparators","rangeComparators","thisComparator","rangeComparator","toComparators","maxSatisfying","versions","max","maxSV","rangeObj","minSatisfying","min","minSV","minVersion","minver","compver","validRange","ltr","gtr","parsed","r1","r2","coerce","String","rtl","next","exec","index","lastIndex","__assign","assign","apply","getWait","wait","defer","deferred","promise","Promise","resolve","reject","fn","lastCallAt","timer","pendingArgs","currentWait","currentTime","Date","getTime","isCold","_len","_key","leading","accumulate","then","concat","clearTimeout","setTimeout","flush","argsIndex","results","thisDeferred","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","fun","e","currentQueue","queue","draining","queueIndex","cleanUpNextTick","drainQueue","timeout","len","run","marker","runClearTimeout","Item","array","noop","nextTick","title","browser","argv","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","__rest","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__awaiter","thisArg","_arguments","P","generator","fulfilled","step","rejected","done","QueryEditorExpressionType","className","target","rel","href","EditorMode","packageJson","SchemaMappingType","AzureCloudType","defaultQuery","query","querySource","Raw","expression","where","type","And","expressions","groupBy","reduce","pluginVersion","selectors","configEditor","azureCloud","input","tenantID","clusterURL","clientID","clientSecret","queryEditor","editKQL","button","codeEditorLegacy","container","textarea","codeEditor","database","tableFrom","runQuery","SecretFormField","azureClouds","AzurePublic","label","AzureUSGovernment","AzureChina","onOptionsChange","updateJsonData","handleClearClientSecret","jsonData","secureJsonData","secureJsonFields","onBehalfOf","featureToggles","adxOnBehalfOf","oauthPassThru","clientSecretTooltip","labelWidth","tooltip","required","htmlFor","inputId","find","onChange","change","isClearable","width","clusterUrl","placeholder","ev","tenantId","clientId","inputWidth","onReset","isConfigured","checked","formatMappingValue","mapping","Value","schema","onRefresh","mappings","schemaMappings","handleAddNewMapping","databases","defaultDatabase","useSchemaMapping","spacing","schemaMappingOptions","newMappings","handleMappingTargetChange","displayName","handleMappingNameChange","variant","size","icon","onClick","splice","handleRemoveMapping","dataConsistencyOptions","editorModeOptions","Visual","dataConsistency","defaultEditorMode","queryTimeout","dynamicCaching","transparent","cacheMaxAge","refreshSchema","datasource","getSchema","values","Databases","Name","Tables","table","Functions","func","InputParameters","MaterializedViews","view","materializedView","enableUserTracking","QueryEditorPropertyType","props","setSchema","schemaError","setSchemaError","getDatasource","updateSchema","keys","schemaData","data","fieldName","severity","message","firstStringFieldToMetricFindValue","frame","field","fields","f","string","text","Reduce","Property","Operator","GroupBy","isMultiOperator","isArray","Or","isArrayExpression","templateSrv","tableSchema","search","context","timeColumn","castIfDynamic","column","schemaName","parts","appendProperty","appendTimeFilter","appendWhere","timeshift","appendTimeshift","appendSummarize","appendOrderBy","detectTimeshift","isDynamic","noGroupBy","noReduce","exp","interval","expandParts","eParts","orParts","appendMvExpand","appendProjectAway","appendOperator","countAddedInReduce","reduceParts","groupByParts","columns","parameters","addExpanPartsdIfNeeded","funcParams","formatValue","fieldType","withPrefix","isTemplateVariable","Boolean","includes","arrayElemParts","arrayLength","res","arrayCols","formatProperty","getVariables","variable","groupByTimeColumn","DateTime","firstLevelColumn","col","CslType","toType","columnSchema","parseInt","current","timeshiftWith","kustoType","TimeSpan","validMapping","enabled","mappingsByDatabase","displayNameToMapping","nameToMapping","valueToMapping","databaseName","all","store","resolver","refresh","annotation","newQuery","rawMode","refId","resultFormat","interpolateKustoQuery","scopedVars","p1","p2","inputs","firstCommaIndex","substring","templateVar","singleQuote","getMultiContains","ResponseParser","Rows","row","schemaJson","JSON","instanceSettings","annotations","prepareAnnotation","schemaMapping","backendSrv","defaultOrFirstDatabase","url","schemaMapper","expressionParser","parseExpression","autoCompleteQuery","getSchemaMapper","hide","tableExpr","interpolateVariable","optionalOptions","getDatabases","getDefaultOrFirstDatabase","buildQuery","targets","toPromise","response","err","getResource","parseDatabases","path","refreshCache","parseSchemaResult","targetFunction","queryParts","functionSchemaParser","source","project","summarize","dynamicSchemaParser","interpolatedQuery","maxRetries","datasourceRequest","method","error","doRequest","multi","includeAll","val","escapeSpecial","sections","toQuery","autoQuery","toAutoCompleteQuery","kustQuery","toArray","sortStartsWithValuesFirst","frames","nameIndex","findIndex","typeIndex","json","columnSchemas","columnName","recordSchema","option","timeRange","arr","searchText","aLower","bLower","startsWith","styles","warning","theme","colors","formInputBorderInvalid","palette","yellow","looksLikeV2","migrated","migrateV2Expression","migrateV2Property","Function","Interval","isRawMode","useAsyncFn","deps","initialState","loading","mountedRef","lastCallId","isMounted","_a","state","_i","callId","prevState","useAsync","callback","children","dirty","editorMode","onToggleEditorMode","showConfirm","setShowConfirm","onToggleMode","selected","onChangeDatabase","onRunQuery","isOpen","body","confirmText","dismissText","onConfirm","onDismiss","formats","adxTimeFormat","onChangeFormat","onFormatChange","selectable","includeAdxTimeFormat","menuShouldPortal","selectResultFormat","includeAdxFormat","containerDiv","defaultTimeField","config","splitWithNewLineRegex","newLineRegex","startsWithKustoPipeRegex","kustoPipeRegexStrict","content","themeName","bootData","user","lightTheme","monaco","editor","defineTheme","base","inherit","rules","token","foreground","background","languages","kustoDefaults","setLanguageSettings","includeControlCommands","newlineAfterPipe","useIntellisenseV2","language","selectionHighlight","folding","lineNumbers","lineHeight","suggestFontSize","dragAndDrop","occurrencesHighlight","minimap","renderIndentGuides","wordWrap","layout","getModels","completionItemProvider","registerCompletionItemProvider","triggerCharacters","provideCompletionItems","getCompletionItems","signatureHelpProvider","registerSignatureHelpProvider","signatureHelpTriggerCharacters","provideSignatureHelp","getSignatureHelp","createContextKey","onDidChangeCursorSelection","event","getKustoWorker","workerAccessor","model","getModel","uri","worker","dbName","setSchemaFromShowSchema","listener","onDidChangeModelContent","dispose","keybinding","commandFunc","addCommand","getValue","srv","setValue","position","timeFilterDocs","textUntilPosition","getValueInRange","startLineNumber","startColumn","endLineNumber","lineNumber","endColumn","getLineContent","kind","CompletionItemKind","Keyword","insertText","documentation","activeParameter","activeSignature","signatures","reason","CursorChangeReason","RecoverFromMarkers","getCharAt","selection","positionLineNumber","positionColumn","triggerSuggestions","suggestController","getContribution","convertedController","toSuggestionController","_model","cancel","trigger","getLineCount","line","getStyles","monacoRef","createRef","window","initMonaco","System","pluginBaseUrl","kustoCodeEditor","setState","KeyMod","Shift","KeyCode","Enter","newValue","onExecute","setOnDidChangeModelContent","onresize","resize","disposeMonaco","tabIndex","ref","Component","funcPosition","delta","getWordUntilPosition","word","showLastQuery","setShowLastQuery","showHelp","setShowHelp","setWorker","variables","onRawQueryChange","kql","lastQueryError","lastQuery","timeNotASC","baseUrl","appSubUrl","meta","db","functions","$__timeFilter","Body","FunctionKind","Type","CslDefaultValue","OutputColumns","DocString","$__from","$__to","$__timeInterval","getFunctions","buildInfo","onBlur","showMiniMap","showLineNumbers","height","onEditorDidMount","kusto","toolbar","definitionToProperty","definition","propsValue","allowCustom","templateVariableOptions","propsOnChange","prevValue","setPrevValue","loadOptions","onCloseMenu","defaultOptions","menuPlacement","allowCustomValue","backspaceRemovesValue","currentValue","textSearchingFor","allOptions","exactMatchOptions","anyMatchOptions","sortedOptions","uniqueOptions","Set","addition","tableName","cacheKey","createCacheKey","mapper","getMappingByValue","findSchema","getFunctionSchema","OrderedColumns","dynamicColumns","getDynamicSchema","schemaByColumn","schemaForDynamicColumn","getTablesForDatabase","getFunctionsForDatabase","getViewsForDatabase","tables","funcs","views","defaultValue","buildFieldExpression","remainingExpressions","idx","Fragment","onAdd","onRemove","effect","multipleValues","casted","isUndefined","isNumber","toNumber","comparable","toLower","onCreate","getSuggestions","txt","isLoading","onOpenMenu","onCreateOption","noOptionsMessage","operatorValue","onChangeInput","currentTarget","onBlurInput","parseToNumber","evt","definitionToOperator","booleanValues","operators","isSearchable","renderControl","forwardRef","invalid","otherProps","onChangeValue","propertyType","isBoolOperator","isSingleOperator","setOperators","updateOperators","supportTypes","showOperators","currentOperator","rowWithSpacing","QueyEditorOperatorBuilder","types","description","multiple","bool","buildOperatorExpression","filterProps","operatorProps","isFirst","rowStyles","FunctionParameter","setField","setReduce","setParameters","applyOnField","onChangeField","reducer","onChangeReduce","onChangeParameter","payload","reduceParameters","getParameters","params","param","appliedOnField","buildReduceExpression","childProps","rowStyle","buildProperty","intervals","setInterval","onChangeInterval","buildGroupByExpressions","KustoPropertyEditorSection","fieldSection","builder","KustoWhereEditorSection","filterSection","withOperators","withDescription","add","withMultipleRows","KustoValueColumnEditorSection","reduceSection","withFunctions","withLabel","isAppliedOnField","withParameter","KustoGroupByEditorSection","groupBySection","withIntervals","onChangeQuery","datasourceId","tableMapping","timeshiftOptions","getTableSchema","onAutoComplete","groupable","aggregable","onChangeTable","onWhereChange","onReduceChange","onGroupByChange","onChangeResultFormat","onChangeTimeshift","KustoTable","kustoTableProps","cols","rows","disabled","getTableOptions","schemaResolver","getColumnsForTable","series","executedQueryString","executedQuery","expanded","setConfigEditor","setQueryEditor","ds","executedQueryError","templateVariables","isNewQuery","getDefaultEditorMode","isRawDefaultEditorMode","Message"],"mappings":"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","file":"module.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 12);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","module.exports = __WEBPACK_EXTERNAL_MODULE__1__;","module.exports = __WEBPACK_EXTERNAL_MODULE__2__;","module.exports = __WEBPACK_EXTERNAL_MODULE__3__;","module.exports = __WEBPACK_EXTERNAL_MODULE__4__;","module.exports = __WEBPACK_EXTERNAL_MODULE__5__;","exports = module.exports = SemVer\n\nvar debug\n/* istanbul ignore next */\nif (typeof process === 'object' &&\n    process.env &&\n    process.env.NODE_DEBUG &&\n    /\\bsemver\\b/i.test(process.env.NODE_DEBUG)) {\n  debug = function () {\n    var args = Array.prototype.slice.call(arguments, 0)\n    args.unshift('SEMVER')\n    console.log.apply(console, args)\n  }\n} else {\n  debug = function () {}\n}\n\n// Note: this is the semver.org version of the spec that it implements\n// Not necessarily the package version of this code.\nexports.SEMVER_SPEC_VERSION = '2.0.0'\n\nvar MAX_LENGTH = 256\nvar MAX_SAFE_INTEGER = Number.MAX_SAFE_INTEGER ||\n  /* istanbul ignore next */ 9007199254740991\n\n// Max safe segment length for coercion.\nvar MAX_SAFE_COMPONENT_LENGTH = 16\n\n// The actual regexps go on exports.re\nvar re = exports.re = []\nvar src = exports.src = []\nvar t = exports.tokens = {}\nvar R = 0\n\nfunction tok (n) {\n  t[n] = R++\n}\n\n// The following Regular Expressions can be used for tokenizing,\n// validating, and parsing SemVer version strings.\n\n// ## Numeric Identifier\n// A single `0`, or a non-zero digit followed by zero or more digits.\n\ntok('NUMERICIDENTIFIER')\nsrc[t.NUMERICIDENTIFIER] = '0|[1-9]\\\\d*'\ntok('NUMERICIDENTIFIERLOOSE')\nsrc[t.NUMERICIDENTIFIERLOOSE] = '[0-9]+'\n\n// ## Non-numeric Identifier\n// Zero or more digits, followed by a letter or hyphen, and then zero or\n// more letters, digits, or hyphens.\n\ntok('NONNUMERICIDENTIFIER')\nsrc[t.NONNUMERICIDENTIFIER] = '\\\\d*[a-zA-Z-][a-zA-Z0-9-]*'\n\n// ## Main Version\n// Three dot-separated numeric identifiers.\n\ntok('MAINVERSION')\nsrc[t.MAINVERSION] = '(' + src[t.NUMERICIDENTIFIER] + ')\\\\.' +\n                   '(' + src[t.NUMERICIDENTIFIER] + ')\\\\.' +\n                   '(' + src[t.NUMERICIDENTIFIER] + ')'\n\ntok('MAINVERSIONLOOSE')\nsrc[t.MAINVERSIONLOOSE] = '(' + src[t.NUMERICIDENTIFIERLOOSE] + ')\\\\.' +\n                        '(' + src[t.NUMERICIDENTIFIERLOOSE] + ')\\\\.' +\n                        '(' + src[t.NUMERICIDENTIFIERLOOSE] + ')'\n\n// ## Pre-release Version Identifier\n// A numeric identifier, or a non-numeric identifier.\n\ntok('PRERELEASEIDENTIFIER')\nsrc[t.PRERELEASEIDENTIFIER] = '(?:' + src[t.NUMERICIDENTIFIER] +\n                            '|' + src[t.NONNUMERICIDENTIFIER] + ')'\n\ntok('PRERELEASEIDENTIFIERLOOSE')\nsrc[t.PRERELEASEIDENTIFIERLOOSE] = '(?:' + src[t.NUMERICIDENTIFIERLOOSE] +\n                                 '|' + src[t.NONNUMERICIDENTIFIER] + ')'\n\n// ## Pre-release Version\n// Hyphen, followed by one or more dot-separated pre-release version\n// identifiers.\n\ntok('PRERELEASE')\nsrc[t.PRERELEASE] = '(?:-(' + src[t.PRERELEASEIDENTIFIER] +\n                  '(?:\\\\.' + src[t.PRERELEASEIDENTIFIER] + ')*))'\n\ntok('PRERELEASELOOSE')\nsrc[t.PRERELEASELOOSE] = '(?:-?(' + src[t.PRERELEASEIDENTIFIERLOOSE] +\n                       '(?:\\\\.' + src[t.PRERELEASEIDENTIFIERLOOSE] + ')*))'\n\n// ## Build Metadata Identifier\n// Any combination of digits, letters, or hyphens.\n\ntok('BUILDIDENTIFIER')\nsrc[t.BUILDIDENTIFIER] = '[0-9A-Za-z-]+'\n\n// ## Build Metadata\n// Plus sign, followed by one or more period-separated build metadata\n// identifiers.\n\ntok('BUILD')\nsrc[t.BUILD] = '(?:\\\\+(' + src[t.BUILDIDENTIFIER] +\n             '(?:\\\\.' + src[t.BUILDIDENTIFIER] + ')*))'\n\n// ## Full Version String\n// A main version, followed optionally by a pre-release version and\n// build metadata.\n\n// Note that the only major, minor, patch, and pre-release sections of\n// the version string are capturing groups.  The build metadata is not a\n// capturing group, because it should not ever be used in version\n// comparison.\n\ntok('FULL')\ntok('FULLPLAIN')\nsrc[t.FULLPLAIN] = 'v?' + src[t.MAINVERSION] +\n                  src[t.PRERELEASE] + '?' +\n                  src[t.BUILD] + '?'\n\nsrc[t.FULL] = '^' + src[t.FULLPLAIN] + '$'\n\n// like full, but allows v1.2.3 and =1.2.3, which people do sometimes.\n// also, 1.0.0alpha1 (prerelease without the hyphen) which is pretty\n// common in the npm registry.\ntok('LOOSEPLAIN')\nsrc[t.LOOSEPLAIN] = '[v=\\\\s]*' + src[t.MAINVERSIONLOOSE] +\n                  src[t.PRERELEASELOOSE] + '?' +\n                  src[t.BUILD] + '?'\n\ntok('LOOSE')\nsrc[t.LOOSE] = '^' + src[t.LOOSEPLAIN] + '$'\n\ntok('GTLT')\nsrc[t.GTLT] = '((?:<|>)?=?)'\n\n// Something like \"2.*\" or \"1.2.x\".\n// Note that \"x.x\" is a valid xRange identifer, meaning \"any version\"\n// Only the first item is strictly required.\ntok('XRANGEIDENTIFIERLOOSE')\nsrc[t.XRANGEIDENTIFIERLOOSE] = src[t.NUMERICIDENTIFIERLOOSE] + '|x|X|\\\\*'\ntok('XRANGEIDENTIFIER')\nsrc[t.XRANGEIDENTIFIER] = src[t.NUMERICIDENTIFIER] + '|x|X|\\\\*'\n\ntok('XRANGEPLAIN')\nsrc[t.XRANGEPLAIN] = '[v=\\\\s]*(' + src[t.XRANGEIDENTIFIER] + ')' +\n                   '(?:\\\\.(' + src[t.XRANGEIDENTIFIER] + ')' +\n                   '(?:\\\\.(' + src[t.XRANGEIDENTIFIER] + ')' +\n                   '(?:' + src[t.PRERELEASE] + ')?' +\n                   src[t.BUILD] + '?' +\n                   ')?)?'\n\ntok('XRANGEPLAINLOOSE')\nsrc[t.XRANGEPLAINLOOSE] = '[v=\\\\s]*(' + src[t.XRANGEIDENTIFIERLOOSE] + ')' +\n                        '(?:\\\\.(' + src[t.XRANGEIDENTIFIERLOOSE] + ')' +\n                        '(?:\\\\.(' + src[t.XRANGEIDENTIFIERLOOSE] + ')' +\n                        '(?:' + src[t.PRERELEASELOOSE] + ')?' +\n                        src[t.BUILD] + '?' +\n                        ')?)?'\n\ntok('XRANGE')\nsrc[t.XRANGE] = '^' + src[t.GTLT] + '\\\\s*' + src[t.XRANGEPLAIN] + '$'\ntok('XRANGELOOSE')\nsrc[t.XRANGELOOSE] = '^' + src[t.GTLT] + '\\\\s*' + src[t.XRANGEPLAINLOOSE] + '$'\n\n// Coercion.\n// Extract anything that could conceivably be a part of a valid semver\ntok('COERCE')\nsrc[t.COERCE] = '(^|[^\\\\d])' +\n              '(\\\\d{1,' + MAX_SAFE_COMPONENT_LENGTH + '})' +\n              '(?:\\\\.(\\\\d{1,' + MAX_SAFE_COMPONENT_LENGTH + '}))?' +\n              '(?:\\\\.(\\\\d{1,' + MAX_SAFE_COMPONENT_LENGTH + '}))?' +\n              '(?:$|[^\\\\d])'\ntok('COERCERTL')\nre[t.COERCERTL] = new RegExp(src[t.COERCE], 'g')\n\n// Tilde ranges.\n// Meaning is \"reasonably at or greater than\"\ntok('LONETILDE')\nsrc[t.LONETILDE] = '(?:~>?)'\n\ntok('TILDETRIM')\nsrc[t.TILDETRIM] = '(\\\\s*)' + src[t.LONETILDE] + '\\\\s+'\nre[t.TILDETRIM] = new RegExp(src[t.TILDETRIM], 'g')\nvar tildeTrimReplace = '$1~'\n\ntok('TILDE')\nsrc[t.TILDE] = '^' + src[t.LONETILDE] + src[t.XRANGEPLAIN] + '$'\ntok('TILDELOOSE')\nsrc[t.TILDELOOSE] = '^' + src[t.LONETILDE] + src[t.XRANGEPLAINLOOSE] + '$'\n\n// Caret ranges.\n// Meaning is \"at least and backwards compatible with\"\ntok('LONECARET')\nsrc[t.LONECARET] = '(?:\\\\^)'\n\ntok('CARETTRIM')\nsrc[t.CARETTRIM] = '(\\\\s*)' + src[t.LONECARET] + '\\\\s+'\nre[t.CARETTRIM] = new RegExp(src[t.CARETTRIM], 'g')\nvar caretTrimReplace = '$1^'\n\ntok('CARET')\nsrc[t.CARET] = '^' + src[t.LONECARET] + src[t.XRANGEPLAIN] + '$'\ntok('CARETLOOSE')\nsrc[t.CARETLOOSE] = '^' + src[t.LONECARET] + src[t.XRANGEPLAINLOOSE] + '$'\n\n// A simple gt/lt/eq thing, or just \"\" to indicate \"any version\"\ntok('COMPARATORLOOSE')\nsrc[t.COMPARATORLOOSE] = '^' + src[t.GTLT] + '\\\\s*(' + src[t.LOOSEPLAIN] + ')$|^$'\ntok('COMPARATOR')\nsrc[t.COMPARATOR] = '^' + src[t.GTLT] + '\\\\s*(' + src[t.FULLPLAIN] + ')$|^$'\n\n// An expression to strip any whitespace between the gtlt and the thing\n// it modifies, so that `> 1.2.3` ==> `>1.2.3`\ntok('COMPARATORTRIM')\nsrc[t.COMPARATORTRIM] = '(\\\\s*)' + src[t.GTLT] +\n                      '\\\\s*(' + src[t.LOOSEPLAIN] + '|' + src[t.XRANGEPLAIN] + ')'\n\n// this one has to use the /g flag\nre[t.COMPARATORTRIM] = new RegExp(src[t.COMPARATORTRIM], 'g')\nvar comparatorTrimReplace = '$1$2$3'\n\n// Something like `1.2.3 - 1.2.4`\n// Note that these all use the loose form, because they'll be\n// checked against either the strict or loose comparator form\n// later.\ntok('HYPHENRANGE')\nsrc[t.HYPHENRANGE] = '^\\\\s*(' + src[t.XRANGEPLAIN] + ')' +\n                   '\\\\s+-\\\\s+' +\n                   '(' + src[t.XRANGEPLAIN] + ')' +\n                   '\\\\s*$'\n\ntok('HYPHENRANGELOOSE')\nsrc[t.HYPHENRANGELOOSE] = '^\\\\s*(' + src[t.XRANGEPLAINLOOSE] + ')' +\n                        '\\\\s+-\\\\s+' +\n                        '(' + src[t.XRANGEPLAINLOOSE] + ')' +\n                        '\\\\s*$'\n\n// Star ranges basically just allow anything at all.\ntok('STAR')\nsrc[t.STAR] = '(<|>)?=?\\\\s*\\\\*'\n\n// Compile to actual regexp objects.\n// All are flag-free, unless they were created above with a flag.\nfor (var i = 0; i < R; i++) {\n  debug(i, src[i])\n  if (!re[i]) {\n    re[i] = new RegExp(src[i])\n  }\n}\n\nexports.parse = parse\nfunction parse (version, options) {\n  if (!options || typeof options !== 'object') {\n    options = {\n      loose: !!options,\n      includePrerelease: false\n    }\n  }\n\n  if (version instanceof SemVer) {\n    return version\n  }\n\n  if (typeof version !== 'string') {\n    return null\n  }\n\n  if (version.length > MAX_LENGTH) {\n    return null\n  }\n\n  var r = options.loose ? re[t.LOOSE] : re[t.FULL]\n  if (!r.test(version)) {\n    return null\n  }\n\n  try {\n    return new SemVer(version, options)\n  } catch (er) {\n    return null\n  }\n}\n\nexports.valid = valid\nfunction valid (version, options) {\n  var v = parse(version, options)\n  return v ? v.version : null\n}\n\nexports.clean = clean\nfunction clean (version, options) {\n  var s = parse(version.trim().replace(/^[=v]+/, ''), options)\n  return s ? s.version : null\n}\n\nexports.SemVer = SemVer\n\nfunction SemVer (version, options) {\n  if (!options || typeof options !== 'object') {\n    options = {\n      loose: !!options,\n      includePrerelease: false\n    }\n  }\n  if (version instanceof SemVer) {\n    if (version.loose === options.loose) {\n      return version\n    } else {\n      version = version.version\n    }\n  } else if (typeof version !== 'string') {\n    throw new TypeError('Invalid Version: ' + version)\n  }\n\n  if (version.length > MAX_LENGTH) {\n    throw new TypeError('version is longer than ' + MAX_LENGTH + ' characters')\n  }\n\n  if (!(this instanceof SemVer)) {\n    return new SemVer(version, options)\n  }\n\n  debug('SemVer', version, options)\n  this.options = options\n  this.loose = !!options.loose\n\n  var m = version.trim().match(options.loose ? re[t.LOOSE] : re[t.FULL])\n\n  if (!m) {\n    throw new TypeError('Invalid Version: ' + version)\n  }\n\n  this.raw = version\n\n  // these are actually numbers\n  this.major = +m[1]\n  this.minor = +m[2]\n  this.patch = +m[3]\n\n  if (this.major > MAX_SAFE_INTEGER || this.major < 0) {\n    throw new TypeError('Invalid major version')\n  }\n\n  if (this.minor > MAX_SAFE_INTEGER || this.minor < 0) {\n    throw new TypeError('Invalid minor version')\n  }\n\n  if (this.patch > MAX_SAFE_INTEGER || this.patch < 0) {\n    throw new TypeError('Invalid patch version')\n  }\n\n  // numberify any prerelease numeric ids\n  if (!m[4]) {\n    this.prerelease = []\n  } else {\n    this.prerelease = m[4].split('.').map(function (id) {\n      if (/^[0-9]+$/.test(id)) {\n        var num = +id\n        if (num >= 0 && num < MAX_SAFE_INTEGER) {\n          return num\n        }\n      }\n      return id\n    })\n  }\n\n  this.build = m[5] ? m[5].split('.') : []\n  this.format()\n}\n\nSemVer.prototype.format = function () {\n  this.version = this.major + '.' + this.minor + '.' + this.patch\n  if (this.prerelease.length) {\n    this.version += '-' + this.prerelease.join('.')\n  }\n  return this.version\n}\n\nSemVer.prototype.toString = function () {\n  return this.version\n}\n\nSemVer.prototype.compare = function (other) {\n  debug('SemVer.compare', this.version, this.options, other)\n  if (!(other instanceof SemVer)) {\n    other = new SemVer(other, this.options)\n  }\n\n  return this.compareMain(other) || this.comparePre(other)\n}\n\nSemVer.prototype.compareMain = function (other) {\n  if (!(other instanceof SemVer)) {\n    other = new SemVer(other, this.options)\n  }\n\n  return compareIdentifiers(this.major, other.major) ||\n         compareIdentifiers(this.minor, other.minor) ||\n         compareIdentifiers(this.patch, other.patch)\n}\n\nSemVer.prototype.comparePre = function (other) {\n  if (!(other instanceof SemVer)) {\n    other = new SemVer(other, this.options)\n  }\n\n  // NOT having a prerelease is > having one\n  if (this.prerelease.length && !other.prerelease.length) {\n    return -1\n  } else if (!this.prerelease.length && other.prerelease.length) {\n    return 1\n  } else if (!this.prerelease.length && !other.prerelease.length) {\n    return 0\n  }\n\n  var i = 0\n  do {\n    var a = this.prerelease[i]\n    var b = other.prerelease[i]\n    debug('prerelease compare', i, a, b)\n    if (a === undefined && b === undefined) {\n      return 0\n    } else if (b === undefined) {\n      return 1\n    } else if (a === undefined) {\n      return -1\n    } else if (a === b) {\n      continue\n    } else {\n      return compareIdentifiers(a, b)\n    }\n  } while (++i)\n}\n\nSemVer.prototype.compareBuild = function (other) {\n  if (!(other instanceof SemVer)) {\n    other = new SemVer(other, this.options)\n  }\n\n  var i = 0\n  do {\n    var a = this.build[i]\n    var b = other.build[i]\n    debug('prerelease compare', i, a, b)\n    if (a === undefined && b === undefined) {\n      return 0\n    } else if (b === undefined) {\n      return 1\n    } else if (a === undefined) {\n      return -1\n    } else if (a === b) {\n      continue\n    } else {\n      return compareIdentifiers(a, b)\n    }\n  } while (++i)\n}\n\n// preminor will bump the version up to the next minor release, and immediately\n// down to pre-release. premajor and prepatch work the same way.\nSemVer.prototype.inc = function (release, identifier) {\n  switch (release) {\n    case 'premajor':\n      this.prerelease.length = 0\n      this.patch = 0\n      this.minor = 0\n      this.major++\n      this.inc('pre', identifier)\n      break\n    case 'preminor':\n      this.prerelease.length = 0\n      this.patch = 0\n      this.minor++\n      this.inc('pre', identifier)\n      break\n    case 'prepatch':\n      // If this is already a prerelease, it will bump to the next version\n      // drop any prereleases that might already exist, since they are not\n      // relevant at this point.\n      this.prerelease.length = 0\n      this.inc('patch', identifier)\n      this.inc('pre', identifier)\n      break\n    // If the input is a non-prerelease version, this acts the same as\n    // prepatch.\n    case 'prerelease':\n      if (this.prerelease.length === 0) {\n        this.inc('patch', identifier)\n      }\n      this.inc('pre', identifier)\n      break\n\n    case 'major':\n      // If this is a pre-major version, bump up to the same major version.\n      // Otherwise increment major.\n      // 1.0.0-5 bumps to 1.0.0\n      // 1.1.0 bumps to 2.0.0\n      if (this.minor !== 0 ||\n          this.patch !== 0 ||\n          this.prerelease.length === 0) {\n        this.major++\n      }\n      this.minor = 0\n      this.patch = 0\n      this.prerelease = []\n      break\n    case 'minor':\n      // If this is a pre-minor version, bump up to the same minor version.\n      // Otherwise increment minor.\n      // 1.2.0-5 bumps to 1.2.0\n      // 1.2.1 bumps to 1.3.0\n      if (this.patch !== 0 || this.prerelease.length === 0) {\n        this.minor++\n      }\n      this.patch = 0\n      this.prerelease = []\n      break\n    case 'patch':\n      // If this is not a pre-release version, it will increment the patch.\n      // If it is a pre-release it will bump up to the same patch version.\n      // 1.2.0-5 patches to 1.2.0\n      // 1.2.0 patches to 1.2.1\n      if (this.prerelease.length === 0) {\n        this.patch++\n      }\n      this.prerelease = []\n      break\n    // This probably shouldn't be used publicly.\n    // 1.0.0 \"pre\" would become 1.0.0-0 which is the wrong direction.\n    case 'pre':\n      if (this.prerelease.length === 0) {\n        this.prerelease = [0]\n      } else {\n        var i = this.prerelease.length\n        while (--i >= 0) {\n          if (typeof this.prerelease[i] === 'number') {\n            this.prerelease[i]++\n            i = -2\n          }\n        }\n        if (i === -1) {\n          // didn't increment anything\n          this.prerelease.push(0)\n        }\n      }\n      if (identifier) {\n        // 1.2.0-beta.1 bumps to 1.2.0-beta.2,\n        // 1.2.0-beta.fooblz or 1.2.0-beta bumps to 1.2.0-beta.0\n        if (this.prerelease[0] === identifier) {\n          if (isNaN(this.prerelease[1])) {\n            this.prerelease = [identifier, 0]\n          }\n        } else {\n          this.prerelease = [identifier, 0]\n        }\n      }\n      break\n\n    default:\n      throw new Error('invalid increment argument: ' + release)\n  }\n  this.format()\n  this.raw = this.version\n  return this\n}\n\nexports.inc = inc\nfunction inc (version, release, loose, identifier) {\n  if (typeof (loose) === 'string') {\n    identifier = loose\n    loose = undefined\n  }\n\n  try {\n    return new SemVer(version, loose).inc(release, identifier).version\n  } catch (er) {\n    return null\n  }\n}\n\nexports.diff = diff\nfunction diff (version1, version2) {\n  if (eq(version1, version2)) {\n    return null\n  } else {\n    var v1 = parse(version1)\n    var v2 = parse(version2)\n    var prefix = ''\n    if (v1.prerelease.length || v2.prerelease.length) {\n      prefix = 'pre'\n      var defaultResult = 'prerelease'\n    }\n    for (var key in v1) {\n      if (key === 'major' || key === 'minor' || key === 'patch') {\n        if (v1[key] !== v2[key]) {\n          return prefix + key\n        }\n      }\n    }\n    return defaultResult // may be undefined\n  }\n}\n\nexports.compareIdentifiers = compareIdentifiers\n\nvar numeric = /^[0-9]+$/\nfunction compareIdentifiers (a, b) {\n  var anum = numeric.test(a)\n  var bnum = numeric.test(b)\n\n  if (anum && bnum) {\n    a = +a\n    b = +b\n  }\n\n  return a === b ? 0\n    : (anum && !bnum) ? -1\n    : (bnum && !anum) ? 1\n    : a < b ? -1\n    : 1\n}\n\nexports.rcompareIdentifiers = rcompareIdentifiers\nfunction rcompareIdentifiers (a, b) {\n  return compareIdentifiers(b, a)\n}\n\nexports.major = major\nfunction major (a, loose) {\n  return new SemVer(a, loose).major\n}\n\nexports.minor = minor\nfunction minor (a, loose) {\n  return new SemVer(a, loose).minor\n}\n\nexports.patch = patch\nfunction patch (a, loose) {\n  return new SemVer(a, loose).patch\n}\n\nexports.compare = compare\nfunction compare (a, b, loose) {\n  return new SemVer(a, loose).compare(new SemVer(b, loose))\n}\n\nexports.compareLoose = compareLoose\nfunction compareLoose (a, b) {\n  return compare(a, b, true)\n}\n\nexports.compareBuild = compareBuild\nfunction compareBuild (a, b, loose) {\n  var versionA = new SemVer(a, loose)\n  var versionB = new SemVer(b, loose)\n  return versionA.compare(versionB) || versionA.compareBuild(versionB)\n}\n\nexports.rcompare = rcompare\nfunction rcompare (a, b, loose) {\n  return compare(b, a, loose)\n}\n\nexports.sort = sort\nfunction sort (list, loose) {\n  return list.sort(function (a, b) {\n    return exports.compareBuild(a, b, loose)\n  })\n}\n\nexports.rsort = rsort\nfunction rsort (list, loose) {\n  return list.sort(function (a, b) {\n    return exports.compareBuild(b, a, loose)\n  })\n}\n\nexports.gt = gt\nfunction gt (a, b, loose) {\n  return compare(a, b, loose) > 0\n}\n\nexports.lt = lt\nfunction lt (a, b, loose) {\n  return compare(a, b, loose) < 0\n}\n\nexports.eq = eq\nfunction eq (a, b, loose) {\n  return compare(a, b, loose) === 0\n}\n\nexports.neq = neq\nfunction neq (a, b, loose) {\n  return compare(a, b, loose) !== 0\n}\n\nexports.gte = gte\nfunction gte (a, b, loose) {\n  return compare(a, b, loose) >= 0\n}\n\nexports.lte = lte\nfunction lte (a, b, loose) {\n  return compare(a, b, loose) <= 0\n}\n\nexports.cmp = cmp\nfunction cmp (a, op, b, loose) {\n  switch (op) {\n    case '===':\n      if (typeof a === 'object')\n        a = a.version\n      if (typeof b === 'object')\n        b = b.version\n      return a === b\n\n    case '!==':\n      if (typeof a === 'object')\n        a = a.version\n      if (typeof b === 'object')\n        b = b.version\n      return a !== b\n\n    case '':\n    case '=':\n    case '==':\n      return eq(a, b, loose)\n\n    case '!=':\n      return neq(a, b, loose)\n\n    case '>':\n      return gt(a, b, loose)\n\n    case '>=':\n      return gte(a, b, loose)\n\n    case '<':\n      return lt(a, b, loose)\n\n    case '<=':\n      return lte(a, b, loose)\n\n    default:\n      throw new TypeError('Invalid operator: ' + op)\n  }\n}\n\nexports.Comparator = Comparator\nfunction Comparator (comp, options) {\n  if (!options || typeof options !== 'object') {\n    options = {\n      loose: !!options,\n      includePrerelease: false\n    }\n  }\n\n  if (comp instanceof Comparator) {\n    if (comp.loose === !!options.loose) {\n      return comp\n    } else {\n      comp = comp.value\n    }\n  }\n\n  if (!(this instanceof Comparator)) {\n    return new Comparator(comp, options)\n  }\n\n  debug('comparator', comp, options)\n  this.options = options\n  this.loose = !!options.loose\n  this.parse(comp)\n\n  if (this.semver === ANY) {\n    this.value = ''\n  } else {\n    this.value = this.operator + this.semver.version\n  }\n\n  debug('comp', this)\n}\n\nvar ANY = {}\nComparator.prototype.parse = function (comp) {\n  var r = this.options.loose ? re[t.COMPARATORLOOSE] : re[t.COMPARATOR]\n  var m = comp.match(r)\n\n  if (!m) {\n    throw new TypeError('Invalid comparator: ' + comp)\n  }\n\n  this.operator = m[1] !== undefined ? m[1] : ''\n  if (this.operator === '=') {\n    this.operator = ''\n  }\n\n  // if it literally is just '>' or '' then allow anything.\n  if (!m[2]) {\n    this.semver = ANY\n  } else {\n    this.semver = new SemVer(m[2], this.options.loose)\n  }\n}\n\nComparator.prototype.toString = function () {\n  return this.value\n}\n\nComparator.prototype.test = function (version) {\n  debug('Comparator.test', version, this.options.loose)\n\n  if (this.semver === ANY || version === ANY) {\n    return true\n  }\n\n  if (typeof version === 'string') {\n    try {\n      version = new SemVer(version, this.options)\n    } catch (er) {\n      return false\n    }\n  }\n\n  return cmp(version, this.operator, this.semver, this.options)\n}\n\nComparator.prototype.intersects = function (comp, options) {\n  if (!(comp instanceof Comparator)) {\n    throw new TypeError('a Comparator is required')\n  }\n\n  if (!options || typeof options !== 'object') {\n    options = {\n      loose: !!options,\n      includePrerelease: false\n    }\n  }\n\n  var rangeTmp\n\n  if (this.operator === '') {\n    if (this.value === '') {\n      return true\n    }\n    rangeTmp = new Range(comp.value, options)\n    return satisfies(this.value, rangeTmp, options)\n  } else if (comp.operator === '') {\n    if (comp.value === '') {\n      return true\n    }\n    rangeTmp = new Range(this.value, options)\n    return satisfies(comp.semver, rangeTmp, options)\n  }\n\n  var sameDirectionIncreasing =\n    (this.operator === '>=' || this.operator === '>') &&\n    (comp.operator === '>=' || comp.operator === '>')\n  var sameDirectionDecreasing =\n    (this.operator === '<=' || this.operator === '<') &&\n    (comp.operator === '<=' || comp.operator === '<')\n  var sameSemVer = this.semver.version === comp.semver.version\n  var differentDirectionsInclusive =\n    (this.operator === '>=' || this.operator === '<=') &&\n    (comp.operator === '>=' || comp.operator === '<=')\n  var oppositeDirectionsLessThan =\n    cmp(this.semver, '<', comp.semver, options) &&\n    ((this.operator === '>=' || this.operator === '>') &&\n    (comp.operator === '<=' || comp.operator === '<'))\n  var oppositeDirectionsGreaterThan =\n    cmp(this.semver, '>', comp.semver, options) &&\n    ((this.operator === '<=' || this.operator === '<') &&\n    (comp.operator === '>=' || comp.operator === '>'))\n\n  return sameDirectionIncreasing || sameDirectionDecreasing ||\n    (sameSemVer && differentDirectionsInclusive) ||\n    oppositeDirectionsLessThan || oppositeDirectionsGreaterThan\n}\n\nexports.Range = Range\nfunction Range (range, options) {\n  if (!options || typeof options !== 'object') {\n    options = {\n      loose: !!options,\n      includePrerelease: false\n    }\n  }\n\n  if (range instanceof Range) {\n    if (range.loose === !!options.loose &&\n        range.includePrerelease === !!options.includePrerelease) {\n      return range\n    } else {\n      return new Range(range.raw, options)\n    }\n  }\n\n  if (range instanceof Comparator) {\n    return new Range(range.value, options)\n  }\n\n  if (!(this instanceof Range)) {\n    return new Range(range, options)\n  }\n\n  this.options = options\n  this.loose = !!options.loose\n  this.includePrerelease = !!options.includePrerelease\n\n  // First, split based on boolean or ||\n  this.raw = range\n  this.set = range.split(/\\s*\\|\\|\\s*/).map(function (range) {\n    return this.parseRange(range.trim())\n  }, this).filter(function (c) {\n    // throw out any that are not relevant for whatever reason\n    return c.length\n  })\n\n  if (!this.set.length) {\n    throw new TypeError('Invalid SemVer Range: ' + range)\n  }\n\n  this.format()\n}\n\nRange.prototype.format = function () {\n  this.range = this.set.map(function (comps) {\n    return comps.join(' ').trim()\n  }).join('||').trim()\n  return this.range\n}\n\nRange.prototype.toString = function () {\n  return this.range\n}\n\nRange.prototype.parseRange = function (range) {\n  var loose = this.options.loose\n  range = range.trim()\n  // `1.2.3 - 1.2.4` => `>=1.2.3 <=1.2.4`\n  var hr = loose ? re[t.HYPHENRANGELOOSE] : re[t.HYPHENRANGE]\n  range = range.replace(hr, hyphenReplace)\n  debug('hyphen replace', range)\n  // `> 1.2.3 < 1.2.5` => `>1.2.3 <1.2.5`\n  range = range.replace(re[t.COMPARATORTRIM], comparatorTrimReplace)\n  debug('comparator trim', range, re[t.COMPARATORTRIM])\n\n  // `~ 1.2.3` => `~1.2.3`\n  range = range.replace(re[t.TILDETRIM], tildeTrimReplace)\n\n  // `^ 1.2.3` => `^1.2.3`\n  range = range.replace(re[t.CARETTRIM], caretTrimReplace)\n\n  // normalize spaces\n  range = range.split(/\\s+/).join(' ')\n\n  // At this point, the range is completely trimmed and\n  // ready to be split into comparators.\n\n  var compRe = loose ? re[t.COMPARATORLOOSE] : re[t.COMPARATOR]\n  var set = range.split(' ').map(function (comp) {\n    return parseComparator(comp, this.options)\n  }, this).join(' ').split(/\\s+/)\n  if (this.options.loose) {\n    // in loose mode, throw out any that are not valid comparators\n    set = set.filter(function (comp) {\n      return !!comp.match(compRe)\n    })\n  }\n  set = set.map(function (comp) {\n    return new Comparator(comp, this.options)\n  }, this)\n\n  return set\n}\n\nRange.prototype.intersects = function (range, options) {\n  if (!(range instanceof Range)) {\n    throw new TypeError('a Range is required')\n  }\n\n  return this.set.some(function (thisComparators) {\n    return (\n      isSatisfiable(thisComparators, options) &&\n      range.set.some(function (rangeComparators) {\n        return (\n          isSatisfiable(rangeComparators, options) &&\n          thisComparators.every(function (thisComparator) {\n            return rangeComparators.every(function (rangeComparator) {\n              return thisComparator.intersects(rangeComparator, options)\n            })\n          })\n        )\n      })\n    )\n  })\n}\n\n// take a set of comparators and determine whether there\n// exists a version which can satisfy it\nfunction isSatisfiable (comparators, options) {\n  var result = true\n  var remainingComparators = comparators.slice()\n  var testComparator = remainingComparators.pop()\n\n  while (result && remainingComparators.length) {\n    result = remainingComparators.every(function (otherComparator) {\n      return testComparator.intersects(otherComparator, options)\n    })\n\n    testComparator = remainingComparators.pop()\n  }\n\n  return result\n}\n\n// Mostly just for testing and legacy API reasons\nexports.toComparators = toComparators\nfunction toComparators (range, options) {\n  return new Range(range, options).set.map(function (comp) {\n    return comp.map(function (c) {\n      return c.value\n    }).join(' ').trim().split(' ')\n  })\n}\n\n// comprised of xranges, tildes, stars, and gtlt's at this point.\n// already replaced the hyphen ranges\n// turn into a set of JUST comparators.\nfunction parseComparator (comp, options) {\n  debug('comp', comp, options)\n  comp = replaceCarets(comp, options)\n  debug('caret', comp)\n  comp = replaceTildes(comp, options)\n  debug('tildes', comp)\n  comp = replaceXRanges(comp, options)\n  debug('xrange', comp)\n  comp = replaceStars(comp, options)\n  debug('stars', comp)\n  return comp\n}\n\nfunction isX (id) {\n  return !id || id.toLowerCase() === 'x' || id === '*'\n}\n\n// ~, ~> --> * (any, kinda silly)\n// ~2, ~2.x, ~2.x.x, ~>2, ~>2.x ~>2.x.x --> >=2.0.0 <3.0.0\n// ~2.0, ~2.0.x, ~>2.0, ~>2.0.x --> >=2.0.0 <2.1.0\n// ~1.2, ~1.2.x, ~>1.2, ~>1.2.x --> >=1.2.0 <1.3.0\n// ~1.2.3, ~>1.2.3 --> >=1.2.3 <1.3.0\n// ~1.2.0, ~>1.2.0 --> >=1.2.0 <1.3.0\nfunction replaceTildes (comp, options) {\n  return comp.trim().split(/\\s+/).map(function (comp) {\n    return replaceTilde(comp, options)\n  }).join(' ')\n}\n\nfunction replaceTilde (comp, options) {\n  var r = options.loose ? re[t.TILDELOOSE] : re[t.TILDE]\n  return comp.replace(r, function (_, M, m, p, pr) {\n    debug('tilde', comp, _, M, m, p, pr)\n    var ret\n\n    if (isX(M)) {\n      ret = ''\n    } else if (isX(m)) {\n      ret = '>=' + M + '.0.0 <' + (+M + 1) + '.0.0'\n    } else if (isX(p)) {\n      // ~1.2 == >=1.2.0 <1.3.0\n      ret = '>=' + M + '.' + m + '.0 <' + M + '.' + (+m + 1) + '.0'\n    } else if (pr) {\n      debug('replaceTilde pr', pr)\n      ret = '>=' + M + '.' + m + '.' + p + '-' + pr +\n            ' <' + M + '.' + (+m + 1) + '.0'\n    } else {\n      // ~1.2.3 == >=1.2.3 <1.3.0\n      ret = '>=' + M + '.' + m + '.' + p +\n            ' <' + M + '.' + (+m + 1) + '.0'\n    }\n\n    debug('tilde return', ret)\n    return ret\n  })\n}\n\n// ^ --> * (any, kinda silly)\n// ^2, ^2.x, ^2.x.x --> >=2.0.0 <3.0.0\n// ^2.0, ^2.0.x --> >=2.0.0 <3.0.0\n// ^1.2, ^1.2.x --> >=1.2.0 <2.0.0\n// ^1.2.3 --> >=1.2.3 <2.0.0\n// ^1.2.0 --> >=1.2.0 <2.0.0\nfunction replaceCarets (comp, options) {\n  return comp.trim().split(/\\s+/).map(function (comp) {\n    return replaceCaret(comp, options)\n  }).join(' ')\n}\n\nfunction replaceCaret (comp, options) {\n  debug('caret', comp, options)\n  var r = options.loose ? re[t.CARETLOOSE] : re[t.CARET]\n  return comp.replace(r, function (_, M, m, p, pr) {\n    debug('caret', comp, _, M, m, p, pr)\n    var ret\n\n    if (isX(M)) {\n      ret = ''\n    } else if (isX(m)) {\n      ret = '>=' + M + '.0.0 <' + (+M + 1) + '.0.0'\n    } else if (isX(p)) {\n      if (M === '0') {\n        ret = '>=' + M + '.' + m + '.0 <' + M + '.' + (+m + 1) + '.0'\n      } else {\n        ret = '>=' + M + '.' + m + '.0 <' + (+M + 1) + '.0.0'\n      }\n    } else if (pr) {\n      debug('replaceCaret pr', pr)\n      if (M === '0') {\n        if (m === '0') {\n          ret = '>=' + M + '.' + m + '.' + p + '-' + pr +\n                ' <' + M + '.' + m + '.' + (+p + 1)\n        } else {\n          ret = '>=' + M + '.' + m + '.' + p + '-' + pr +\n                ' <' + M + '.' + (+m + 1) + '.0'\n        }\n      } else {\n        ret = '>=' + M + '.' + m + '.' + p + '-' + pr +\n              ' <' + (+M + 1) + '.0.0'\n      }\n    } else {\n      debug('no pr')\n      if (M === '0') {\n        if (m === '0') {\n          ret = '>=' + M + '.' + m + '.' + p +\n                ' <' + M + '.' + m + '.' + (+p + 1)\n        } else {\n          ret = '>=' + M + '.' + m + '.' + p +\n                ' <' + M + '.' + (+m + 1) + '.0'\n        }\n      } else {\n        ret = '>=' + M + '.' + m + '.' + p +\n              ' <' + (+M + 1) + '.0.0'\n      }\n    }\n\n    debug('caret return', ret)\n    return ret\n  })\n}\n\nfunction replaceXRanges (comp, options) {\n  debug('replaceXRanges', comp, options)\n  return comp.split(/\\s+/).map(function (comp) {\n    return replaceXRange(comp, options)\n  }).join(' ')\n}\n\nfunction replaceXRange (comp, options) {\n  comp = comp.trim()\n  var r = options.loose ? re[t.XRANGELOOSE] : re[t.XRANGE]\n  return comp.replace(r, function (ret, gtlt, M, m, p, pr) {\n    debug('xRange', comp, ret, gtlt, M, m, p, pr)\n    var xM = isX(M)\n    var xm = xM || isX(m)\n    var xp = xm || isX(p)\n    var anyX = xp\n\n    if (gtlt === '=' && anyX) {\n      gtlt = ''\n    }\n\n    // if we're including prereleases in the match, then we need\n    // to fix this to -0, the lowest possible prerelease value\n    pr = options.includePrerelease ? '-0' : ''\n\n    if (xM) {\n      if (gtlt === '>' || gtlt === '<') {\n        // nothing is allowed\n        ret = '<0.0.0-0'\n      } else {\n        // nothing is forbidden\n        ret = '*'\n      }\n    } else if (gtlt && anyX) {\n      // we know patch is an x, because we have any x at all.\n      // replace X with 0\n      if (xm) {\n        m = 0\n      }\n      p = 0\n\n      if (gtlt === '>') {\n        // >1 => >=2.0.0\n        // >1.2 => >=1.3.0\n        // >1.2.3 => >= 1.2.4\n        gtlt = '>='\n        if (xm) {\n          M = +M + 1\n          m = 0\n          p = 0\n        } else {\n          m = +m + 1\n          p = 0\n        }\n      } else if (gtlt === '<=') {\n        // <=0.7.x is actually <0.8.0, since any 0.7.x should\n        // pass.  Similarly, <=7.x is actually <8.0.0, etc.\n        gtlt = '<'\n        if (xm) {\n          M = +M + 1\n        } else {\n          m = +m + 1\n        }\n      }\n\n      ret = gtlt + M + '.' + m + '.' + p + pr\n    } else if (xm) {\n      ret = '>=' + M + '.0.0' + pr + ' <' + (+M + 1) + '.0.0' + pr\n    } else if (xp) {\n      ret = '>=' + M + '.' + m + '.0' + pr +\n        ' <' + M + '.' + (+m + 1) + '.0' + pr\n    }\n\n    debug('xRange return', ret)\n\n    return ret\n  })\n}\n\n// Because * is AND-ed with everything else in the comparator,\n// and '' means \"any version\", just remove the *s entirely.\nfunction replaceStars (comp, options) {\n  debug('replaceStars', comp, options)\n  // Looseness is ignored here.  star is always as loose as it gets!\n  return comp.trim().replace(re[t.STAR], '')\n}\n\n// This function is passed to string.replace(re[t.HYPHENRANGE])\n// M, m, patch, prerelease, build\n// 1.2 - 3.4.5 => >=1.2.0 <=3.4.5\n// 1.2.3 - 3.4 => >=1.2.0 <3.5.0 Any 3.4.x will do\n// 1.2 - 3.4 => >=1.2.0 <3.5.0\nfunction hyphenReplace ($0,\n  from, fM, fm, fp, fpr, fb,\n  to, tM, tm, tp, tpr, tb) {\n  if (isX(fM)) {\n    from = ''\n  } else if (isX(fm)) {\n    from = '>=' + fM + '.0.0'\n  } else if (isX(fp)) {\n    from = '>=' + fM + '.' + fm + '.0'\n  } else {\n    from = '>=' + from\n  }\n\n  if (isX(tM)) {\n    to = ''\n  } else if (isX(tm)) {\n    to = '<' + (+tM + 1) + '.0.0'\n  } else if (isX(tp)) {\n    to = '<' + tM + '.' + (+tm + 1) + '.0'\n  } else if (tpr) {\n    to = '<=' + tM + '.' + tm + '.' + tp + '-' + tpr\n  } else {\n    to = '<=' + to\n  }\n\n  return (from + ' ' + to).trim()\n}\n\n// if ANY of the sets match ALL of its comparators, then pass\nRange.prototype.test = function (version) {\n  if (!version) {\n    return false\n  }\n\n  if (typeof version === 'string') {\n    try {\n      version = new SemVer(version, this.options)\n    } catch (er) {\n      return false\n    }\n  }\n\n  for (var i = 0; i < this.set.length; i++) {\n    if (testSet(this.set[i], version, this.options)) {\n      return true\n    }\n  }\n  return false\n}\n\nfunction testSet (set, version, options) {\n  for (var i = 0; i < set.length; i++) {\n    if (!set[i].test(version)) {\n      return false\n    }\n  }\n\n  if (version.prerelease.length && !options.includePrerelease) {\n    // Find the set of versions that are allowed to have prereleases\n    // For example, ^1.2.3-pr.1 desugars to >=1.2.3-pr.1 <2.0.0\n    // That should allow `1.2.3-pr.2` to pass.\n    // However, `1.2.4-alpha.notready` should NOT be allowed,\n    // even though it's within the range set by the comparators.\n    for (i = 0; i < set.length; i++) {\n      debug(set[i].semver)\n      if (set[i].semver === ANY) {\n        continue\n      }\n\n      if (set[i].semver.prerelease.length > 0) {\n        var allowed = set[i].semver\n        if (allowed.major === version.major &&\n            allowed.minor === version.minor &&\n            allowed.patch === version.patch) {\n          return true\n        }\n      }\n    }\n\n    // Version has a -pre, but it's not one of the ones we like.\n    return false\n  }\n\n  return true\n}\n\nexports.satisfies = satisfies\nfunction satisfies (version, range, options) {\n  try {\n    range = new Range(range, options)\n  } catch (er) {\n    return false\n  }\n  return range.test(version)\n}\n\nexports.maxSatisfying = maxSatisfying\nfunction maxSatisfying (versions, range, options) {\n  var max = null\n  var maxSV = null\n  try {\n    var rangeObj = new Range(range, options)\n  } catch (er) {\n    return null\n  }\n  versions.forEach(function (v) {\n    if (rangeObj.test(v)) {\n      // satisfies(v, range, options)\n      if (!max || maxSV.compare(v) === -1) {\n        // compare(max, v, true)\n        max = v\n        maxSV = new SemVer(max, options)\n      }\n    }\n  })\n  return max\n}\n\nexports.minSatisfying = minSatisfying\nfunction minSatisfying (versions, range, options) {\n  var min = null\n  var minSV = null\n  try {\n    var rangeObj = new Range(range, options)\n  } catch (er) {\n    return null\n  }\n  versions.forEach(function (v) {\n    if (rangeObj.test(v)) {\n      // satisfies(v, range, options)\n      if (!min || minSV.compare(v) === 1) {\n        // compare(min, v, true)\n        min = v\n        minSV = new SemVer(min, options)\n      }\n    }\n  })\n  return min\n}\n\nexports.minVersion = minVersion\nfunction minVersion (range, loose) {\n  range = new Range(range, loose)\n\n  var minver = new SemVer('0.0.0')\n  if (range.test(minver)) {\n    return minver\n  }\n\n  minver = new SemVer('0.0.0-0')\n  if (range.test(minver)) {\n    return minver\n  }\n\n  minver = null\n  for (var i = 0; i < range.set.length; ++i) {\n    var comparators = range.set[i]\n\n    comparators.forEach(function (comparator) {\n      // Clone to avoid manipulating the comparator's semver object.\n      var compver = new SemVer(comparator.semver.version)\n      switch (comparator.operator) {\n        case '>':\n          if (compver.prerelease.length === 0) {\n            compver.patch++\n          } else {\n            compver.prerelease.push(0)\n          }\n          compver.raw = compver.format()\n          /* fallthrough */\n        case '':\n        case '>=':\n          if (!minver || gt(minver, compver)) {\n            minver = compver\n          }\n          break\n        case '<':\n        case '<=':\n          /* Ignore maximum versions */\n          break\n        /* istanbul ignore next */\n        default:\n          throw new Error('Unexpected operation: ' + comparator.operator)\n      }\n    })\n  }\n\n  if (minver && range.test(minver)) {\n    return minver\n  }\n\n  return null\n}\n\nexports.validRange = validRange\nfunction validRange (range, options) {\n  try {\n    // Return '*' instead of '' so that truthiness works.\n    // This will throw if it's invalid anyway\n    return new Range(range, options).range || '*'\n  } catch (er) {\n    return null\n  }\n}\n\n// Determine if version is less than all the versions possible in the range\nexports.ltr = ltr\nfunction ltr (version, range, options) {\n  return outside(version, range, '<', options)\n}\n\n// Determine if version is greater than all the versions possible in the range.\nexports.gtr = gtr\nfunction gtr (version, range, options) {\n  return outside(version, range, '>', options)\n}\n\nexports.outside = outside\nfunction outside (version, range, hilo, options) {\n  version = new SemVer(version, options)\n  range = new Range(range, options)\n\n  var gtfn, ltefn, ltfn, comp, ecomp\n  switch (hilo) {\n    case '>':\n      gtfn = gt\n      ltefn = lte\n      ltfn = lt\n      comp = '>'\n      ecomp = '>='\n      break\n    case '<':\n      gtfn = lt\n      ltefn = gte\n      ltfn = gt\n      comp = '<'\n      ecomp = '<='\n      break\n    default:\n      throw new TypeError('Must provide a hilo val of \"<\" or \">\"')\n  }\n\n  // If it satisifes the range it is not outside\n  if (satisfies(version, range, options)) {\n    return false\n  }\n\n  // From now on, variable terms are as if we're in \"gtr\" mode.\n  // but note that everything is flipped for the \"ltr\" function.\n\n  for (var i = 0; i < range.set.length; ++i) {\n    var comparators = range.set[i]\n\n    var high = null\n    var low = null\n\n    comparators.forEach(function (comparator) {\n      if (comparator.semver === ANY) {\n        comparator = new Comparator('>=0.0.0')\n      }\n      high = high || comparator\n      low = low || comparator\n      if (gtfn(comparator.semver, high.semver, options)) {\n        high = comparator\n      } else if (ltfn(comparator.semver, low.semver, options)) {\n        low = comparator\n      }\n    })\n\n    // If the edge version comparator has a operator then our version\n    // isn't outside it\n    if (high.operator === comp || high.operator === ecomp) {\n      return false\n    }\n\n    // If the lowest version comparator has an operator and our version\n    // is less than it then it isn't higher than the range\n    if ((!low.operator || low.operator === comp) &&\n        ltefn(version, low.semver)) {\n      return false\n    } else if (low.operator === ecomp && ltfn(version, low.semver)) {\n      return false\n    }\n  }\n  return true\n}\n\nexports.prerelease = prerelease\nfunction prerelease (version, options) {\n  var parsed = parse(version, options)\n  return (parsed && parsed.prerelease.length) ? parsed.prerelease : null\n}\n\nexports.intersects = intersects\nfunction intersects (r1, r2, options) {\n  r1 = new Range(r1, options)\n  r2 = new Range(r2, options)\n  return r1.intersects(r2)\n}\n\nexports.coerce = coerce\nfunction coerce (version, options) {\n  if (version instanceof SemVer) {\n    return version\n  }\n\n  if (typeof version === 'number') {\n    version = String(version)\n  }\n\n  if (typeof version !== 'string') {\n    return null\n  }\n\n  options = options || {}\n\n  var match = null\n  if (!options.rtl) {\n    match = version.match(re[t.COERCE])\n  } else {\n    // Find the right-most coercible string that does not share\n    // a terminus with a more left-ward coercible string.\n    // Eg, '1.2.3.4' wants to coerce '2.3.4', not '3.4' or '4'\n    //\n    // Walk through the string checking with a /g regexp\n    // Manually set the index so as to pick up overlapping matches.\n    // Stop when we get a match that ends at the string end, since no\n    // coercible string can be more right-ward without the same terminus.\n    var next\n    while ((next = re[t.COERCERTL].exec(version)) &&\n      (!match || match.index + match[0].length !== version.length)\n    ) {\n      if (!match ||\n          next.index + next[0].length !== match.index + match[0].length) {\n        match = next\n      }\n      re[t.COERCERTL].lastIndex = next.index + next[1].length + next[2].length\n    }\n    // leave it in a clean state\n    re[t.COERCERTL].lastIndex = -1\n  }\n\n  if (match === null) {\n    return null\n  }\n\n  return parse(match[2] +\n    '.' + (match[3] || '0') +\n    '.' + (match[4] || '0'), options)\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","'use strict';\n\n/* global setTimeout, clearTimeout */\n\nmodule.exports = function debounce(fn) {\n  var wait = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n  var lastCallAt = void 0;\n  var deferred = void 0;\n  var timer = void 0;\n  var pendingArgs = [];\n  return function debounced() {\n    var currentWait = getWait(wait);\n    var currentTime = new Date().getTime();\n\n    var isCold = !lastCallAt || currentTime - lastCallAt > currentWait;\n\n    lastCallAt = currentTime;\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    if (isCold && options.leading) {\n      return options.accumulate ? Promise.resolve(fn.call(this, [args])).then(function (result) {\n        return result[0];\n      }) : Promise.resolve(fn.call.apply(fn, [this].concat(args)));\n    }\n\n    if (deferred) {\n      clearTimeout(timer);\n    } else {\n      deferred = defer();\n    }\n\n    pendingArgs.push(args);\n    timer = setTimeout(flush.bind(this), currentWait);\n\n    if (options.accumulate) {\n      var argsIndex = pendingArgs.length - 1;\n      return deferred.promise.then(function (results) {\n        return results[argsIndex];\n      });\n    }\n\n    return deferred.promise;\n  };\n\n  function flush() {\n    var thisDeferred = deferred;\n    clearTimeout(timer);\n\n    Promise.resolve(options.accumulate ? fn.call(this, pendingArgs) : fn.apply(this, pendingArgs[pendingArgs.length - 1])).then(thisDeferred.resolve, thisDeferred.reject);\n\n    pendingArgs = [];\n    deferred = null;\n  }\n};\n\nfunction getWait(wait) {\n  return typeof wait === 'function' ? wait() : wait;\n}\n\nfunction defer() {\n  var deferred = {};\n  deferred.promise = new Promise(function (resolve, reject) {\n    deferred.resolve = resolve;\n    deferred.reject = reject;\n  });\n  return deferred;\n}\n//# sourceMappingURL=index.js.map","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n","import { QueryEditorPropertyType, QueryEditorProperty, QueryEditorOperator } from './types';\n\nexport enum QueryEditorExpressionType {\n  Property = 'property',\n  Operator = 'operator',\n  Reduce = 'reduce',\n  FunctionParameter = 'functionParameter',\n  GroupBy = 'groupBy',\n  Or = 'or',\n  And = 'and',\n}\nexport interface QueryEditorExpression {\n  type: QueryEditorExpressionType;\n}\n\nexport interface QueryEditorPropertyExpression extends QueryEditorExpression {\n  property: QueryEditorProperty;\n}\nexport interface QueryEditorOperatorExpression extends QueryEditorExpression {\n  property: QueryEditorProperty;\n  operator: QueryEditorOperator;\n}\n\nexport interface QueryEditorFunctionParameterExpression extends QueryEditorExpression {\n  value: string;\n  fieldType: QueryEditorPropertyType;\n  name: string;\n}\n\nexport interface QueryEditorReduceExpression extends QueryEditorExpression {\n  property: QueryEditorProperty;\n  reduce: QueryEditorProperty;\n  parameters?: QueryEditorFunctionParameterExpression[];\n}\n\nexport interface QueryEditorGroupByExpression extends QueryEditorExpression {\n  property: QueryEditorProperty;\n  interval?: QueryEditorProperty;\n}\n\nexport interface QueryEditorArrayExpression extends QueryEditorExpression {\n  expressions: QueryEditorExpression[] | QueryEditorArrayExpression[];\n}\n","import React from 'react';\n\ninterface ConfigHelpProps {}\n\nconst ConfigHelp: React.FC<ConfigHelpProps> = () => {\n  return (\n    <div className=\"gf-form-group\">\n      <div className=\"grafana-info-box\">\n        <h5>Configuring Azure and your Azure Data Explorer Database</h5>\n        <h5>1. Create an AAD application</h5>\n        <p>\n          Details on how to do create one via the Azure portal or with the Azure CLI can be found{' '}\n          <a\n            className=\"external-link\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n            href=\"https://github.com/grafana/azure-data-explorer-datasource#configuring-the-datasource-in-grafana\"\n          >\n            here.\n          </a>\n        </p>\n\n        <h5>2. Connect the AAD Application to a database user</h5>\n        <p>\n          Navigate to the Azure Data Explorer Web UI via the Azure Portal. The AAD application that you created in step\n          1 needs to be given viewer access to your Azure Data Explorer database. This is done using the dot command{' '}\n          <i>add</i>:\n        </p>\n\n        <pre>.add database your_db_name viewers (&lsquo;aadapp=your_client_id;your_tenant_id&rsquo;)</pre>\n\n        <h5>3. Configure the connection in Grafana</h5>\n        <p>\n          Use the details from the AAD Service Principle from Step 1 to fill in the field below. Then click the Save &\n          Test button.\n        </p>\n\n        <p>\n          Detailed instructions on all three steps can found in{' '}\n          <a\n            className=\"external-link\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n            href=\"https://github.com/grafana/azure-data-explorer-datasource#configuring-the-datasource-in-grafana\"\n          >\n            in the documentation.\n          </a>\n        </p>\n      </div>\n    </div>\n  );\n};\n\nexport default ConfigHelp;\n","import { DataQuery, DataSourceJsonData } from '@grafana/data';\n\nimport {\n  QueryEditorArrayExpression,\n  QueryEditorExpressionType,\n  QueryEditorOperatorExpression,\n  QueryEditorPropertyExpression,\n} from './editor/expressions';\n\nconst packageJson = require('../package.json');\n\nexport interface QueryExpression {\n  from?: QueryEditorPropertyExpression;\n  where: QueryEditorArrayExpression;\n  reduce: QueryEditorArrayExpression;\n  groupBy: QueryEditorArrayExpression;\n  timeshift?: QueryEditorPropertyExpression;\n}\n\ntype QuerySource = 'raw' | 'schema' | 'autocomplete' | 'visual';\nexport interface KustoQuery extends DataQuery {\n  query: string;\n  database: string;\n  alias?: string;\n  resultFormat: string;\n  expression: QueryExpression;\n  rawMode?: boolean;\n  querySource: QuerySource;\n  pluginVersion: string;\n}\n\nexport interface AutoCompleteQuery {\n  database: string;\n  search: QueryEditorOperatorExpression;\n  expression: QueryExpression;\n  index: string;\n}\n\nexport enum EditorMode {\n  Visual = 'visual',\n  Raw = 'raw',\n}\n\nexport const defaultQuery: Pick<KustoQuery, 'query' | 'expression' | 'querySource' | 'pluginVersion'> = {\n  query: '',\n  querySource: EditorMode.Raw,\n  expression: {\n    where: {\n      type: QueryEditorExpressionType.And,\n      expressions: [],\n    },\n    groupBy: {\n      type: QueryEditorExpressionType.And,\n      expressions: [],\n    },\n    reduce: {\n      type: QueryEditorExpressionType.And,\n      expressions: [],\n    },\n  },\n  pluginVersion: packageJson.version,\n};\n\nexport interface SchemaMapping {\n  type: SchemaMappingType;\n  value: string;\n  name: string;\n  database: string;\n  displayName: string;\n}\n\nexport interface SchemaMappingOption {\n  label: string;\n  value: string;\n  type: SchemaMappingType;\n  name: string;\n  database: string;\n  input?: AdxFunctionInputParameterSchema[];\n}\n\nexport enum SchemaMappingType {\n  function = 'function',\n  table = 'table',\n  materializedView = 'materializedView',\n}\nexport interface AdxDataSourceOptions extends DataSourceJsonData {\n  azureCloud?: AzureCloudType;\n  defaultDatabase: string;\n  minimalCache: number;\n  defaultEditorMode: EditorMode;\n  queryTimeout: string;\n  dataConsistency: string;\n  cacheMaxAge: string;\n  dynamicCaching: boolean;\n  useSchemaMapping: boolean;\n  schemaMappings?: Array<Partial<SchemaMapping>>;\n  enableUserTracking: boolean;\n  clusterUrl: string;\n  tenantId: string;\n  clientId: string;\n  onBehalfOf: boolean;\n  oauthPassThru: boolean; // required for onBehalfOf\n}\n\nexport interface AdxDataSourceSecureOptions {\n  clientSecret: string | false;\n}\n\nexport interface AdxSchema {\n  Databases: Record<string, AdxDatabaseSchema>;\n}\n\nexport interface AdxDatabaseSchema {\n  Name: string;\n  Tables: Record<string, AdxTableSchema>;\n  ExternalTables: Record<string, AdxTableSchema>;\n  Functions: Record<string, AdxFunctionSchema>;\n  MaterializedViews: Record<string, AdxTableSchema>;\n}\n\nexport interface AdxTableSchema {\n  Name: string;\n  OrderedColumns: AdxColumnSchema[];\n}\n\nexport interface AdxColumnSchema {\n  Name: string;\n  CslType: string;\n  Type?: string;\n  CslDefaultValue?: string;\n}\n\nexport interface AdxFunctionSchema {\n  Body: string;\n  FunctionKind: string;\n  Name: string;\n  InputParameters: AdxFunctionInputParameterSchema[];\n  OutputColumns: AdxColumnSchema[];\n  DocString?: string;\n}\n\nexport interface AdxFunctionInputParameterSchema extends AdxColumnSchema {}\n\n// must be in synch with clouds.go\nexport enum AzureCloudType {\n  AzurePublic = 'azuremonitor',\n  AzureUSGovernment = 'govazuremonitor',\n  AzureChina = 'chinaazuremonitor',\n}\n","import { E2ESelectors } from '@grafana/e2e-selectors';\n\nexport const components = {\n  configEditor: {\n    azureCloud: {\n      input: 'data-testid azure-cloud',\n    },\n    tenantID: {\n      input: 'data-testid tenant-id',\n    },\n    clusterURL: {\n      input: 'data-testid cluster-url',\n    },\n    clientID: {\n      input: 'data-testid client-id',\n    },\n    clientSecret: {\n      input: 'data-testid client-secret',\n    },\n  },\n  queryEditor: {\n    editKQL: {\n      button: 'Edit KQL',\n    },\n    codeEditorLegacy: {\n      container: 'data-testid legacy-editor',\n      textarea: 'Editor content;Press Alt+F1 for Accessibility Options.',\n    },\n    codeEditor: {\n      container: 'data-testid code-editor',\n    },\n    database: {\n      input: 'Database',\n    },\n    tableFrom: {\n      input: 'From table',\n    },\n    runQuery: {\n      button: 'Run Query',\n    },\n  },\n};\n\nexport const selectors: { components: E2ESelectors<typeof components> } = {\n  components: components,\n};\n","import { DataSourcePluginOptionsEditorProps, SelectableValue } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { FieldSet, HorizontalGroup, InlineField, InlineSwitch, Input, LegacyForms, Select } from '@grafana/ui';\nimport React, { useEffect } from 'react';\nimport { AdxDataSourceOptions, AdxDataSourceSecureOptions, AzureCloudType } from 'types';\nimport { selectors } from 'test/selectors';\n\nconst { SecretFormField } = LegacyForms;\nconst azureClouds: Array<SelectableValue<AzureCloudType>> = [\n  { value: AzureCloudType.AzurePublic, label: 'Azure' },\n  { value: AzureCloudType.AzureUSGovernment, label: 'Azure US Government' },\n  { value: AzureCloudType.AzureChina, label: 'Azure China' },\n];\n\ninterface ConnectionConfigProps\n  extends DataSourcePluginOptionsEditorProps<AdxDataSourceOptions, AdxDataSourceSecureOptions> {\n  updateJsonData: <T extends keyof AdxDataSourceOptions>(fieldName: T, value: AdxDataSourceOptions[T]) => void;\n  handleClearClientSecret: () => void;\n}\n\nconst ConnectionConfig: React.FC<ConnectionConfigProps> = ({\n  options,\n  onOptionsChange,\n  updateJsonData,\n  handleClearClientSecret,\n}) => {\n  const { jsonData, secureJsonData, secureJsonFields } = options;\n\n  // Set some default values\n  useEffect(() => {\n    if (jsonData.onBehalfOf && !config.featureToggles.adxOnBehalfOf) {\n      updateJsonData('onBehalfOf', false);\n    }\n    if (!jsonData.azureCloud) {\n      updateJsonData('azureCloud', AzureCloudType.AzurePublic);\n    }\n    if (!!jsonData.oauthPassThru !== !!jsonData.onBehalfOf) {\n      updateJsonData('oauthPassThru', !!jsonData.onBehalfOf);\n    }\n  }, [jsonData.azureCloud, jsonData.oauthPassThru, jsonData.onBehalfOf, updateJsonData]);\n\n  const handleClientSecretChange = (ev?: React.ChangeEvent<HTMLInputElement>) => {\n    onOptionsChange({\n      ...options,\n      secureJsonData: {\n        ...secureJsonData,\n        // it's false when we unset it\n        clientSecret: ev ? ev.target.value : false,\n      },\n    });\n  };\n\n  const clientSecretTooltip = (\n    <>\n      To create a new key, log in to Azure Portal, navigate to Azure Active Directory {''} App Registrations\n      {'  '} Choose your app {''} Keys.\n      <br />\n      <br />\n      <a\n        target=\"_blank\"\n        rel=\"noreferrer\"\n        href=\"https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-create-service-principal-portal\"\n      >\n        Click here for detailed instructions on setting up an Azure Active Directory (AD) application.\n      </a>\n    </>\n  );\n\n  return (\n    <FieldSet label=\"Connection Details\">\n      <InlineField\n        label=\"Azure cloud\"\n        labelWidth={26}\n        tooltip=\"Select an Azure Cloud.\"\n        required\n        data-testid={selectors.components.configEditor.azureCloud.input}\n        htmlFor=\"azure-cloud-type\"\n      >\n        <Select\n          inputId=\"azure-cloud-type\"\n          options={azureClouds}\n          value={azureClouds.find((v) => v.value === jsonData.azureCloud)}\n          onChange={(change: SelectableValue<AzureCloudType>) =>\n            updateJsonData('azureCloud', change.value ? change.value : AzureCloudType.AzurePublic)\n          }\n          isClearable={false}\n          width={60}\n        />\n      </InlineField>\n\n      <InlineField label=\"Cluster URL\" labelWidth={26} tooltip=\"The cluster url for your Azure Data Explorer database.\">\n        <Input\n          data-testid={selectors.components.configEditor.clusterURL.input}\n          value={jsonData.clusterUrl}\n          id=\"adx-cluster-url\"\n          placeholder=\"https://yourcluster.kusto.windows.net\"\n          width={60}\n          onChange={(ev: React.ChangeEvent<HTMLInputElement>) => updateJsonData('clusterUrl', ev.target.value)}\n        />\n      </InlineField>\n\n      <InlineField\n        label=\"Tenant ID\"\n        labelWidth={26}\n        tooltip={\n          <>\n            In the Azure Portal, navigate to Azure Active Directory {''} Properties {''} Directory ID.\n            <br />\n            <br />\n            <a\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              href=\"https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-create-service-principal-portal\"\n            >\n              Click here for detailed instructions on setting up an Azure Active Directory (AD) application.\n            </a>\n          </>\n        }\n      >\n        <Input\n          value={jsonData.tenantId}\n          id=\"adx-tenant-id\"\n          data-testid={selectors.components.configEditor.tenantID.input}\n          width={60}\n          onChange={(ev: React.ChangeEvent<HTMLInputElement>) => updateJsonData('tenantId', ev.target.value)}\n        />\n      </InlineField>\n\n      <InlineField\n        label=\"Client ID\"\n        labelWidth={26}\n        tooltip={\n          <>\n            In the Azure Portal, navigate to Azure Active Directory {''} App Registrations {''} Choose your app {''}\n            Application ID.\n            <br />\n            <br />\n            <a\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              href=\"https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-create-service-principal-portal\"\n            >\n              Click here for detailed instructions on setting up an Azure Active Directory (AD) application.\n            </a>\n          </>\n        }\n      >\n        <Input\n          value={jsonData.clientId}\n          id=\"adx-client-id\"\n          data-testid={selectors.components.configEditor.clientID.input}\n          width={60}\n          onChange={(ev: React.ChangeEvent<HTMLInputElement>) => updateJsonData('clientId', ev.target.value)}\n        />\n      </InlineField>\n\n      <SecretFormField\n        label=\"Client secret\"\n        aria-label=\"Client secret\"\n        data-testid={selectors.components.configEditor.clientSecret.input}\n        value={secureJsonData?.clientSecret || undefined}\n        labelWidth={13}\n        inputWidth={30}\n        placeholder=\"\"\n        onReset={() => handleClearClientSecret()}\n        onChange={handleClientSecretChange}\n        isConfigured={!!secureJsonFields?.clientSecret}\n        tooltip={clientSecretTooltip}\n      />\n\n      {config.featureToggles.adxOnBehalfOf && (\n        <InlineField\n          label=\"Use On-Behalf-Of\"\n          htmlFor=\"adx-on-behalf-of\"\n          labelWidth={26}\n          tooltip={\n            <>\n              Propagate Grafana client credentials to ADX with a token exchange. When enabled the service account\n              (Client ID) impersonates the user by augmenting the access token. See the{' '}\n              <a\n                target=\"_blank\"\n                rel=\"noreferrer\"\n                href=\"https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow\"\n              >\n                developer documentation\n              </a>{' '}\n              for detail on the concept. This feature requires a Grafana version 8.3.4 or later.\n            </>\n          }\n        >\n          <HorizontalGroup>\n            <InlineSwitch\n              id=\"adx-on-behalf-of\"\n              value={jsonData.onBehalfOf}\n              onChange={(ev: React.ChangeEvent<HTMLInputElement>) => updateJsonData('onBehalfOf', ev.target.checked)}\n            />\n            <span> This feature is in beta</span>\n          </HorizontalGroup>\n        </InlineField>\n      )}\n    </FieldSet>\n  );\n};\n\nexport default ConnectionConfig;\n","import { DataSourcePluginOptionsEditorProps, SelectableValue } from '@grafana/data';\nimport {\n  Button,\n  FieldSet,\n  HorizontalGroup,\n  Icon,\n  InlineField,\n  InlineLabel,\n  InlineSwitch,\n  Input,\n  Select,\n  VerticalGroup,\n} from '@grafana/ui';\nimport React, { useCallback, useMemo } from 'react';\nimport { AdxDataSourceOptions, AdxDataSourceSecureOptions } from 'types';\nimport { Schema } from './refreshSchema';\n\ninterface DatabaseConfigProps\n  extends DataSourcePluginOptionsEditorProps<AdxDataSourceOptions, AdxDataSourceSecureOptions> {\n  schema: Schema;\n  updateJsonData: <T extends keyof AdxDataSourceOptions>(fieldName: T, value: AdxDataSourceOptions[T]) => void;\n  onRefresh: () => void;\n}\n\nfunction formatMappingValue(mapping): string {\n  switch (mapping?.type) {\n    case 'function':\n      const input = mapping.input ?? [];\n      return `${mapping.value}(${input.map((i) => i.Value).join(',')})`;\n    default:\n      return mapping.value;\n  }\n}\n\nconst DatabaseConfig: React.FC<DatabaseConfigProps> = ({ options, schema, updateJsonData, onRefresh }) => {\n  const { jsonData } = options;\n  const mappings = useMemo(() => jsonData.schemaMappings ?? [], [jsonData.schemaMappings]);\n\n  const handleAddNewMapping = useCallback(() => {\n    updateJsonData('schemaMappings', [...mappings, {}]);\n  }, [mappings, updateJsonData]);\n\n  const handleMappingTargetChange = (index: number, change: SelectableValue<string>) => {\n    const target = change.value && schema.schemaMappingOptions?.find((v) => v.value === change.value);\n    if (!target) {\n      return;\n    }\n\n    const newMappings = [...mappings];\n    newMappings[index] = {\n      ...newMappings[index],\n      database: target.database,\n      type: target.type,\n      name: target.value,\n      value: formatMappingValue(target),\n    };\n\n    updateJsonData('schemaMappings', newMappings);\n  };\n\n  const handleMappingNameChange = (index: number, value: string) => {\n    const newMappings = [...mappings];\n    newMappings[index] = {\n      ...newMappings[index],\n      displayName: value,\n    };\n\n    updateJsonData('schemaMappings', newMappings);\n  };\n\n  const handleRemoveMapping = (index: number) => {\n    const newMappings = [...mappings];\n    newMappings.splice(index, 1);\n    updateJsonData('schemaMappings', newMappings);\n  };\n\n  return (\n    <FieldSet label=\"Database schema settings\">\n      <InlineField label=\"Default database\" labelWidth={26}>\n        <Select\n          width={45}\n          options={schema.databases}\n          value={schema.databases.find((v) => v.value === jsonData.defaultDatabase)}\n          onChange={(change: SelectableValue<string>) => updateJsonData('defaultDatabase', change.value || '')}\n        />\n      </InlineField>\n\n      <InlineField label=\"Use managed schema\" labelWidth={26}>\n        <InlineSwitch\n          id=\"adx-use-schema-mapping\"\n          value={jsonData.useSchemaMapping}\n          onChange={(ev: React.ChangeEvent<HTMLInputElement>) => updateJsonData('useSchemaMapping', ev.target.checked)}\n        />\n      </InlineField>\n\n      {jsonData.useSchemaMapping && (\n        <InlineField label=\"Schema mappings\" labelWidth={26}>\n          <VerticalGroup spacing=\"xs\">\n            {mappings.map((mapping, index) => (\n              <HorizontalGroup spacing=\"xs\" key={index}>\n                <Select\n                  value={schema.schemaMappingOptions.find((v) => v.value === mapping.value)}\n                  options={schema.schemaMappingOptions}\n                  onChange={(change) => handleMappingTargetChange(index, change)}\n                  width={38}\n                  placeholder=\"Target\"\n                />\n\n                <InlineLabel>\n                  <Icon name=\"arrow-right\" />\n                </InlineLabel>\n                <Input\n                  placeholder=\"Name\"\n                  value={mapping.displayName}\n                  onChange={(ev: React.ChangeEvent<HTMLInputElement>) =>\n                    handleMappingNameChange(index, ev.target.value)\n                  }\n                />\n                <Button\n                  variant=\"secondary\"\n                  size=\"md\"\n                  icon=\"trash-alt\"\n                  aria-label=\"Remove\"\n                  type=\"button\"\n                  onClick={() => handleRemoveMapping(index)}\n                ></Button>\n              </HorizontalGroup>\n            ))}\n\n            <Button variant=\"secondary\" size=\"md\" onClick={handleAddNewMapping} type=\"button\">\n              Add mapping\n            </Button>\n          </VerticalGroup>\n        </InlineField>\n      )}\n\n      <br />\n\n      <Button variant=\"primary\" onClick={onRefresh} type=\"button\" icon=\"sync\">\n        Reload schema\n      </Button>\n    </FieldSet>\n  );\n};\n\nexport default DatabaseConfig;\n","import { DataSourcePluginOptionsEditorProps, SelectableValue } from '@grafana/data';\nimport { FieldSet, InlineField, InlineSwitch, Input, Select } from '@grafana/ui';\nimport React, { useEffect } from 'react';\nimport { AdxDataSourceOptions, AdxDataSourceSecureOptions, EditorMode } from 'types';\n\ninterface QueryConfigProps\n  extends DataSourcePluginOptionsEditorProps<AdxDataSourceOptions, AdxDataSourceSecureOptions> {\n  updateJsonData: <T extends keyof AdxDataSourceOptions>(fieldName: T, value: AdxDataSourceOptions[T]) => void;\n}\n\nconst dataConsistencyOptions: Array<{ value: string; label: string }> = [\n  { value: 'strongconsistency', label: 'Strong' },\n  { value: 'weakconsistency', label: 'Weak' },\n];\n\nconst editorModeOptions: Array<{ value: EditorMode; label: string }> = [\n  { value: EditorMode.Visual, label: 'Visual' },\n  { value: EditorMode.Raw, label: 'Raw' },\n];\n\nconst QueryConfig: React.FC<QueryConfigProps> = ({ options, updateJsonData }) => {\n  const { jsonData } = options;\n\n  // Set some default values\n  useEffect(() => {\n    if (!jsonData.dataConsistency) {\n      updateJsonData('dataConsistency', dataConsistencyOptions[0].value);\n    }\n    if (!jsonData.defaultEditorMode) {\n      updateJsonData('defaultEditorMode', editorModeOptions[0].value);\n    }\n  }, [jsonData.dataConsistency, jsonData.defaultEditorMode, updateJsonData]);\n\n  return (\n    <FieldSet label=\"Query Optimizations\">\n      <InlineField label=\"Query timeout\" labelWidth={26} tooltip=\"This value controls the client query timeout.\">\n        <Input\n          value={jsonData.queryTimeout}\n          id=\"adx-query-timeout\"\n          placeholder=\"30s\"\n          width={18}\n          onChange={(ev: React.ChangeEvent<HTMLInputElement>) => updateJsonData('queryTimeout', ev.target.value)}\n        />\n      </InlineField>\n\n      <InlineField\n        label=\"Use dynamic caching\"\n        labelWidth={26}\n        tooltip=\"By enabling this feature Grafana will dynamically apply cache settings on a per query basis and the default cache max age will be ignored.<br /><br />For time series queries we will use the bin size to widen the time range but also as cache max age.\"\n      >\n        <InlineSwitch\n          value={jsonData.dynamicCaching}\n          id=\"adx-caching\"\n          transparent={false}\n          onChange={(ev: React.ChangeEvent<HTMLInputElement>) => updateJsonData('dynamicCaching', ev.target.checked)}\n        />\n      </InlineField>\n\n      <InlineField\n        label=\"Cache max age\"\n        labelWidth={26}\n        tooltip=\"By default the cache is disabled. If you want to enable the query caching please specify a max timespan for the cache to live.\"\n      >\n        <Input\n          value={jsonData.cacheMaxAge}\n          id=\"adx-cache-age\"\n          placeholder=\"0m\"\n          width={18}\n          onChange={(ev: React.ChangeEvent<HTMLInputElement>) => updateJsonData('cacheMaxAge', ev.target.value)}\n        />\n      </InlineField>\n\n      <InlineField label=\"Data consistency\" labelWidth={26} tooltip=\"Defaults to Strong\">\n        <Select\n          options={dataConsistencyOptions}\n          value={dataConsistencyOptions.find((v) => v.value === jsonData.dataConsistency)}\n          onChange={(change: SelectableValue<string>) =>\n            updateJsonData('dataConsistency', change.value ? change.value : dataConsistencyOptions[0].value)\n          }\n          isClearable={false}\n          width={18}\n        />\n      </InlineField>\n\n      <InlineField label=\"Default editor mode\" labelWidth={26} tooltip=\"Defaults to Visual\">\n        <Select\n          options={editorModeOptions}\n          value={editorModeOptions.find((v) => v.value === jsonData.defaultEditorMode)}\n          onChange={(change: SelectableValue<EditorMode>) =>\n            updateJsonData('defaultEditorMode', change.value || EditorMode.Visual)\n          }\n          width={18}\n        />\n      </InlineField>\n    </FieldSet>\n  );\n};\n\nexport default QueryConfig;\n","import { AdxDataSource } from 'datasource';\nimport { SchemaMappingOption, SchemaMappingType } from '../../types';\n\nexport interface Schema {\n  databases: Array<{\n    label: string;\n    value: string;\n  }>;\n  schemaMappingOptions: SchemaMappingOption[];\n}\n\nexport async function refreshSchema(datasource: AdxDataSource): Promise<Schema> {\n  const databases: Array<{ label: string; value: string }> = [];\n  const schemaMappingOptions: SchemaMappingOption[] = [];\n\n  const schema = await datasource.getSchema();\n  for (const database of Object.values(schema.Databases)) {\n    databases.push({\n      label: database.Name,\n      value: database.Name,\n    });\n\n    for (const table of Object.values(database.Tables)) {\n      schemaMappingOptions.push({\n        type: SchemaMappingType.table,\n        label: `${database.Name}/tables/${table.Name}`,\n        value: table.Name,\n        name: table.Name,\n        database: database.Name,\n      });\n    }\n\n    for (const func of Object.values(database.Functions)) {\n      schemaMappingOptions.push({\n        type: SchemaMappingType.function,\n        label: `${database.Name}/functions/${func.Name}`,\n        value: func.Name,\n        name: func.Name,\n        input: func.InputParameters,\n        database: database.Name,\n      });\n    }\n\n    for (const view of Object.values(database.MaterializedViews)) {\n      schemaMappingOptions.push({\n        type: SchemaMappingType.materializedView,\n        label: `${database.Name}/materializedViews/${view.Name}`,\n        value: view.Name,\n        name: view.Name,\n        database: database.Name,\n      });\n    }\n  }\n\n  return { databases, schemaMappingOptions };\n}\n","import { DataSourcePluginOptionsEditorProps } from '@grafana/data';\nimport { FieldSet, InlineField, InlineSwitch } from '@grafana/ui';\nimport React from 'react';\nimport { AdxDataSourceOptions, AdxDataSourceSecureOptions } from 'types';\n\ninterface TrackingConfigProps\n  extends DataSourcePluginOptionsEditorProps<AdxDataSourceOptions, AdxDataSourceSecureOptions> {\n  updateJsonData: <T extends keyof AdxDataSourceOptions>(fieldName: T, value: AdxDataSourceOptions[T]) => void;\n}\n\nconst TrackingConfig: React.FC<TrackingConfigProps> = ({ options, updateJsonData }) => {\n  const { jsonData } = options;\n\n  return (\n    <FieldSet label=\"Tracking\">\n      <InlineField\n        label=\"Send username header to host\"\n        labelWidth={26}\n        tooltip={\n          <p>\n            With this feature enabled, Grafana will pass the logged in user&#39;s username in the{' '}\n            <code>x-ms-user-id</code> header and in the <code>x-ms-client-request-id</code> header when sending requests\n            to ADX. Can be useful when tracking needs to be done in ADX.{' '}\n          </p>\n        }\n      >\n        <InlineSwitch\n          id=\"adx-username-header\"\n          value={jsonData.enableUserTracking}\n          onChange={(ev: React.ChangeEvent<HTMLInputElement>) =>\n            updateJsonData('enableUserTracking', ev.target.checked)\n          }\n        />\n      </InlineField>\n    </FieldSet>\n  );\n};\n\nexport default TrackingConfig;\n","import React, { useEffect, useState, useCallback } from 'react';\nimport { DataSourcePluginOptionsEditorProps } from '@grafana/data';\nimport { FetchResponse, getDataSourceSrv } from '@grafana/runtime';\nimport ConfigHelp from 'components/ConfigEditor/ConfigHelp';\nimport { AdxDataSourceOptions, AdxDataSourceSecureOptions } from 'types';\nimport ConnectionConfig from './ConnectionConfig';\nimport DatabaseConfig from './DatabaseConfig';\nimport QueryConfig from './QueryConfig';\nimport { refreshSchema, Schema } from './refreshSchema';\nimport TrackingConfig from './TrackingConfig';\nimport { Alert } from '@grafana/ui';\nimport { AdxDataSource } from 'datasource';\n\nexport interface ConfigEditorProps\n  extends DataSourcePluginOptionsEditorProps<AdxDataSourceOptions, AdxDataSourceSecureOptions> {}\n\ntype FetchErrorResponse = FetchResponse<{\n  error?: string;\n  message?: string;\n  response?: string;\n}>;\n\nconst ConfigEditor: React.FC<ConfigEditorProps> = (props) => {\n  const { options, onOptionsChange } = props;\n  const [schema, setSchema] = useState<Schema>({ databases: [], schemaMappingOptions: [] });\n  const [schemaError, setSchemaError] = useState<FetchErrorResponse['data']>();\n  const { jsonData } = options;\n\n  const getDatasource = useCallback(async (): Promise<AdxDataSource> => {\n    const datasource = await getDataSourceSrv().get(options.name);\n    return datasource as unknown as AdxDataSource;\n  }, [options.name]);\n\n  const updateSchema = useCallback(async () => {\n    // no credentials, can't request datasource yet\n    if (!options.secureJsonFields || Object.keys(options.secureJsonFields).length === 0) {\n      return;\n    }\n\n    try {\n      const datasource = await getDatasource();\n      const schemaData = await refreshSchema(datasource);\n\n      if (!schemaData) {\n        return;\n      }\n\n      setSchema(schemaData);\n      setSchemaError(undefined);\n    } catch (err: any) {\n      // TODO: make sure err.data is the format we are expecting\n      setSchemaError(err.data);\n    }\n  }, [getDatasource, options.secureJsonFields]);\n\n  const updateJsonData = useCallback(\n    <T extends keyof AdxDataSourceOptions>(fieldName: T, value: AdxDataSourceOptions[T]) => {\n      onOptionsChange({\n        ...options,\n        jsonData: {\n          ...jsonData,\n          [fieldName]: value,\n        },\n      });\n    },\n    [jsonData, onOptionsChange, options]\n  );\n\n  useEffect(() => {\n    options.id && updateSchema();\n  }, [options.id, updateSchema]);\n\n  useEffect(() => {\n    if (!jsonData.defaultDatabase && schema?.databases.length) {\n      updateJsonData('defaultDatabase', schema?.databases[0].value);\n    }\n  }, [schema?.databases, jsonData.defaultDatabase, updateJsonData]);\n\n  const handleClearClientSecret = useCallback(() => {\n    onOptionsChange({\n      ...options,\n      secureJsonData: {\n        ...options.secureJsonData,\n        clientSecret: false,\n      },\n      secureJsonFields: {\n        ...options.secureJsonFields,\n        clientSecret: false,\n      },\n    });\n  }, [onOptionsChange, options]);\n\n  return (\n    <div data-testid=\"azure-data-explorer-config-editor\">\n      <ConfigHelp />\n\n      <ConnectionConfig\n        options={options}\n        onOptionsChange={onOptionsChange}\n        updateJsonData={updateJsonData}\n        handleClearClientSecret={handleClearClientSecret}\n      />\n\n      <QueryConfig options={options} onOptionsChange={onOptionsChange} updateJsonData={updateJsonData} />\n\n      <DatabaseConfig\n        schema={schema}\n        options={options}\n        onOptionsChange={onOptionsChange}\n        updateJsonData={updateJsonData}\n        onRefresh={updateSchema}\n      />\n\n      <TrackingConfig options={options} onOptionsChange={onOptionsChange} updateJsonData={updateJsonData} />\n\n      {schemaError && (\n        <Alert severity=\"error\" title=\"Error updating Azure Data Explorer schema\">\n          {schemaError.message}\n        </Alert>\n      )}\n    </div>\n  );\n};\n\nexport default ConfigEditor;\n","export enum QueryEditorPropertyType {\n  Number = 'number',\n  String = 'string',\n  Boolean = 'boolean',\n  DateTime = 'dateTime',\n  TimeSpan = 'timeSpan',\n  Function = 'function',\n  Interval = 'interval',\n}\n\nexport interface QueryEditorProperty {\n  type: QueryEditorPropertyType;\n  name: string;\n}\n\nexport type QueryEditorOperatorType = string | boolean | number;\ntype QueryEditorOperatorValueType = QueryEditorOperatorType | QueryEditorOperatorType[];\n\nexport interface QueryEditorOperator<T = QueryEditorOperatorValueType> {\n  name: string;\n  value: T;\n}\n\nexport interface QueryEditorOperatorDefinition {\n  value: string;\n  supportTypes: QueryEditorPropertyType[];\n  multipleValues: boolean;\n  booleanValues: boolean;\n  label?: string;\n  description?: string;\n}\n\nexport interface QueryEditorPropertyDefinition {\n  value: string;\n  type: QueryEditorPropertyType;\n  label?: string;\n  dynamic?: boolean;\n}\n\nexport interface QueryEditorFunctionDefinition extends QueryEditorPropertyDefinition {\n  parameters?: QueryEditorFunctionParameter[];\n  applyOnField: boolean;\n}\n\nexport interface QueryEditorFunctionParameter {\n  name: string;\n  type: QueryEditorPropertyType;\n  description: string;\n  value?: string;\n}\n","import { DataFrame, MetricFindValue, FieldType } from '@grafana/data';\n\nexport function firstStringFieldToMetricFindValue(frame: DataFrame): MetricFindValue[] {\n  const values: MetricFindValue[] = [];\n  const field = frame.fields.find((f) => f.type === FieldType.string);\n  if (field) {\n    for (let i = 0; i < field.values.length; i++) {\n      values.push({ text: field.values.get(i) });\n    }\n  }\n  return values;\n}\n","import {\n  QueryEditorReduceExpression,\n  QueryEditorPropertyExpression,\n  QueryEditorFunctionParameterExpression,\n  QueryEditorOperatorExpression,\n  QueryEditorGroupByExpression,\n  QueryEditorExpression,\n  QueryEditorExpressionType,\n  QueryEditorArrayExpression,\n} from './expressions';\nimport { QueryEditorPropertyType, QueryEditorOperator } from './types';\n\nexport const isReduceExpression = (expression?: QueryEditorExpression): expression is QueryEditorReduceExpression => {\n  return expression?.type === QueryEditorExpressionType.Reduce;\n};\n\nexport const isFieldExpression = (expression: QueryEditorExpression): expression is QueryEditorPropertyExpression => {\n  return expression?.type === QueryEditorExpressionType.Property;\n};\n\nexport const isFunctionParameterExpression = (\n  expression?: QueryEditorExpression\n): expression is QueryEditorFunctionParameterExpression => {\n  return (expression as QueryEditorFunctionParameterExpression)?.type === QueryEditorExpressionType.FunctionParameter;\n};\n\nexport const isFieldAndOperator = (expression?: QueryEditorExpression): expression is QueryEditorOperatorExpression => {\n  return expression?.type === QueryEditorExpressionType.Operator;\n};\n\nexport const isGroupBy = (expression?: QueryEditorExpression): expression is QueryEditorGroupByExpression => {\n  return expression?.type === QueryEditorExpressionType.GroupBy;\n};\n\nexport const isDateGroupBy = (expression: QueryEditorExpression): boolean => {\n  return (expression as QueryEditorGroupByExpression)?.property?.type === QueryEditorPropertyType.DateTime;\n};\n\nexport const isBoolOperator = (operator: QueryEditorOperator | undefined): operator is QueryEditorOperator<boolean> => {\n  return typeof operator?.value === 'boolean';\n};\n\nexport const isNumberOperator = (\n  operator: QueryEditorOperator | undefined,\n  propertyType: QueryEditorPropertyType | undefined\n): operator is QueryEditorOperator<number> => {\n  return propertyType === QueryEditorPropertyType.Number && typeof operator?.value === 'number';\n};\n\nexport const isDateTimeOperator = (\n  operator: QueryEditorOperator | undefined,\n  propertyType: QueryEditorPropertyType | undefined\n): operator is QueryEditorOperator<string> => {\n  return propertyType === QueryEditorPropertyType.DateTime && typeof operator?.value === 'string';\n};\n\nexport const isMultiOperator = (operator?: QueryEditorOperator): operator is QueryEditorOperator<string[]> => {\n  return Array.isArray(operator?.value);\n};\n\nexport const isSingleOperator = (operator?: QueryEditorOperator): operator is QueryEditorOperator<string> => {\n  return !isMultiOperator(operator);\n};\n\nexport const isAndExpression = (expression?: QueryEditorExpression): expression is QueryEditorArrayExpression => {\n  return expression?.type === QueryEditorExpressionType.And;\n};\n\nexport const isOrExpression = (expression?: QueryEditorExpression): expression is QueryEditorArrayExpression => {\n  return expression?.type === QueryEditorExpressionType.Or;\n};\n\nexport const isArrayExpression = (expression?: QueryEditorExpression): expression is QueryEditorArrayExpression => {\n  return isAndExpression(expression) || isOrExpression(expression);\n};\n","import { QueryExpression, AdxColumnSchema, AutoCompleteQuery } from './types';\nimport { QueryEditorPropertyType } from 'editor/types';\nimport { getTemplateSrv, TemplateSrv } from '@grafana/runtime';\nimport {\n  isReduceExpression,\n  isFieldAndOperator,\n  isGroupBy,\n  isOrExpression,\n  isAndExpression,\n  isArrayExpression,\n} from './editor/guards';\nimport {\n  QueryEditorExpression,\n  QueryEditorOperatorExpression,\n  QueryEditorArrayExpression,\n  QueryEditorPropertyExpression,\n} from './editor/expressions';\nimport { cloneDeep } from 'lodash';\n\ninterface ParseContext {\n  timeColumn?: string;\n  castIfDynamic: (column: string, schemaName?: string) => string;\n}\n\nexport const DYNAMIC_TYPE_ARRAY_DELIMITER = '[\"`indexer`\"]';\n\nexport class KustoExpressionParser {\n  constructor(private templateSrv: TemplateSrv = getTemplateSrv()) {}\n\n  toAutoCompleteQuery(query?: AutoCompleteQuery, tableSchema?: AdxColumnSchema[]): string {\n    if (!query?.expression || !query.expression.from || !query.search.property) {\n      return '';\n    }\n\n    const context: ParseContext = {\n      timeColumn: defaultTimeColumn(tableSchema, query?.expression),\n      castIfDynamic: (column: string, schemaName?: string) => castIfDynamic(column, tableSchema, schemaName),\n    };\n\n    const parts: string[] = [];\n    this.appendProperty(context, query.expression.from, parts);\n    this.appendTimeFilter(context, undefined, parts);\n\n    const where = replaceByIndex(query.index, query.expression.where, query.search);\n    const column = query.search.property.name;\n    this.appendWhere(context, where, parts, 'where');\n\n    parts.push('take 50000');\n    parts.push(`distinct ${context.castIfDynamic(column)}`);\n    parts.push('take 251');\n\n    return parts.join('\\n| ');\n  }\n\n  toQuery(expression?: QueryExpression, tableSchema?: AdxColumnSchema[]): string {\n    if (!expression || !expression.from) {\n      return '';\n    }\n\n    const context: ParseContext = {\n      timeColumn: defaultTimeColumn(tableSchema, expression),\n      castIfDynamic: (column: string, schemaName?: string) => castIfDynamic(column, tableSchema, schemaName),\n    };\n\n    const parts: string[] = [];\n    this.appendProperty(context, expression.from, parts);\n    this.appendTimeFilter(context, expression.timeshift, parts);\n    this.appendWhere(context, expression?.where, parts, 'where');\n    this.appendTimeshift(context, expression.timeshift, parts);\n    this.appendSummarize(context, expression.reduce, expression.groupBy, parts);\n    this.appendOrderBy(context, expression.groupBy, expression.reduce, parts);\n\n    if (parts.length === 0) {\n      return '';\n    }\n\n    return parts.join('\\n| ');\n  }\n\n  private appendTimeshift(\n    context: ParseContext,\n    expression: QueryEditorPropertyExpression | undefined,\n    parts: string[]\n  ) {\n    const timeshift = detectTimeshift(context, expression);\n\n    if (!timeshift) {\n      return;\n    }\n    parts.push(`extend ${context.timeColumn} = ${context.timeColumn} + ${timeshift}`);\n  }\n\n  private appendTimeFilter(\n    context: ParseContext,\n    expression: QueryEditorPropertyExpression | undefined,\n    parts: string[]\n  ) {\n    if (!context.timeColumn) {\n      return;\n    }\n\n    const timeshift = detectTimeshift(context, expression);\n\n    if (timeshift) {\n      parts.push(`where ${context.timeColumn} between (($__timeFrom - ${timeshift}) .. ($__timeTo - ${timeshift}))`);\n      return;\n    }\n\n    if (isDynamic(context.timeColumn)) {\n      parts.push(`where ${context.timeColumn} between ($__timeFrom .. $__timeTo)`);\n      return;\n    }\n\n    parts.push(`where $__timeFilter(${context.timeColumn})`);\n  }\n\n  private appendOrderBy(\n    context: ParseContext,\n    groupBy: QueryEditorArrayExpression,\n    reduce: QueryEditorArrayExpression,\n    parts: string[]\n  ) {\n    if (!context.timeColumn) {\n      return;\n    }\n\n    const noGroupBy = Array.isArray(groupBy.expressions) && groupBy.expressions.length === 0;\n    const noReduce = Array.isArray(reduce.expressions) && reduce.expressions.length === 0;\n\n    if (noGroupBy && noReduce) {\n      parts.push(`order by ${context.timeColumn} asc`);\n      return;\n    }\n\n    const hasInterval = groupBy.expressions.find((exp) => {\n      if (!isGroupBy(exp) || !exp.interval) {\n        return false;\n      }\n      return true;\n    });\n\n    if (hasInterval) {\n      parts.push(`order by ${context.timeColumn} asc`);\n      return;\n    }\n  }\n\n  private appendWhere(\n    context: ParseContext,\n    expression: QueryEditorExpression | undefined,\n    parts: string[],\n    prefix?: string,\n    expandParts?: string[]\n  ) {\n    if (!expression) {\n      return;\n    }\n    const eParts = expandParts ? expandParts : [];\n\n    if (isAndExpression(expression)) {\n      return expression.expressions.forEach((exp) => this.appendWhere(context, exp, parts, prefix, eParts));\n    }\n\n    if (isOrExpression(expression)) {\n      const orParts: string[] = [];\n      expression.expressions.map((exp) => this.appendWhere(context, exp, orParts, undefined, eParts));\n      if (orParts.length === 0) {\n        return;\n      }\n      this.appendMvExpand(eParts, parts);\n      parts.push(`where ${orParts.join(' or ')}`);\n      this.appendProjectAway(eParts, parts);\n    }\n\n    if (isFieldAndOperator(expression)) {\n      return this.appendOperator(expression, parts, eParts, prefix);\n    }\n  }\n\n  private appendSummarize(\n    context: ParseContext,\n    reduce: QueryEditorArrayExpression | undefined,\n    groupBy: QueryEditorArrayExpression | undefined,\n    parts: string[]\n  ) {\n    let countAddedInReduce = false;\n    const reduceParts: string[] = [];\n    const groupByParts: string[] = [];\n    const expandParts: string[] = [];\n    const columns: string[] = [];\n\n    for (const expression of reduce?.expressions ?? []) {\n      if (!isReduceExpression(expression)) {\n        continue;\n      }\n\n      const func = expression.reduce.name;\n      const parameters = expression.parameters;\n      const name = this.addExpanPartsdIfNeeded(expression.property.name, expandParts);\n      const column = context.castIfDynamic(name, expression.property.name);\n      columns.push(column);\n\n      if (Array.isArray(parameters)) {\n        const funcParams = parameters.map((p) => this.formatValue(p.value, p.fieldType)).join(', ');\n        reduceParts.push(`${func}(${column}, ${funcParams})`);\n        continue;\n      }\n\n      if (func === 'count') {\n        if (!countAddedInReduce) {\n          countAddedInReduce = true;\n          reduceParts.push('count()');\n        }\n        continue;\n      }\n\n      if (func !== 'none') {\n        reduceParts.push(`${func}(${column})`);\n        continue;\n      }\n    }\n\n    for (const expression of groupBy?.expressions ?? []) {\n      if (!isGroupBy(expression)) {\n        continue;\n      }\n\n      const name = this.addExpanPartsdIfNeeded(expression.property.name, expandParts);\n      const column = context.castIfDynamic(name, expression.property.name);\n\n      if (expression.interval) {\n        const interval = expression.interval.name;\n        groupByParts.unshift(`bin(${column}, ${interval})`);\n        continue;\n      }\n\n      groupByParts.push(column);\n    }\n\n    this.appendMvExpand(expandParts, parts);\n\n    if (reduceParts.length > 0) {\n      if (groupByParts.length > 0) {\n        parts.push(`summarize ${reduceParts.join(', ')} by ${groupByParts.join(', ')}`);\n        return;\n      }\n      parts.push(`summarize ${reduceParts.join(', ')}`);\n      return;\n    }\n\n    if (groupByParts.length > 0) {\n      parts.push(`summarize by ${groupByParts.join(', ')}`);\n      return;\n    }\n\n    if (columns.length > 0) {\n      parts.push(`project ${columns.join(', ')}`);\n      return;\n    }\n  }\n\n  private appendOperator(\n    expression: QueryEditorOperatorExpression,\n    parts: string[],\n    expandParts: string[],\n    prefix?: string\n  ) {\n    const { property, operator } = expression;\n\n    if (!property.name || !operator.name) {\n      return;\n    }\n\n    switch (operator.name) {\n      case 'isnotempty':\n        parts.push(withPrefix(`${operator.name}(${property.name})`, prefix));\n        break;\n\n      default:\n        const value = this.formatValue(operator.value, property.type);\n        const name = this.addExpanPartsdIfNeeded(property.name, expandParts);\n        parts.push(withPrefix(`${name} ${operator.name} ${value}`, prefix));\n        break;\n    }\n  }\n\n  private formatValue(value: any, type: QueryEditorPropertyType): string {\n    if (Array.isArray(value)) {\n      return `(${value.map((v) => this.formatValue(v, type)).join(', ')})`;\n    }\n\n    if (this.isTemplateVariable(value)) {\n      return value;\n    }\n\n    switch (type) {\n      case QueryEditorPropertyType.Number:\n      case QueryEditorPropertyType.Boolean:\n        return value;\n      default:\n        return `'${value}'`;\n    }\n  }\n\n  private addExpanPartsdIfNeeded(name: string, parts: string[]) {\n    if (name.includes(DYNAMIC_TYPE_ARRAY_DELIMITER)) {\n      const arrayElemParts = name.split(DYNAMIC_TYPE_ARRAY_DELIMITER);\n      const arrayLength = parts.push(arrayElemParts[0]);\n      const res = name.replace(`${parts[arrayLength - 1]}${DYNAMIC_TYPE_ARRAY_DELIMITER}`, `array_${arrayLength}`);\n      if (res.includes(DYNAMIC_TYPE_ARRAY_DELIMITER)) {\n        return this.addExpanPartsdIfNeeded(res, parts);\n      }\n      return res;\n    }\n    return name;\n  }\n\n  private appendMvExpand(expandParts: string[], parts: string[]) {\n    expandParts.forEach((p, i) => parts.push(`mv-expand array_${i + 1} = ${p}`));\n  }\n\n  private appendProjectAway(expandParts: string[], parts: string[]) {\n    if (expandParts.length) {\n      // mv-expand creates a new column that we need to delete from the result\n      const arrayCols = expandParts.map((p, i) => `array_${i + 1}`);\n      parts.push(`project-away ${arrayCols.join(', ')}`);\n    }\n  }\n\n  private appendProperty(context: ParseContext, expression: QueryEditorPropertyExpression, parts: string[]) {\n    parts.push(this.formatProperty(expression.property.name));\n  }\n\n  private formatProperty(property: string): string {\n    const specialCharacters = /[\\s\\.-]/; // space, dot, or dash\n    const schemaMappingCharacters = /[\\$\\(]/; // $ or (\n\n    if (specialCharacters.test(property) && !schemaMappingCharacters.test(property)) {\n      return `['${property}']`;\n    }\n\n    return property;\n  }\n\n  private isTemplateVariable(value: string): boolean {\n    if (!Array.isArray(this.templateSrv.getVariables())) {\n      return false;\n    }\n\n    return !!this.templateSrv.getVariables().find((variable: any) => {\n      return `$${variable?.id}` === value;\n    });\n  }\n}\n\nconst withPrefix = (value: string, prefix?: string): string => {\n  if (prefix) {\n    return `${prefix} ${value}`;\n  }\n  return value;\n};\n\nconst defaultTimeColumn = (columns?: AdxColumnSchema[], expression?: QueryExpression): string | undefined => {\n  if (Array.isArray(expression?.groupBy.expressions)) {\n    const groupByTimeColumn = expression?.groupBy.expressions.find((exp) => {\n      if (!isGroupBy(exp)) {\n        return false;\n      }\n      return exp.property.type === QueryEditorPropertyType.DateTime && exp.interval;\n    });\n\n    if (isGroupBy(groupByTimeColumn)) {\n      return castIfDynamic(groupByTimeColumn.property.name, columns);\n    }\n  }\n\n  if (!Array.isArray(columns)) {\n    return;\n  }\n\n  const firstLevelColumn = columns?.find((col) => {\n    return col.CslType === 'datetime' && col.Name.indexOf('[') === -1;\n  });\n\n  if (firstLevelColumn) {\n    return firstLevelColumn?.Name;\n  }\n\n  const column = columns?.find((col) => col.CslType === 'datetime');\n\n  if (!column) {\n    return column;\n  }\n\n  return toType(column.CslType, column.Name);\n};\n\nconst isDynamic = (column: string): boolean => {\n  return !!(column && column.indexOf('[') > -1) || !!(column && column.indexOf('todynamic') > -1);\n};\n\nconst castIfDynamic = (column: string, tableSchema?: AdxColumnSchema[], schemaName?: string): string => {\n  if (!isDynamic(schemaName || column) || !Array.isArray(tableSchema)) {\n    return column;\n  }\n\n  const columnSchema = tableSchema.find((c) => c.Name === (schemaName || column));\n\n  if (!columnSchema) {\n    return column;\n  }\n\n  return toType(columnSchema.CslType, column);\n};\n\nconst toType = (type: string, name: string): string => {\n  return `to${type}(${name})`;\n};\n\nconst replaceByIndex = (\n  index: string,\n  expression: QueryEditorArrayExpression,\n  operator: QueryEditorOperatorExpression\n): QueryEditorArrayExpression => {\n  const keys = index.split('-').map((n) => parseInt(n, 10));\n\n  let where = cloneDeep(expression);\n  let current = where.expressions;\n\n  for (let index = 0; index < keys.length; index++) {\n    const key = keys[index];\n\n    if (index === keys.length - 1) {\n      current[key] = operator;\n      break;\n    }\n\n    if (Array.isArray(current)) {\n      const exp = current[key];\n\n      if (isArrayExpression(exp)) {\n        current = exp.expressions;\n        continue;\n      }\n    }\n  }\n\n  return where;\n};\n\nconst isValidTimeSpan = (value: string) => {\n  return /^(\\d{1,15}(?:d|h|ms|s|m){0,1})$/gm.test(value);\n};\n\nconst detectTimeshift = (\n  context: ParseContext,\n  timeshift: QueryEditorPropertyExpression | undefined\n): string | null => {\n  if (!timeshift || !context.timeColumn || !timeshift.property) {\n    return null;\n  }\n\n  const timeshiftWith = timeshift.property.name;\n\n  if (!isValidTimeSpan(timeshiftWith)) {\n    return null;\n  }\n  return timeshiftWith;\n};\n","import { SelectableValue } from '@grafana/data';\nimport { DYNAMIC_TYPE_ARRAY_DELIMITER } from 'KustoExpressionParser';\nimport { escapeRegExp } from 'lodash';\n\nimport { QueryEditorPropertyDefinition, QueryEditorPropertyType } from '../editor/types';\nimport { AdxColumnSchema, AdxDatabaseSchema, AdxTableSchema } from '../types';\n\nexport const tableToDefinition = (table: AdxTableSchema): QueryEditorPropertyDefinition => {\n  return {\n    label: table.Name,\n    value: table.Name,\n    type: QueryEditorPropertyType.String,\n  };\n};\n\nexport const tableToSelectable = (table: AdxTableSchema): SelectableValue<string> => {\n  return {\n    label: table.Name,\n    value: table.Name,\n  };\n};\n\nexport const databaseToDefinition = (database: AdxDatabaseSchema): QueryEditorPropertyDefinition => {\n  return {\n    value: database.Name,\n    label: database.Name,\n    type: QueryEditorPropertyType.String,\n  };\n};\n\nexport const databasesToDefinition = (databases: AdxDatabaseSchema[]): QueryEditorPropertyDefinition[] => {\n  if (!Array.isArray(databases)) {\n    return [];\n  }\n  return databases.map(databaseToDefinition);\n};\n\nexport const tablesToDefinition = (tables: AdxTableSchema[]): QueryEditorPropertyDefinition[] => {\n  if (!Array.isArray(tables)) {\n    return [];\n  }\n\n  return tables.map((table) => ({\n    value: table.Name,\n    label: table.Name,\n    type: QueryEditorPropertyType.String,\n  }));\n};\n\nexport const columnsToDefinition = (columns: AdxColumnSchema[]): QueryEditorPropertyDefinition[] => {\n  if (!Array.isArray(columns)) {\n    return [];\n  }\n\n  return columns.map((column) => {\n    return {\n      value: column.Name,\n      label: column.Name.replace(new RegExp(escapeRegExp(DYNAMIC_TYPE_ARRAY_DELIMITER), 'g'), '[ ]'),\n      type: toPropertyType(column.CslType),\n    };\n  });\n};\n\nconst toPropertyType = (kustoType: string): QueryEditorPropertyType => {\n  switch (kustoType) {\n    case 'real':\n    case 'int':\n    case 'long':\n      return QueryEditorPropertyType.Number;\n    case 'datetime':\n      return QueryEditorPropertyType.DateTime;\n    case 'bool':\n      return QueryEditorPropertyType.Boolean;\n    case 'timespan':\n      return QueryEditorPropertyType.TimeSpan;\n    default:\n      return QueryEditorPropertyType.String;\n  }\n};\n","import { QueryEditorPropertyDefinition, QueryEditorPropertyType } from '../editor/types';\nimport { AdxDatabaseSchema, AdxSchema, SchemaMapping, SchemaMappingType } from '../types';\nimport { tableToDefinition } from './mapper';\n\n// Mappings in the jsonData are partials - they might have undefined fields. We want to ignore them.\nconst validMapping = (mapping: Partial<SchemaMapping>): mapping is SchemaMapping => {\n  return (\n    Object.values(mapping).every((v) => v !== undefined) &&\n    !!mapping.database &&\n    !!mapping.displayName &&\n    !!mapping.name &&\n    !!mapping.type &&\n    !!mapping.value\n  );\n};\n\nexport class AdxSchemaMapper {\n  private mappingsByDatabase: Record<string, SchemaMapping[]> = {};\n  private displayNameToMapping: Record<string, SchemaMapping> = {};\n  private nameToMapping: Record<string, SchemaMapping> = {};\n  private valueToMapping: Record<string, SchemaMapping> = {};\n\n  constructor(private enabled = false, mappings: Array<Partial<SchemaMapping>> = []) {\n    for (const mapping of mappings) {\n      // Skip mappings with empty values\n      if (!validMapping(mapping)) {\n        continue;\n      }\n\n      if (!Array.isArray(this.mappingsByDatabase[mapping.database])) {\n        this.mappingsByDatabase[mapping.database] = [];\n      }\n      this.mappingsByDatabase[mapping.database].push(mapping);\n      this.displayNameToMapping[mapping.displayName] = mapping;\n      this.nameToMapping[mapping.name] = mapping;\n      this.valueToMapping[mapping.value] = mapping;\n    }\n  }\n\n  getMappingByValue(value?: string): SchemaMapping | undefined {\n    if (!this.enabled || !value) {\n      return;\n    }\n    return this.valueToMapping[value];\n  }\n\n  getTableOptions(schema: AdxSchema, databaseName: string): QueryEditorPropertyDefinition[] {\n    const database = schema.Databases[databaseName];\n\n    if (!database || !database.Tables) {\n      return [];\n    }\n\n    if (!this.enabled) {\n      return Object.keys(database.Tables).map((key) => {\n        const table = database.Tables[key];\n        return tableToDefinition(table);\n      });\n    }\n\n    const mappings = this.mappingsByDatabase[databaseName];\n    return filterAndMapToDefinition(database, mappings);\n  }\n}\n\nconst filterAndMapToDefinition = (\n  database: AdxDatabaseSchema,\n  mappings: SchemaMapping[] = []\n): QueryEditorPropertyDefinition[] => {\n  return mappings.reduce((all: QueryEditorPropertyDefinition[], mapping) => {\n    if (mapping.type === SchemaMappingType.table) {\n      if (database.Tables[mapping.name]) {\n        console.log('if (database.Tables[mapping.name])', mapping);\n        all.push(mappingToDefinition(mapping));\n        return all;\n      }\n    }\n\n    if (mapping.type === SchemaMappingType.materializedView) {\n      if (database.MaterializedViews[mapping.name]) {\n        console.log('if (database.MaterializedViews[mapping.name])', mapping);\n        all.push(mappingToDefinition(mapping));\n        return all;\n      }\n    }\n\n    if (mapping.type === SchemaMappingType.function) {\n      if (database.Functions[mapping.name]) {\n        console.log('if (database.Functions[mapping.name])', mapping);\n        all.push(mappingToDefinition(mapping));\n        return all;\n      }\n    }\n\n    return all;\n  }, []);\n};\n\nconst mappingToDefinition = (mapping: SchemaMapping): QueryEditorPropertyDefinition => {\n  return {\n    type: QueryEditorPropertyType.String,\n    label: mapping.displayName,\n    value: mapping.value,\n  };\n};\n","const store: Record<string, any> = {};\n\nexport const cache = async <T>(key: string, resolver: () => Promise<T>, refresh = false): Promise<T> => {\n  if (!store[key] || refresh) {\n    const value = await resolver();\n    store[key] = value;\n  }\n  return store[key];\n};\n\nexport const reset = (keysStartingWith: string): void => {\n  const keys = Object.keys(store);\n\n  for (const key of keys) {\n    if (key.startsWith(keysStartingWith)) {\n      delete store[key];\n    }\n  }\n};\n","import { DataSourceRef } from '@grafana/data';\nimport { KustoQuery, defaultQuery } from 'types';\n\ntype inputAnnotation = {\n  datasource: DataSourceRef | null | undefined;\n  database: string;\n  enable: boolean;\n  name: string;\n  iconColor: string;\n  query?: string;\n  target?: KustoQuery;\n  resultFormat?: string;\n};\n\nexport const migrateAnnotation = (annotation: inputAnnotation) => {\n  if (annotation.target && annotation.target.database !== null) {\n    return annotation;\n  }\n\n  const newQuery: KustoQuery = {\n    ...defaultQuery,\n    ...(annotation.target ?? {}),\n    database: annotation.database,\n    query: annotation.query ?? '',\n    rawMode: true,\n    refId: annotation.target?.refId ?? 'Anno',\n    resultFormat: annotation.resultFormat ?? 'table',\n    pluginVersion: defaultQuery.pluginVersion,\n  };\n\n  return {\n    ...annotation,\n    target: newQuery,\n  };\n};\n","import { ScopedVars } from '@grafana/data';\n\nexport default function interpolateKustoQuery(query: string, scopedVars?: ScopedVars): string {\n  if (!query) {\n    return '';\n  }\n  const macroRegexp = /\\$__([_a-zA-Z0-9]+)\\(([^\\)]*)\\)/gi;\n  const intervalRegexp = /\\$(__interval|__interval_ms)/gi;\n\n  query = query.replace(macroRegexp, (match, p1, p2) => {\n    if (p1 === 'contains') {\n      return getMultiContains(p2);\n    }\n    return match;\n  });\n\n  query = query.replace(intervalRegexp, (match, p1) => {\n    if (!scopedVars) {\n      return match;\n    }\n    const values = scopedVars[p1];\n    return values?.value ?? match;\n  });\n\n  return query.replace(/\\$__escapeMulti\\(('[^]*')\\)/gi, (match, p1) => escape(p1));\n}\n\nfunction getMultiContains(inputs: string) {\n  const firstCommaIndex = inputs.indexOf(',');\n  const field = inputs.substring(0, firstCommaIndex);\n  const templateVar = inputs.substring(inputs.indexOf(',') + 1);\n\n  if (templateVar && templateVar.toLowerCase().trim() === 'all') {\n    return '1 == 1';\n  }\n\n  return `${field.trim()} in (${singleQuote(templateVar.trim())})`;\n}\n\nfunction escape(inputs: string) {\n  return inputs\n    .substring(1, inputs.length - 1)\n    .split(`','`)\n    .map((v) => `@'${v}'`)\n    .join(', ');\n}\n\nfunction singleQuote(input: string) {\n  if (input.match(/,+/i)) {\n    return input.split(',').map(singleQuote).join(',');\n  }\n\n  if (input.match(/^'(.*)'$/i)) {\n    return input;\n  }\n\n  return `'${input}'`;\n}\n","import { AdxSchema } from 'types';\n\nexport interface DataTarget {\n  target: string;\n  datapoints: any[];\n  refId: string;\n  query: any;\n}\n\nexport interface TableResult {\n  columns: TableColumn[];\n  rows: any[];\n  type: string;\n  refId: string;\n  query: string;\n}\n\nexport interface TableColumn {\n  text: string;\n  type: string;\n}\n\nexport interface Variable {\n  text: string;\n  value: string;\n}\n\n// API interfaces\nexport interface KustoDatabaseList {\n  Tables: KustoDatabaseItem[];\n}\n\nexport interface KustoDatabaseItem {\n  TableName: string;\n  Columns: any[];\n  Rows: any[];\n}\n\nexport interface KustoDatabase {\n  Name: string;\n  Tables: { [key: string]: KustoTable };\n  Functions: { [key: string]: KustoFunction };\n}\n\nexport interface KustoTable {\n  Name: string;\n  OrderedColumns: KustoColumn[];\n}\n\nexport interface KustoColumn {\n  Name: string;\n  Type: string;\n}\n\nexport interface KustoFunction {\n  Name: string;\n  DocString: string;\n  Body: string;\n  Folder: string;\n  FunctionKind: string;\n  InputParameters: any[];\n  OutputColumns: any[];\n}\n\n// Internal interfaces\nexport interface DatabaseItem {\n  text: string;\n  value: string;\n}\n\nexport class ResponseParser {\n  parseDatabases(results: KustoDatabaseList): DatabaseItem[] {\n    const databases: DatabaseItem[] = [];\n    if (!results) {\n      return databases;\n    }\n\n    for (const table of results.Tables) {\n      for (const row of table.Rows) {\n        databases.push({ text: row[5] || row[0], value: row[0] });\n      }\n    }\n\n    return databases;\n  }\n\n  parseSchemaResult(results: any) {\n    const schemaJson = results.Tables[0].Rows[0][0];\n    return JSON.parse(schemaJson) as AdxSchema;\n  }\n}\n","import {\n  DataFrame,\n  DataQueryRequest,\n  DataSourceInstanceSettings,\n  MetricFindValue,\n  ScopedVar,\n  ScopedVars,\n  TimeRange,\n} from '@grafana/data';\nimport { BackendSrv, DataSourceWithBackend, getBackendSrv, getTemplateSrv, TemplateSrv } from '@grafana/runtime';\nimport { firstStringFieldToMetricFindValue } from 'common/responseHelpers';\nimport { QueryEditorPropertyExpression } from 'editor/expressions';\nimport { QueryEditorOperator } from 'editor/types';\nimport { KustoExpressionParser } from 'KustoExpressionParser';\nimport { map } from 'lodash';\nimport { AdxSchemaMapper } from 'schema/AdxSchemaMapper';\nimport { cache } from 'schema/cache';\n\nimport { migrateAnnotation } from './migrations/annotation';\nimport interpolateKustoQuery from './query_builder';\nimport { DatabaseItem, KustoDatabaseList, ResponseParser } from './response_parser';\nimport {\n  AdxColumnSchema,\n  AdxDataSourceOptions,\n  AdxSchema,\n  AutoCompleteQuery,\n  defaultQuery,\n  EditorMode,\n  KustoQuery,\n  QueryExpression,\n} from './types';\n\nexport class AdxDataSource extends DataSourceWithBackend<KustoQuery, AdxDataSourceOptions> {\n  private backendSrv: BackendSrv;\n  private templateSrv: TemplateSrv;\n  private defaultOrFirstDatabase: string;\n  private url?: string;\n  private expressionParser: KustoExpressionParser;\n  private defaultEditorMode: EditorMode;\n  private schemaMapper: AdxSchemaMapper;\n\n  constructor(instanceSettings: DataSourceInstanceSettings<AdxDataSourceOptions>) {\n    super(instanceSettings);\n\n    const useSchemaMapping = instanceSettings.jsonData.useSchemaMapping ?? false;\n    const schemaMapping = instanceSettings.jsonData.schemaMappings ?? [];\n\n    this.backendSrv = getBackendSrv();\n    this.templateSrv = getTemplateSrv();\n    this.defaultOrFirstDatabase = instanceSettings.jsonData.defaultDatabase;\n    this.url = instanceSettings.url;\n    this.defaultEditorMode = instanceSettings.jsonData.defaultEditorMode ?? EditorMode.Visual;\n    this.schemaMapper = new AdxSchemaMapper(useSchemaMapping, schemaMapping);\n    this.expressionParser = new KustoExpressionParser(this.templateSrv);\n    this.parseExpression = this.parseExpression.bind(this);\n    this.autoCompleteQuery = this.autoCompleteQuery.bind(this);\n    this.getSchemaMapper = this.getSchemaMapper.bind(this);\n  }\n\n  /**\n   * Return true if it should execute\n   */\n  filterQuery(target: KustoQuery): boolean {\n    if (target.hide || !target.query) {\n      return false;\n    }\n    if (typeof target.rawMode === 'undefined' && target.query) {\n      return true;\n    }\n    if (target.rawMode) {\n      return true; // anything else we can check\n    }\n\n    const tableExpr = target.expression?.from as QueryEditorPropertyExpression;\n    if (!tableExpr) {\n      return false;\n    }\n\n    const table = tableExpr.property?.name;\n    if (!table) {\n      return false; // Don't execute things without a table selected\n    }\n    return true;\n  }\n\n  applyTemplateVariables(target: KustoQuery, scopedVars: ScopedVar): Record<string, any> {\n    let query = interpolateKustoQuery(\n      this.templateSrv.replace(target.query, scopedVars, this.interpolateVariable),\n      scopedVars as ScopedVars\n    );\n\n    return {\n      ...target,\n      query,\n      database: this.templateSrv.replace(target.database, scopedVars),\n    };\n  }\n\n  annotations = {\n    prepareAnnotation: migrateAnnotation,\n  };\n\n  async metricFindQuery(query: string, optionalOptions: any): Promise<MetricFindValue[]> {\n    const databasesQuery = query.match(/^databases\\(\\)/i);\n    if (databasesQuery) {\n      return this.getDatabases();\n    }\n\n    return this.getDefaultOrFirstDatabase()\n      .then((database) => this.buildQuery(query, optionalOptions, database))\n      .then((query) =>\n        this.query({\n          targets: [query],\n        } as DataQueryRequest<KustoQuery>).toPromise()\n      )\n      .then((response) => {\n        if (response.data && response.data.length) {\n          return firstStringFieldToMetricFindValue(response.data[0]);\n        }\n        return [];\n      })\n      .catch((err) => {\n        console.log('There was an error', err);\n        throw err;\n      });\n  }\n\n  async getDatabases(): Promise<DatabaseItem[]> {\n    return this.getResource<KustoDatabaseList>('databases').then((response) => {\n      return new ResponseParser().parseDatabases(response);\n    });\n  }\n\n  async getResource<T = unknown>(path: string): Promise<any> {\n    return super.getResource(path);\n  }\n\n  async getDefaultOrFirstDatabase(): Promise<string> {\n    if (this.defaultOrFirstDatabase) {\n      return Promise.resolve(this.defaultOrFirstDatabase);\n    }\n\n    return this.getDatabases().then((databases) => {\n      this.defaultOrFirstDatabase = databases[0].value;\n      return this.defaultOrFirstDatabase;\n    });\n  }\n\n  async getSchema(refreshCache = false): Promise<AdxSchema> {\n    return cache<AdxSchema>(\n      `${this.id}.schema.overview`,\n      () => this.getResource('schema').then(new ResponseParser().parseSchemaResult),\n      refreshCache\n    );\n  }\n\n  async getFunctionSchema(database: string, targetFunction: string): Promise<AdxColumnSchema[]> {\n    const queryParts: string[] = [];\n    const take = 'take 50000';\n\n    queryParts.push(targetFunction);\n    queryParts.push(take);\n    queryParts.push('getschema');\n\n    const query = this.buildQuery(queryParts.join('\\n | '), {}, database);\n    const response = await this.query({\n      targets: [\n        {\n          ...query,\n          querySource: 'schema',\n        },\n      ],\n    } as DataQueryRequest<KustoQuery>).toPromise();\n\n    return functionSchemaParser(response.data as DataFrame[]);\n  }\n\n  async getDynamicSchema(\n    database: string,\n    source: string,\n    columns: string[]\n  ): Promise<Record<string, AdxColumnSchema[]>> {\n    if (!database || !source || !Array.isArray(columns) || columns.length === 0) {\n      return {};\n    }\n    const queryParts: string[] = [];\n\n    const take = 'take 50000';\n    const where = `where ${columns.map((column) => `isnotnull(${column})`).join(' and ')}`;\n    const project = `project ${columns.map((column) => column).join(', ')}`;\n    const summarize = `summarize ${columns.map((column) => `buildschema(${column})`).join(', ')}`;\n\n    queryParts.push(source);\n    queryParts.push(take);\n    queryParts.push(where);\n    queryParts.push(project);\n    queryParts.push(summarize);\n\n    const query = this.buildQuery(queryParts.join('\\n | '), {}, database);\n    const response = await this.query({\n      targets: [\n        {\n          ...query,\n          querySource: 'schema',\n        },\n      ],\n    } as DataQueryRequest<KustoQuery>).toPromise();\n\n    return dynamicSchemaParser(response.data as DataFrame[]);\n  }\n\n  getVariables() {\n    return this.templateSrv.getVariables().map((v) => `$${v.name}`);\n  }\n\n  // Used for annotations and templage variables\n  private buildQuery(query: string, options: any, database: string): KustoQuery {\n    if (!options) {\n      options = {};\n    }\n    if (!options.hasOwnProperty('scopedVars')) {\n      options.scopedVars = {};\n    }\n\n    const replacedQuery = this.templateSrv.replace(query, options.scopedVars, this.interpolateVariable);\n    const interpolatedQuery = interpolateKustoQuery(replacedQuery, options.scopedVars);\n\n    return {\n      ...defaultQuery,\n      refId: `adx-${interpolatedQuery}`,\n      resultFormat: 'table',\n      rawMode: true,\n      query: interpolatedQuery,\n      database,\n    };\n  }\n\n  // Used to get the schema directly\n  doRequest(url: string, data: any, maxRetries = 1) {\n    return this.backendSrv\n      .datasourceRequest({\n        url: this.url + url,\n        method: 'POST',\n        data: data,\n      })\n      .catch((error) => {\n        if (maxRetries > 0) {\n          return this.doRequest(url, data, maxRetries - 1);\n        }\n\n        throw error;\n      });\n  }\n\n  interpolateVariable(value: any, variable) {\n    if (typeof value === 'string') {\n      if (variable.multi || variable.includeAll) {\n        return \"'\" + value + \"'\";\n      } else {\n        return value;\n      }\n    }\n\n    if (typeof value === 'number') {\n      return value;\n    }\n\n    const quotedValues = map(value, (val) => {\n      if (typeof value === 'number') {\n        return value;\n      }\n\n      return \"'\" + escapeSpecial(val) + \"'\";\n    });\n    return quotedValues.filter((v) => v !== \"''\").join(',');\n  }\n\n  getSchemaMapper(): AdxSchemaMapper {\n    return this.schemaMapper;\n  }\n\n  parseExpression(sections: QueryExpression | undefined, columns: AdxColumnSchema[] | undefined): string {\n    return this.expressionParser.toQuery(sections, columns);\n  }\n\n  getDefaultEditorMode(): EditorMode {\n    return this.defaultEditorMode;\n  }\n\n  async autoCompleteQuery(query: AutoCompleteQuery, columns: AdxColumnSchema[] | undefined): Promise<string[]> {\n    const autoQuery = this.expressionParser.toAutoCompleteQuery(query, columns);\n\n    if (!autoQuery) {\n      return [];\n    }\n\n    const kustQuery: KustoQuery = {\n      ...defaultQuery,\n      refId: `adx-${autoQuery}`,\n      database: query.database,\n      rawMode: true,\n      query: autoQuery,\n      resultFormat: 'table',\n      querySource: 'autocomplete',\n    };\n\n    const response = await this.query(\n      includeTimeRange({\n        targets: [kustQuery],\n      }) as DataQueryRequest<KustoQuery>\n    ).toPromise();\n\n    if (!Array.isArray(response?.data) || response.data.length === 0) {\n      return [];\n    }\n\n    if (!Array.isArray(response.data[0].fields) || response.data[0].fields.length === 0) {\n      return [];\n    }\n\n    const results = response.data[0].fields[0].values.toArray();\n    const operator: QueryEditorOperator<string> = query.search.operator as QueryEditorOperator<string>; // why is this always T = QueryEditorOperatorValueType\n\n    return operator.name === 'contains' ? sortStartsWithValuesFirst(results, operator.value) : results;\n  }\n}\n\nconst functionSchemaParser = (frames: DataFrame[]): AdxColumnSchema[] => {\n  const result: AdxColumnSchema[] = [];\n  const fields = frames[0].fields;\n\n  if (!fields) {\n    return result;\n  }\n\n  const nameIndex = fields.findIndex((f) => f.name === 'ColumnName');\n  const typeIndex = fields.findIndex((f) => f.name === 'ColumnType');\n\n  if (nameIndex < 0 || typeIndex < 0) {\n    return result;\n  }\n\n  for (const frame of frames) {\n    for (let index = 0; index < frame.length; index++) {\n      result.push({\n        Name: frame.fields[nameIndex].values.get(index),\n        CslType: frame.fields[typeIndex].values.get(index),\n      });\n    }\n  }\n\n  return result;\n};\n\nconst dynamicSchemaParser = (frames: DataFrame[]): Record<string, AdxColumnSchema[]> => {\n  const result: Record<string, AdxColumnSchema[]> = {};\n\n  for (const frame of frames) {\n    for (const field of frame.fields) {\n      const json = JSON.parse(field.values.get(0));\n\n      if (json === null) {\n        console.log('error with field', field);\n        continue;\n      }\n\n      const columnSchemas: AdxColumnSchema[] = [];\n      const columnName = field.name.replace('schema_', '');\n      recordSchema(columnName, json, columnSchemas);\n      result[columnName] = columnSchemas;\n    }\n  }\n\n  return result;\n};\n\nconst recordSchema = (columnName: string, schema: any, result: AdxColumnSchema[]) => {\n  if (!schema) {\n    console.log('error with column', columnName);\n    return;\n  }\n\n  for (const name of Object.keys(schema)) {\n    // Generate a valid accessor for a dynamic type\n    // https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/scalar-data-types/dynamic#dynamic-object-accessors\n    const key = `${columnName}[\"${name}\"]`;\n\n    if (typeof schema[name] === 'string') {\n      result.push({\n        Name: key,\n        CslType: schema[name],\n      });\n      continue;\n    }\n\n    if (typeof schema[name] === 'object') {\n      recordSchema(key, schema[name], result);\n    }\n  }\n};\n\n/**\n * this is a suuuper ugly way of doing this.\n */\nconst includeTimeRange = (option: any): any => {\n  const range = (getTemplateSrv() as any)?.timeRange as TimeRange;\n\n  if (!range) {\n    return option;\n  }\n\n  return {\n    ...option,\n    range,\n  };\n};\n\nconst escapeSpecial = (value: string): string => {\n  return value.replace(/\\'/gim, \"\\\\'\");\n};\n\nexport const sortStartsWithValuesFirst = (arr: string[], searchText: string) => {\n  const text = searchText.toLowerCase();\n\n  arr.sort((a, b) => {\n    if (!a && !b) {\n      return 0;\n    }\n\n    if (!a && b) {\n      return -1;\n    }\n\n    if (a && !b) {\n      return 1;\n    }\n\n    const aLower = a.toLowerCase();\n    const bLower = b.toLowerCase();\n\n    if (aLower.startsWith(text) && bLower.startsWith(text)) {\n      return 0;\n    }\n\n    if (aLower.startsWith(text) && !bLower.startsWith(text) && bLower.includes(text, 1)) {\n      return -1;\n    }\n\n    if (aLower.startsWith(text) && !bLower.includes(text, 1)) {\n      return -1;\n    }\n\n    if (!aLower.startsWith(text) && aLower.includes(text, 1) && bLower.startsWith(text)) {\n      return 1;\n    }\n\n    if (!aLower.includes(text, 1) && bLower.startsWith(text)) {\n      return 1;\n    }\n\n    if (aLower.includes(text, 1) && !bLower.includes(text, 1)) {\n      return -1;\n    }\n\n    if (!aLower.includes(text, 1) && bLower.includes(text, 1)) {\n      return 1;\n    }\n\n    return 0;\n  });\n\n  return arr;\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Icon, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nexport const SchemaLoading: React.FC<{}> = (props) => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.icon}>\n        <Icon className=\"spin-clockwise\" name=\"sync\" />\n      </div>\n      <span>One moment, your schema is loading ...</span>\n    </div>\n  );\n};\n\ninterface ErrorProps {\n  message: string;\n}\n\nexport const SchemaError: React.FC<ErrorProps> = (props) => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.icon}>\n        <Icon name=\"exclamation-triangle\" className={styles.error} />\n      </div>\n      <span className={styles.error}>{props.message}</span>\n    </div>\n  );\n};\n\nexport const SchemaWarning: React.FC<ErrorProps> = (props) => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.icon}>\n        <Icon name=\"exclamation-triangle\" className={styles.warning} />\n      </div>\n      <span className={styles.warning}>{props.message}</span>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    margin-top: 10px;\n    display: flex;\n    flex-direction: row;\n  `,\n  icon: css`\n    margin-right: 4px;\n  `,\n  error: css`\n    color: ${theme.v1.colors.formInputBorderInvalid};\n  `,\n  warning: css`\n    color: ${theme.v1.palette.yellow};\n  `,\n});\n","import _ from 'lodash';\nimport { QueryExpression, defaultQuery } from 'types';\nimport {\n  QueryEditorExpressionType,\n  QueryEditorOperatorExpression,\n  QueryEditorExpression,\n  QueryEditorArrayExpression,\n  QueryEditorPropertyExpression,\n  QueryEditorReduceExpression,\n  QueryEditorGroupByExpression,\n} from 'editor/expressions';\nimport { QueryEditorPropertyType, QueryEditorProperty } from 'editor/types';\n\nexport const migrateExpression = (version: string | undefined, expression: any): QueryExpression => {\n  if (looksLikeV2(expression)) {\n    return migrateV2ToV3(expression);\n  }\n  return expression ?? defaultQuery.expression;\n};\n\nexport const looksLikeV2 = (expression: any): boolean => {\n  return typeof expression?.from?.expression?.value === 'string';\n};\n\nconst migrateV2ToV3 = (expression: any): QueryExpression => {\n  if (!expression) {\n    return defaultQuery.expression;\n  }\n\n  const migrated: QueryExpression = {\n    ...defaultQuery.expression,\n  };\n\n  if (typeof expression?.from?.expression?.value === 'string') {\n    migrated.from = migrateV2PropertyExpression(expression?.from?.expression);\n  }\n\n  if (Array.isArray(expression?.where?.expression?.expressions)) {\n    migrated.where = {\n      type: QueryEditorExpressionType.And,\n      expressions: expression?.where?.expression?.expressions\n        .map(migrateV2Expression)\n        .filter((exp) => !!exp)\n        .map((exp) => {\n          return {\n            type: QueryEditorExpressionType.Or,\n            expressions: [exp],\n          };\n        }) as QueryEditorExpression[],\n    };\n  }\n\n  if (Array.isArray(expression?.reduce?.expression?.expressions)) {\n    migrated.reduce = migrateV2Array(expression?.reduce?.expression?.expressions);\n  }\n\n  if (Array.isArray(expression?.groupBy?.expression?.expressions)) {\n    migrated.groupBy = migrateV2Array(expression?.groupBy?.expression?.expressions);\n  }\n\n  return migrated;\n};\n\nconst migrateV2Array = (expressions: any[]): QueryEditorArrayExpression => {\n  if (!Array.isArray(expressions)) {\n    return {\n      type: QueryEditorExpressionType.And,\n      expressions: [],\n    };\n  }\n\n  return {\n    type: QueryEditorExpressionType.And,\n    expressions: expressions.map(migrateV2Expression).filter((exp) => !!exp) as QueryEditorExpression[],\n  };\n};\n\nconst migrateV2Expression = (expression: any): QueryEditorExpression | undefined => {\n  switch (expression?.type) {\n    case 'fieldAndOperator':\n      return migrateV2OperatorExpression(expression);\n    case 'field':\n      return migrateV2PropertyExpression(expression);\n    case 'reduce':\n      return migrateV2ReduceExpression(expression);\n    case 'groupBy':\n      return migrateV2GroupByExpression(expression);\n    default:\n      return;\n  }\n};\n\nconst migrateV2GroupByExpression = (expression: any): QueryEditorGroupByExpression | undefined => {\n  if (expression?.type !== 'groupBy') {\n    return;\n  }\n\n  if (typeof expression?.field !== 'object') {\n    return;\n  }\n\n  if (typeof expression?.interval !== 'object') {\n    return {\n      type: QueryEditorExpressionType.GroupBy,\n      property: migrateV2Property(expression?.field),\n    };\n  }\n\n  return {\n    type: QueryEditorExpressionType.GroupBy,\n    property: migrateV2Property(expression?.field),\n    interval: migrateV2Property(expression?.interval),\n  };\n};\n\nconst migrateV2ReduceExpression = (expression: any): QueryEditorReduceExpression | undefined => {\n  if (expression?.type !== 'reduce') {\n    return;\n  }\n\n  if (typeof expression?.field !== 'object') {\n    return;\n  }\n\n  if (Array.isArray(expression?.parameters)) {\n    return {\n      type: QueryEditorExpressionType.Reduce,\n      property: migrateV2Property(expression?.field),\n      reduce: migrateV2Property(expression?.reduce),\n      parameters: expression.parameters,\n    };\n  }\n\n  return {\n    type: QueryEditorExpressionType.Reduce,\n    property: migrateV2Property(expression?.field),\n    reduce: migrateV2Property(expression?.reduce),\n  };\n};\n\nconst migrateV2PropertyExpression = (expression: any): QueryEditorPropertyExpression | undefined => {\n  if (expression?.type !== 'field') {\n    return;\n  }\n\n  if (typeof expression?.value !== 'string') {\n    return;\n  }\n\n  return {\n    type: QueryEditorExpressionType.Property,\n    property: migrateV2Property(expression),\n  };\n};\n\nconst migrateV2OperatorExpression = (expression: any): QueryEditorOperatorExpression | undefined => {\n  if (typeof expression?.field?.value !== 'string') {\n    return;\n  }\n\n  if (typeof expression?.operator?.operator?.value !== 'string') {\n    return;\n  }\n\n  return {\n    type: QueryEditorExpressionType.Operator,\n    property: migrateV2Property(expression?.field),\n    operator: {\n      name: expression?.operator?.operator?.value,\n      value: expression?.operator?.value ?? expression?.operator?.values,\n    },\n  };\n};\n\nconst migrateV2Property = (property: any): QueryEditorProperty => {\n  return {\n    type: migrateV2PropertType(property.fieldType),\n    name: property.value,\n  };\n};\n\nconst migrateV2PropertType = (type: any): QueryEditorPropertyType => {\n  switch (type) {\n    case 'boolean':\n      return QueryEditorPropertyType.Boolean;\n    case 'dateTime':\n      return QueryEditorPropertyType.DateTime;\n    case 'function':\n      return QueryEditorPropertyType.Function;\n    case 'number':\n      return QueryEditorPropertyType.Number;\n    case 'interval':\n      return QueryEditorPropertyType.Interval;\n    default:\n      return QueryEditorPropertyType.String;\n  }\n};\n","import { KustoQuery, defaultQuery } from 'types';\nimport { looksLikeV2, migrateExpression } from './expression';\n\nexport const migrateQuery = (query: KustoQuery): KustoQuery => {\n  return {\n    ...defaultQuery,\n    ...query,\n    rawMode: isRawMode(query),\n    pluginVersion: defaultQuery.pluginVersion,\n    expression: migrateExpression(defaultQuery.pluginVersion, query.expression),\n  };\n};\n\nexport const needsToBeMigrated = (query: KustoQuery): boolean => {\n  if (!query) {\n    return false;\n  }\n\n  if (!query.pluginVersion) {\n    return true;\n  }\n\n  if (!query.querySource) {\n    return true;\n  }\n\n  if (looksLikeV2(query.expression)) {\n    return true;\n  }\n\n  return false;\n};\n\nfunction isRawMode(query: KustoQuery): boolean {\n  if (query.rawMode === undefined && query.query && !query.expression?.from) {\n    return true;\n  }\n  return query.rawMode || false;\n}\n","import { __assign } from \"tslib\";\nimport { useCallback, useState, useRef } from 'react';\nimport useMountedState from './useMountedState';\nexport default function useAsyncFn(fn, deps, initialState) {\n    if (deps === void 0) { deps = []; }\n    if (initialState === void 0) { initialState = { loading: false }; }\n    var lastCallId = useRef(0);\n    var isMounted = useMountedState();\n    var _a = useState(initialState), state = _a[0], set = _a[1];\n    var callback = useCallback(function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var callId = ++lastCallId.current;\n        set(function (prevState) { return (__assign(__assign({}, prevState), { loading: true })); });\n        return fn.apply(void 0, args).then(function (value) {\n            isMounted() && callId === lastCallId.current && set({ value: value, loading: false });\n            return value;\n        }, function (error) {\n            isMounted() && callId === lastCallId.current && set({ error: error, loading: false });\n            return error;\n        });\n    }, deps);\n    return [state, callback];\n}\n","import { useCallback, useEffect, useRef } from 'react';\nexport default function useMountedState() {\n    var mountedRef = useRef(false);\n    var get = useCallback(function () { return mountedRef.current; }, []);\n    useEffect(function () {\n        mountedRef.current = true;\n        return function () {\n            mountedRef.current = false;\n        };\n    });\n    return get;\n}\n","import { useEffect } from 'react';\nimport useAsyncFn from './useAsyncFn';\nexport default function useAsync(fn, deps) {\n    if (deps === void 0) { deps = []; }\n    var _a = useAsyncFn(fn, deps, {\n        loading: true,\n    }), state = _a[0], callback = _a[1];\n    useEffect(function () {\n        callback();\n    }, [callback]);\n    return state;\n}\n","import React, { PropsWithChildren } from 'react';\nimport { InlineFormLabel } from '@grafana/ui';\n\nexport interface QueryEditorSectionProps {\n  label: string;\n  tooltip?: string;\n}\n\nexport const QueryEditorSection: React.FC<PropsWithChildren<QueryEditorSectionProps>> = (props) => {\n  return (\n    <div className=\"gf-form\">\n      <InlineFormLabel className=\"query-keyword\" width={12} tooltip={props.tooltip}>\n        {props.label}\n      </InlineFormLabel>\n      {props.children}\n    </div>\n  );\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Button, ConfirmModal, Select, useStyles2 } from '@grafana/ui';\nimport React, { useCallback, useState } from 'react';\nimport { EditorMode } from 'types';\n\nimport { QueryEditorSection } from '../editor/components/QueryEditorSection';\nimport { selectors } from '../test/selectors';\n\ninterface Props {\n  database: string;\n  databases: Array<SelectableValue<string>>;\n  editorMode: EditorMode;\n  dirty: boolean;\n  onChangeDatabase: (databaseName: string) => void;\n  onRunQuery: () => void;\n  onToggleEditorMode: () => void;\n}\n\nexport const QueryEditorToolbar: React.FC<Props> = (props) => {\n  const { dirty, editorMode, onToggleEditorMode } = props;\n  const [showConfirm, setShowConfirm] = useState(false);\n  const onToggleMode = useCallback(() => {\n    if (!dirty || editorMode === EditorMode.Visual) {\n      onToggleEditorMode();\n      return;\n    }\n    setShowConfirm(true);\n  }, [setShowConfirm, onToggleEditorMode, dirty, editorMode]);\n\n  const styles = useStyles2(getStyles);\n\n  return (\n    <QueryEditorSection label=\"Database\">\n      <Select\n        width={30}\n        options={props.databases}\n        placeholder=\"Select database\"\n        aria-label={selectors.components.queryEditor.database.input}\n        value={props.database}\n        onChange={(selected) => {\n          if (!selected || !selected.value) {\n            return;\n          }\n          props.onChangeDatabase(selected.value);\n        }}\n      />\n      {props.editorMode === EditorMode.Raw && (\n        <>\n          <div className={styles.spacing} />\n          <label className=\"gf-form-label\">(Run Query: Shift+Enter, Trigger Suggestion: Ctrl+Space)</label>\n        </>\n      )}\n      <div className=\"gf-form gf-form--grow\">\n        <div className=\"gf-form-label--grow\" />\n      </div>\n      <Button variant=\"secondary\" aria-label={selectors.components.queryEditor.editKQL.button} onClick={onToggleMode}>\n        {props.editorMode === EditorMode.Visual ? 'Edit KQL' : 'Switch to builder'}\n      </Button>\n      <div className={styles.spacing} />\n      <Button\n        variant={props.dirty ? 'primary' : 'secondary'}\n        aria-label={selectors.components.queryEditor.runQuery.button}\n        onClick={props.onRunQuery}\n      >\n        Run Query\n      </Button>\n      <ConfirmModal\n        isOpen={showConfirm}\n        title=\"Are you sure?\"\n        body=\"You might lose manual changes done to the query if you go back to the visual builder.\"\n        confirmText=\"Yes, I am sure.\"\n        dismissText=\"No, continue edit query manually.\"\n        icon=\"exclamation-triangle\"\n        onConfirm={() => {\n          setShowConfirm(false);\n          props.onToggleEditorMode();\n        }}\n        onDismiss={() => setShowConfirm(false)}\n      />\n    </QueryEditorSection>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  spacing: css`\n    margin-right: 4px;\n  `,\n});\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { InlineFormLabel, Select, useStyles2 } from '@grafana/ui';\nimport React, { useCallback } from 'react';\n\ninterface Props {\n  format: string;\n  onChangeFormat: (format: string) => void;\n  includeAdxTimeFormat: boolean;\n}\n\nconst formats: Array<SelectableValue<string>> = [\n  { label: 'Time series', value: 'time_series' },\n  { label: 'Table', value: 'table' },\n];\n\nconst adxTimeFormat: SelectableValue<string> = {\n  label: 'ADX Time series',\n  value: 'time_series_adx_series',\n};\n\nexport const QueryEditorResultFormat: React.FC<Props> = (props) => {\n  const { onChangeFormat } = props;\n  const onFormatChange = useCallback(\n    (selectable: SelectableValue<string>) => {\n      if (!selectable || !selectable.value) {\n        return;\n      }\n      onChangeFormat(selectable.value);\n    },\n    [onChangeFormat]\n  );\n\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.container}>\n      <InlineFormLabel className=\"query-keyword\" width={6}>\n        Format as\n      </InlineFormLabel>\n      <Select\n        options={props.includeAdxTimeFormat ? [...formats, adxTimeFormat] : formats}\n        value={props.format}\n        onChange={onFormatChange}\n        menuShouldPortal\n      />\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    flex-direction: row;\n    margin-right: 4px;\n  `,\n});\n\nexport const selectResultFormat = (format?: string, includeAdxFormat?: boolean): string => {\n  const selected = formats.find((f) => f.value === format);\n\n  if (includeAdxFormat && adxTimeFormat.value) {\n    if (adxTimeFormat.value === format) {\n      return adxTimeFormat.value;\n    }\n  }\n\n  if (selected && selected.value) {\n    return selected.value;\n  }\n\n  if (formats.length > 0 && formats[0].value) {\n    return formats[0].value;\n  }\n\n  return 'time_series';\n};\n","import _ from 'lodash';\n\nexport interface SuggestionController {\n  _model: any;\n}\n\nexport default class KustoCodeEditor {\n  codeEditor?: monaco.editor.IStandaloneCodeEditor;\n  completionItemProvider?: monaco.IDisposable;\n  signatureHelpProvider?: monaco.IDisposable;\n\n  splitWithNewLineRegex = /[^\\n]+\\n?|\\n/g;\n  newLineRegex = /\\r?\\n/;\n  startsWithKustoPipeRegex = /^\\|\\s*/g;\n  kustoPipeRegexStrict = /^\\|\\s*$/g;\n\n  constructor(\n    private containerDiv: any,\n    private defaultTimeField: string,\n    private getSchema: () => any,\n    private config: any\n  ) {}\n\n  initMonaco(content: string) {\n    let error: Error | undefined;\n    const themeName = this.config.bootData.user.lightTheme ? 'grafana-light' : 'vs-dark';\n\n    monaco.editor.defineTheme('grafana-light', {\n      base: 'vs',\n      inherit: true,\n      rules: [\n        { token: 'comment', foreground: '008000' },\n        { token: 'variable.predefined', foreground: '800080' },\n        { token: 'function', foreground: '0000FF' },\n        { token: 'operator.sql', foreground: 'FF4500' },\n        { token: 'string', foreground: 'B22222' },\n        { token: 'operator.scss', foreground: '0000FF' },\n        { token: 'variable', foreground: 'C71585' },\n        { token: 'variable.parameter', foreground: '9932CC' },\n        { token: '', foreground: '000000' },\n        { token: 'type', foreground: '0000FF' },\n        { token: 'tag', foreground: '0000FF' },\n        { token: 'annotation', foreground: '2B91AF' },\n        { token: 'keyword', foreground: '0000FF' },\n        { token: 'number', foreground: '191970' },\n        { token: 'annotation', foreground: '9400D3' },\n        { token: 'invalid', background: 'cd3131' },\n      ],\n      colors: {\n        'textCodeBlock.background': '#FFFFFF',\n      },\n    });\n\n    try {\n      monaco.languages['kusto'].kustoDefaults.setLanguageSettings({\n        includeControlCommands: true,\n        newlineAfterPipe: true,\n        useIntellisenseV2: false,\n      });\n    } catch (e) {\n      error = new Error(\n        'Unable to load Kusto language. Try refreshing the page or upgrading to Grafana +8.5 and ADX plugin +4.0'\n      );\n      console.error(error, e);\n    }\n\n    this.codeEditor = monaco.editor.create(this.containerDiv, {\n      value: content || 'Write your query here',\n      // Disabling the automatic resizing until we upgrade Monaco due to perf concerns: https://github.com/microsoft/monaco-editor/issues/28\n      // automaticLayout: true,\n      language: 'kusto',\n      selectionHighlight: false,\n      theme: themeName,\n      folding: true,\n      lineNumbers: 'off',\n      lineHeight: 16,\n      suggestFontSize: 13,\n      dragAndDrop: false,\n      occurrencesHighlight: false,\n      minimap: {\n        enabled: false,\n      },\n      renderIndentGuides: false,\n      wordWrap: 'on',\n    });\n    this.codeEditor.layout();\n\n    // TODO: fix ts-ignore\n    if (monaco.editor.getModels().length === 1) {\n      this.completionItemProvider = monaco.languages.registerCompletionItemProvider('kusto', {\n        triggerCharacters: ['.', ' '],\n        // @ts-ignore\n        provideCompletionItems: this.getCompletionItems.bind(this),\n      });\n\n      this.signatureHelpProvider = monaco.languages.registerSignatureHelpProvider('kusto', {\n        signatureHelpTriggerCharacters: ['(', ')'],\n        provideSignatureHelp: this.getSignatureHelp.bind(this) as any,\n      });\n    }\n\n    this.codeEditor.createContextKey('readyToExecute', true);\n\n    this.codeEditor.onDidChangeCursorSelection((event) => {\n      this.onDidChangeCursorSelection(event);\n    });\n\n    this.getSchema().then((schema) => {\n      if (!schema) {\n        return;\n      }\n\n      monaco.languages['kusto'].getKustoWorker().then((workerAccessor) => {\n        const model = this.codeEditor?.getModel();\n        if (!model) {\n          return;\n        }\n        workerAccessor(model.uri).then((worker) => {\n          const dbName = Object.keys(schema.Databases).length > 0 ? Object.keys(schema.Databases)[0] : '';\n          worker.setSchemaFromShowSchema(schema, 'https://help.kusto.windows.net', dbName);\n          this.codeEditor?.layout();\n        });\n      });\n    });\n\n    return error;\n  }\n\n  resize() {\n    this.codeEditor?.layout();\n  }\n\n  setOnDidChangeModelContent(listener) {\n    this.codeEditor?.onDidChangeModelContent(listener);\n  }\n\n  disposeMonaco() {\n    if (this.completionItemProvider) {\n      try {\n        this.completionItemProvider.dispose();\n      } catch (e) {\n        console.error('Failed to dispose the completion item provider.', e);\n      }\n    }\n    if (this.signatureHelpProvider) {\n      try {\n        this.signatureHelpProvider.dispose();\n      } catch (e) {\n        console.error('Failed to dispose the signature help provider.', e);\n      }\n    }\n    if (this.codeEditor) {\n      try {\n        this.codeEditor.dispose();\n      } catch (e) {\n        console.error('Failed to dispose the editor component.', e);\n      }\n    }\n  }\n\n  addCommand(keybinding: number, commandFunc: monaco.editor.ICommandHandler) {\n    this.codeEditor?.addCommand(keybinding, commandFunc, 'readyToExecute');\n  }\n\n  getValue() {\n    return this.codeEditor?.getValue();\n  }\n\n  toSuggestionController(srv: monaco.editor.IEditorContribution): SuggestionController {\n    return srv as unknown as SuggestionController;\n  }\n\n  setEditorContent(value) {\n    this.codeEditor?.setValue(value);\n  }\n\n  getCompletionItems(model: monaco.editor.IReadOnlyModel, position: monaco.Position): any {\n    const timeFilterDocs =\n      '##### Macro that uses the selected timerange in Grafana to filter the query.\\n\\n' +\n      '- `$__timeFilter()` -> Uses the ' +\n      this.defaultTimeField +\n      ' column\\n\\n' +\n      '- `$__timeFilter(datetimeColumn)` ->  Uses the specified datetime column to build the query.';\n\n    const textUntilPosition = model.getValueInRange({\n      startLineNumber: 1,\n      startColumn: 1,\n      endLineNumber: position.lineNumber,\n      endColumn: position.column,\n    });\n\n    if (!_.includes(textUntilPosition, '|')) {\n      return [];\n    }\n\n    if (!_.includes(textUntilPosition.toLowerCase(), 'where')) {\n      return [\n        {\n          label: 'where $__timeFilter(timeColumn)',\n          kind: monaco.languages.CompletionItemKind.Keyword,\n          insertText: {\n            value: 'where \\\\$__timeFilter(${0:' + this.defaultTimeField + '})',\n          },\n          documentation: {\n            value: timeFilterDocs,\n          },\n        },\n      ];\n    }\n\n    if (_.includes(model.getLineContent(position.lineNumber).toLowerCase(), 'where')) {\n      return [\n        {\n          label: '$__timeFilter(timeColumn)',\n          kind: monaco.languages.CompletionItemKind.Keyword,\n          insertText: {\n            value: '\\\\$__timeFilter(${0:' + this.defaultTimeField + '})',\n          },\n          documentation: {\n            value: timeFilterDocs,\n          },\n        },\n        {\n          label: '$__from',\n          kind: monaco.languages.CompletionItemKind.Keyword,\n          insertText: {\n            value: `\\\\$__from`,\n          },\n          documentation: {\n            value:\n              'Built-in variable that returns the from value of the selected timerange in Grafana.\\n\\n' +\n              'Example: `where ' +\n              this.defaultTimeField +\n              ' > $__from` ',\n          },\n        },\n        {\n          label: '$__to',\n          kind: monaco.languages.CompletionItemKind.Keyword,\n          insertText: {\n            value: `\\\\$__to`,\n          },\n          documentation: {\n            value:\n              'Built-in variable that returns the to value of the selected timerange in Grafana.\\n\\n' +\n              'Example: `where ' +\n              this.defaultTimeField +\n              ' < $__to` ',\n          },\n        },\n        {\n          label: '$__timeInterval',\n          kind: monaco.languages.CompletionItemKind.Keyword,\n          insertText: {\n            value: `\\\\$__timeInterval`,\n          },\n          documentation: {\n            value:\n              '##### Built-in variable that returns an automatic time grain suitable for the current timerange.\\n\\n' +\n              'Used with the bin() function - `bin(' +\n              this.defaultTimeField +\n              ', $__timeInterval)` \\n\\n' +\n              '[Grafana docs](http://docs.grafana.org/reference/templating/#the-interval-variable)',\n          },\n        },\n      ];\n    }\n\n    return [];\n  }\n\n  getSignatureHelp(model: monaco.editor.IReadOnlyModel, position: monaco.Position, token: monaco.CancellationToken) {\n    const textUntilPosition = model.getValueInRange({\n      startLineNumber: position.lineNumber,\n      startColumn: position.column - 14,\n      endLineNumber: position.lineNumber,\n      endColumn: position.column,\n    });\n\n    if (textUntilPosition !== '$__timeFilter(') {\n      return {} as monaco.languages.SignatureHelp;\n    }\n\n    const signature: monaco.languages.SignatureHelp = {\n      activeParameter: 0,\n      activeSignature: 0,\n      signatures: [\n        {\n          label: '$__timeFilter(timeColumn)',\n          parameters: [\n            {\n              label: 'timeColumn',\n              documentation:\n                'Default is ' +\n                this.defaultTimeField +\n                ' column. Datetime column to filter data using the selected date range. ',\n            },\n          ],\n        },\n      ],\n    };\n\n    return signature;\n  }\n\n  onDidChangeCursorSelection(event) {\n    if (event.source !== 'modelChange' || event.reason !== monaco.editor.CursorChangeReason.RecoverFromMarkers) {\n      return;\n    }\n    const lastChar = this.getCharAt(event.selection.positionLineNumber, event.selection.positionColumn - 1);\n\n    if (lastChar !== ' ') {\n      return;\n    }\n\n    this.triggerSuggestions();\n  }\n\n  triggerSuggestions() {\n    const suggestController = this.codeEditor?.getContribution('editor.contrib.suggestController');\n    if (!suggestController) {\n      return;\n    }\n\n    const convertedController = this.toSuggestionController(suggestController);\n\n    convertedController._model.cancel();\n    setTimeout(() => {\n      convertedController._model.trigger(true);\n    }, 10);\n  }\n\n  getCharAt(lineNumber: number, column: number) {\n    const model = this.codeEditor?.getModel();\n    if (!model) {\n      return '';\n    }\n    if (model.getLineCount() === 0 || model.getLineCount() < lineNumber) {\n      return '';\n    }\n    const line = model.getLineContent(lineNumber);\n    if (line.length < column || column < 1) {\n      return '';\n    }\n    return line[column - 1];\n  }\n}\n","/* eslint-disable */\n/* tslint:disable */\n///<reference path=\"../../node_modules/monaco-editor/monaco.d.ts\" />\n/* tslint:enable */\n/* eslint-enable */\nimport { css } from '@emotion/css';\nimport { config } from '@grafana/runtime';\nimport { Alert, stylesFactory } from '@grafana/ui';\nimport React from 'react';\n\nimport { AdxSchema } from '../types';\nimport KustoCodeEditor from './kusto_code_editor';\n\ninterface Props {\n  content: string;\n  defaultTimeField: string;\n  pluginBaseUrl: string;\n  getSchema: () => Promise<AdxSchema>;\n  onChange: (val: string) => void;\n  onExecute: () => void;\n}\n\ninterface MonacoState {\n  error?: Error;\n}\n\nexport class KustoMonacoEditor extends React.Component<Props, MonacoState> {\n  monacoRef: React.RefObject<HTMLDivElement>;\n  styles: { editor: string };\n  kustoCodeEditor: KustoCodeEditor | undefined;\n\n  constructor(props: Props) {\n    super(props);\n    this.styles = this.getStyles();\n    this.monacoRef = React.createRef<HTMLDivElement>();\n    this.state = {};\n\n    if (!window.hasOwnProperty('monaco')) {\n      // using the standard import() here causes issues with webpack/babel/typescript because monaco is just so large\n      (window as any).System.import(`${props.pluginBaseUrl}/libs/monaco.min.js`).then(() => {\n        setTimeout(() => {\n          this.initMonaco();\n        }, 1);\n      });\n    } else {\n      setTimeout(() => {\n        this.initMonaco();\n      }, 1);\n    }\n  }\n\n  initMonaco() {\n    this.kustoCodeEditor = new KustoCodeEditor(\n      this.monacoRef.current,\n      this.props.defaultTimeField,\n      this.props.getSchema,\n      config\n    );\n\n    const error = this.kustoCodeEditor.initMonaco(this.props.content);\n    if (error) {\n      this.setState({ error });\n    }\n\n    /* tslint:disable:no-bitwise */\n    this.kustoCodeEditor.addCommand(monaco.KeyMod.Shift | monaco.KeyCode.Enter, () => {\n      const newValue = this.kustoCodeEditor?.getValue();\n      this.props.onChange(newValue!);\n      this.props.onExecute();\n    });\n    /* tslint:enable:no-bitwise */\n\n    this.kustoCodeEditor.setOnDidChangeModelContent(() => {\n      const newValue = this.kustoCodeEditor?.getValue();\n      this.props.onChange(newValue!);\n    });\n\n    window.onresize = () => {\n      this.kustoCodeEditor?.resize();\n    };\n  }\n\n  componentWillUnmount() {\n    if (this.kustoCodeEditor) {\n      this.kustoCodeEditor.disposeMonaco();\n    }\n  }\n\n  getStyles = stylesFactory(() => ({\n    editor: css`\n      width: 100%;\n      height: 350px;\n    `,\n  }));\n\n  render() {\n    return (\n      <>\n        {this.state.error && (\n          <Alert title=\"Error loading editor\" severity=\"warning\">\n            {this.state.error.message}\n          </Alert>\n        )}\n        <div id=\"content\" tabIndex={0} className={this.styles.editor} ref={this.monacoRef}></div>\n      </>\n    );\n  }\n}\n","import { VariableModel } from '@grafana/data';\nimport { monacoTypes } from '@grafana/ui';\nimport { AdxFunctionSchema } from 'types';\n\nconst defaultTimeField = 'TimeGenerated';\n\nexport function getFunctions(variables: VariableModel[]): Record<string, AdxFunctionSchema> {\n  const functions = {\n    $__timeFilter: {\n      Name: '$__timeFilter',\n      Body: '{ true }',\n      FunctionKind: 'Unknown',\n      InputParameters: [\n        {\n          Name: 'timeColumn',\n          CslType: 'string',\n          Type: 'System.String',\n          CslDefaultValue: '\"\"',\n        },\n      ],\n      OutputColumns: [],\n      DocString:\n        '##### Macro that uses the selected timerange in Grafana to filter the query.\\n\\n' +\n        '- `$__timeFilter()` -> Uses the ' +\n        defaultTimeField +\n        ' column\\n\\n' +\n        '- `$__timeFilter(datetimeColumn)` ->  Uses the specified datetime column to build the query.',\n    },\n    $__from: {\n      Name: '$__from',\n      Body: '{ datetime(2018-06-05T18:09:58.907Z) }',\n      FunctionKind: 'Unknown',\n      DocString:\n        'Built-in variable that returns the from value of the selected timerange in Grafana.\\n\\n' +\n        'Example: `where ' +\n        defaultTimeField +\n        ' > $__from` ',\n      InputParameters: [],\n      OutputColumns: [],\n    },\n    $__to: {\n      Name: '$__to',\n      Body: '{ datetime(2018-06-05T18:09:58.907Z) }',\n      FunctionKind: 'Unknown',\n      DocString:\n        'Built-in variable that returns the to value of the selected timerange in Grafana.\\n\\n' +\n        'Example: `where ' +\n        defaultTimeField +\n        ' < $__to` ',\n      InputParameters: [],\n      OutputColumns: [],\n    },\n    $__timeInterval: {\n      Name: '$__timeInterval',\n      Body: '{ 1s }',\n      FunctionKind: 'Unknown',\n      DocString:\n        '##### Built-in variable that returns an automatic time grain suitable for the current timerange.\\n\\n' +\n        'Used with the bin() function - `bin(' +\n        defaultTimeField +\n        ', $__timeInterval)` \\n\\n' +\n        '[Grafana docs](http://docs.grafana.org/reference/templating/#the-interval-variable)',\n      InputParameters: [],\n      OutputColumns: [],\n    },\n  };\n\n  // Add template variables\n  variables.forEach((v) => {\n    functions[`$${v.name}`] = {\n      Name: `$${v.name}`,\n      Body: '{}',\n      FunctionKind: 'Unknown',\n      InputParameters: [],\n      OutputColumns: [],\n    };\n  });\n\n  return functions;\n}\n\nexport function getSignatureHelp(\n  model: monacoTypes.editor.ITextModel,\n  position: monacoTypes.Position\n): monacoTypes.languages.ProviderResult<monacoTypes.languages.SignatureHelpResult> {\n  // The current position is the position of the parenthesis `(`\n  // So we need to get the function name using the previous character\n  const funcPosition = position.delta(0, -1);\n  const { word } = model.getWordUntilPosition(funcPosition);\n  if (word !== '__timeFilter') {\n    return { value: { activeParameter: 0, activeSignature: 0, signatures: [] }, dispose: () => {} };\n  }\n\n  const signature: monaco.languages.SignatureHelp = {\n    activeParameter: 0,\n    activeSignature: 0,\n    signatures: [\n      {\n        label: '$__timeFilter(timeColumn)',\n        parameters: [\n          {\n            label: 'timeColumn',\n            documentation:\n              'Default is ' +\n              defaultTimeField +\n              ' column. Datetime column to filter data using the selected date range. ',\n          },\n        ],\n      },\n    ],\n  };\n\n  return { value: signature, dispose: () => {} };\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, QueryEditorProps, SelectableValue } from '@grafana/data';\nimport { config, getTemplateSrv } from '@grafana/runtime';\nimport { CodeEditor, Icon, Monaco, MonacoEditor, useStyles2 } from '@grafana/ui';\nimport { QueryEditorResultFormat, selectResultFormat } from 'components/QueryEditorResultFormat';\nimport { AdxDataSource } from 'datasource';\nimport { KustoMonacoEditor } from 'monaco/KustoMonacoEditor';\nimport React, { useEffect, useState } from 'react';\nimport { gte, valid } from 'semver';\nimport { selectors } from 'test/selectors';\nimport { AdxDataSourceOptions, AdxSchema, KustoQuery } from 'types';\n\nimport { getFunctions, getSignatureHelp } from './Suggestions';\n\ntype Props = QueryEditorProps<AdxDataSource, KustoQuery, AdxDataSourceOptions>;\n\ninterface RawQueryEditorProps extends Props {\n  dirty?: boolean;\n  lastQueryError?: string;\n  lastQuery?: string;\n  timeNotASC?: boolean;\n  schema?: AdxSchema;\n  database: string;\n  templateVariableOptions: SelectableValue<string>;\n}\n\nconst defaultQuery = [\n  '//change this to create your own time series query',\n  '',\n  '<table name>',\n  '| where $__timeFilter(Timestamp)',\n  '// | summarize count() by <group by column>, bin(Timestamp, $__timeInterval)',\n  '// | order by Timestamp asc',\n].join('\\n');\n\ninterface Worker {\n  setSchemaFromShowSchema: (schema: AdxSchema, url: string, database: string) => void;\n}\n\n// Since Grafana 8.5, the query editor includes a version of the Monaco editor for Kusto\n// that includes fixes required for auto-completion to work.\n// Remove this code once Grafana 8.5 is the minimal version supported\nfunction gtGrafana8_5() {\n  return valid(config.buildInfo.version) && gte(config.buildInfo.version, '8.5.0');\n}\n\nexport const RawQueryEditor: React.FC<RawQueryEditorProps> = (props) => {\n  const [showLastQuery, setShowLastQuery] = useState(false);\n  const [showHelp, setShowHelp] = useState(false);\n  const [worker, setWorker] = useState<Worker>();\n  const [variables] = useState(getTemplateSrv().getVariables());\n\n  const onRawQueryChange = (kql: string) => {\n    const resultFormat = selectResultFormat(props.query.resultFormat, true);\n\n    props.onChange({\n      ...props.query,\n      query: kql,\n      database: props.database,\n      resultFormat,\n    });\n  };\n\n  const onChangeResultFormat = (format: string) => {\n    props.onChange({\n      ...props.query,\n      resultFormat: format,\n    });\n  };\n\n  const { query, datasource, lastQueryError, lastQuery, timeNotASC, schema } = props;\n  const resultFormat = selectResultFormat(query.resultFormat, true);\n  const baseUrl = `${config.appSubUrl}/${datasource.meta.baseUrl}`;\n\n  const styles = useStyles2(getStyles);\n\n  const handleEditorMount = (editor: MonacoEditor, monaco: Monaco) => {\n    monaco.languages.registerSignatureHelpProvider('kusto', {\n      signatureHelpTriggerCharacters: ['(', ')'],\n      provideSignatureHelp: getSignatureHelp,\n    });\n    monaco.languages['kusto']\n      .getKustoWorker()\n      .then((kusto) => {\n        const model = editor.getModel();\n        return model && kusto(model.uri);\n      })\n      .then((worker) => {\n        setWorker(worker);\n      });\n  };\n\n  useEffect(() => {\n    if (worker && schema) {\n      // Populate Database schema with macros\n      Object.keys(schema.Databases).forEach((db) =>\n        Object.assign(schema.Databases[db].Functions, getFunctions(variables))\n      );\n      worker.setSchemaFromShowSchema(schema, 'https://help.kusto.windows.net', props.database);\n    }\n  }, [worker, schema, variables, props.database]);\n\n  if (!schema) {\n    return null;\n  }\n\n  return (\n    <div>\n      {gtGrafana8_5() ? (\n        <div data-testid={selectors.components.queryEditor.codeEditor.container}>\n          <CodeEditor\n            language=\"kusto\"\n            value={query.query || defaultQuery}\n            onBlur={onRawQueryChange}\n            showMiniMap={false}\n            showLineNumbers={true}\n            height=\"240px\"\n            onEditorDidMount={handleEditorMount}\n          />\n        </div>\n      ) : (\n        <div data-testid={selectors.components.queryEditor.codeEditorLegacy.container}>\n          <KustoMonacoEditor\n            defaultTimeField=\"Timestamp\"\n            pluginBaseUrl={baseUrl}\n            content={query.query || defaultQuery}\n            getSchema={async () => schema}\n            onChange={onRawQueryChange}\n            onExecute={props.onRunQuery}\n          />\n        </div>\n      )}\n\n      <div className={styles.toolbar}>\n        <QueryEditorResultFormat\n          includeAdxTimeFormat={true}\n          format={resultFormat}\n          onChangeFormat={onChangeResultFormat}\n        />\n        <div className=\"gf-form\">\n          <label className=\"gf-form-label query-keyword\" onClick={() => setShowHelp(!showHelp)}>\n            Show Help <Icon name={showHelp ? 'angle-down' : 'angle-right'} />\n          </label>\n        </div>\n        <div className=\"gf-form\" ng-show=\"ctrl.lastQuery\">\n          <label className=\"gf-form-label query-keyword\" onClick={() => setShowLastQuery(!showLastQuery)}>\n            Raw Query <Icon name={showLastQuery ? 'angle-down' : 'angle-right'} />\n          </label>\n        </div>\n\n        <div className=\"gf-form gf-form--grow\">\n          <div className=\"gf-form-label gf-form-label--grow\"></div>\n        </div>\n      </div>\n\n      {showLastQuery && (\n        <div className=\"gf-form\">\n          <pre className=\"gf-form-pre\">{lastQuery}</pre>\n        </div>\n      )}\n\n      {lastQueryError && (\n        <div className=\"gf-form\">\n          <pre className=\"gf-form-pre alert alert-error\">{lastQueryError}</pre>\n        </div>\n      )}\n\n      {timeNotASC && (\n        <div className=\"gf-form\">\n          <pre className=\"gf-form-pre alert alert-warning\">\n            Data is not sorted ascending by Time. Recommend adding an order by clause.\n          </pre>\n        </div>\n      )}\n\n      {showHelp && (\n        <div className=\"gf-form\">\n          <pre className=\"gf-form-pre alert alert-info\">\n            {`\n  Format as Table:\n  - Can return any set of columns.\n\n  Format as Time series:\n  - Requires exactly one column of Kusto type datetime. (tip: can use Kusto's project-away operator to remove columns).\n  - Requires at least one value column of a number type. Each value column is considered a metric.\n  - May optionally have one or more string columns. Each string column is considered as a key=value tag pair (where the key is the column name, and the value is the value of the column for each row).\n  - A time series is returned for each value column + unique set of string column values. Each series has name of valueColumnName { stringColumnName=columnValue, ... }. If there are no string columns in the request, the name will just be valueColumnName.\n  - Example Time Series Query:\n    AzureActivity\n      | where $__timeFilter()\n      | summarize count() by Category, bin(TimeGenerated, 60min)\n      | order by TimeGenerated asc\n\n  Format as ADX Time series:\n   - Used for queries that return Kusto's \"time series\" type, such as the make-series operator\n   - Must have a datetime column named \"Timestamp\"\n   - Example ADX Time series query:\n    let T = range Timestamp from $__timeFrom to $__timeTo step $__timeInterval * 4\n      | extend   Person = dynamic([\"Torkel\", \"Daniel\", \"Kyle\", \"Sofia\"]) \n      | extend   Place  = dynamic([\"EU\",     \"EU\",     \"US\",   \"EU\"]) \n      | mvexpand Person, Place\n      | extend   HatInventory = rand(5) \n      | project  Timestamp, tostring(Person), tostring(Place), HatInventory;\n    T | make-series avg(HatInventory) on Timestamp from $__timeFrom to $__timeTo step $__timeInterval * 4 by Person, Place;\n\n\n  Time Macros:\n  - $__timeFilter -&gt; TimeGenerated &ge; datetime(2018-06-05T18:09:58.907Z) and TimeGenerated &le; datetime(2018-06-05T20:09:58.907Z)\n  - $__timeFilter(datetimeColumn) -&gt;  datetimeColumn  &ge; datetime(2018-06-05T18:09:58.907Z) and datetimeColumn &le; datetime(2018-06-05T20:09:58.907Z)\n  - $__timeFrom -&gt;  datetime(2018-06-05T18:09:58.907Z) [the start time of the query]\n  - $__timeTo -&gt; datetime(2018-06-05T20:09:58.907Z) [the end time of the query]\n  - $__timeInterval -&gt; 5000ms [Grafana's recommended bin size based on the timespan of the query, in ms]\n\n  Templating Macros:\n  - $__escapeMulti($myTemplateVar) -&gt; $myTemplateVar should be a multi-value template variables that contains illegal characters\n  - $__contains(aColumn, $myTemplateVar) -&gt; aColumn in ($myTemplateVar)\n    If using the All option, then check the Include All Option checkbox and in the Custom all value field type in: all. If All is chosen -&gt; 1 == 1\n\n  Macro Examples:\n  -  where $__timeFilter()\n  - | where TimeGenerated &ge; $__timeFrom() and TimeGenerated &le; $__timeTo()\n  - | summarize count() by Category, bin(TimeGenerated, $__timeInterval)`}\n          </pre>\n        </div>\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  toolbar: css`\n    display: flex;\n    flex-direction: row;\n    margin-top: 4px;\n  `,\n});\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { AsyncSelect, useStyles2 } from '@grafana/ui';\nimport React, { useCallback, useMemo, useState } from 'react';\n\nimport { QueryEditorProperty, QueryEditorPropertyDefinition, QueryEditorPropertyType } from '../../types';\n\ninterface Props {\n  fields: QueryEditorPropertyDefinition[];\n  templateVariableOptions?: SelectableValue<string>;\n  value?: QueryEditorProperty;\n  onChange: (property: QueryEditorProperty) => void;\n  placeholder?: string;\n  allowCustom?: boolean;\n  'aria-label'?: string;\n}\n\nexport const definitionToProperty = (definition: QueryEditorPropertyDefinition): QueryEditorProperty => {\n  return {\n    name: definition.value,\n    type: definition.type,\n  };\n};\n\nexport const QueryEditorField: React.FC<Props> = (props) => {\n  const {\n    value: propsValue,\n    fields,\n    allowCustom,\n    placeholder,\n    templateVariableOptions,\n    onChange: propsOnChange,\n  } = props;\n  const [prevValue, setPrevValue] = useState<QueryEditorProperty>(null as unknown as QueryEditorProperty);\n  const styles = useStyles2(getStyles);\n  const options = useOptions(fields);\n  const value = useMemo(() => options.find((option) => option.value === propsValue?.name), [options, propsValue]);\n  const loadOptions = useMemo(\n    () => filterOptions(options, templateVariableOptions),\n    [options, templateVariableOptions]\n  );\n  const onChange = useOnChange(props, propsValue, setPrevValue);\n  const onCloseMenu = useCallback(() => {\n    if (!value && prevValue) {\n      propsOnChange({ ...prevValue });\n    }\n\n    setPrevValue(null as unknown as QueryEditorProperty);\n  }, [propsOnChange, setPrevValue, prevValue, value]);\n\n  return (\n    <div className={styles.container}>\n      <AsyncSelect\n        width={30}\n        onChange={onChange}\n        value={value}\n        defaultOptions={templateVariableOptions ? [templateVariableOptions, ...options] : options}\n        loadOptions={loadOptions}\n        placeholder={placeholder}\n        menuPlacement=\"bottom\"\n        allowCustomValue={allowCustom}\n        backspaceRemovesValue={true}\n        isClearable={true}\n        onCloseMenu={onCloseMenu}\n        aria-label={props['aria-label']}\n      />\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    margin-right: 4px;\n  `,\n});\n\n// Should remove this when I have fixed the underlying issue in the select component\n// it should use value as label if label is missing.\nconst useOptions = (options: QueryEditorPropertyDefinition[]): Array<SelectableValue<string>> => {\n  return useMemo(() => {\n    if (!options) {\n      return [];\n    }\n\n    return options.map((option) => {\n      return {\n        label: option.label ?? option.value,\n        value: option.value,\n        type: option.type,\n      };\n    });\n  }, [options]);\n};\n\nconst useOnChange = (\n  { fields, allowCustom, templateVariableOptions, onChange }: Props,\n  currentValue: QueryEditorProperty | undefined,\n  setPrevValue: (value: QueryEditorProperty) => void\n) => {\n  return useCallback(\n    (selectable: SelectableValue<string>) => {\n      if (!selectable || (typeof selectable.value !== 'string' && currentValue)) {\n        const name: any = null;\n        const type = QueryEditorPropertyType.String;\n\n        onChange({ name, type });\n        if (currentValue) {\n          setPrevValue(currentValue);\n        }\n\n        return;\n      }\n\n      const { value } = selectable;\n      let field: QueryEditorPropertyDefinition | undefined = fields.find((o) => o.value === value);\n\n      if (!field) {\n        field = templateVariableOptions?.options?.find((o) => o.value === value);\n      }\n\n      if (!field && value && allowCustom) {\n        field = {\n          value,\n          type: QueryEditorPropertyType.String,\n        };\n      }\n\n      if (field) {\n        onChange({\n          name: field.value,\n          type: field.type,\n        });\n      }\n    },\n    [fields, onChange, templateVariableOptions, allowCustom, currentValue, setPrevValue]\n  );\n};\n\nexport const filterOptions =\n  (options: Array<SelectableValue<string>>, templateVariableOptions?: SelectableValue<string>) =>\n  async (textSearchingFor: string) => {\n    const text = textSearchingFor.toLowerCase();\n    const allOptions = templateVariableOptions ? [templateVariableOptions, ...options] : options;\n    const exactMatchOptions = allOptions.filter((option) => option.label?.toLowerCase().startsWith(text));\n    const anyMatchOptions = allOptions.filter((option) => option.label?.toLowerCase().indexOf(text, 1) !== -1);\n    const sortedOptions = exactMatchOptions.concat(anyMatchOptions);\n    const uniqueOptions = [...new Set(sortedOptions)];\n\n    return uniqueOptions;\n  };\n","import {\n  AdxColumnSchema,\n  AdxDatabaseSchema,\n  AdxFunctionSchema,\n  AdxTableSchema,\n  SchemaMapping,\n  SchemaMappingType,\n} from '../types';\nimport { AdxDataSource } from '../datasource';\nimport { cache } from './cache';\n\nconst schemaKey = 'AdxSchemaResolver';\n\nexport class AdxSchemaResolver {\n  constructor(private datasource: AdxDataSource) {}\n\n  private createCacheKey(addition: string): string {\n    return `${schemaKey}.${this.datasource.id}.${addition}`;\n  }\n\n  async getDatabases(): Promise<AdxDatabaseSchema[]> {\n    const schema = await this.datasource.getSchema();\n    return Object.keys(schema.Databases).map((key) => schema.Databases[key]);\n  }\n\n  async getTablesForDatabase(databaseName: string): Promise<AdxTableSchema[]> {\n    const databases = await this.getDatabases();\n    const database = databases.find((db) => db.Name === databaseName);\n\n    if (!database) {\n      return [];\n    }\n    return Object.keys(database.Tables).map((key) => database.Tables[key]);\n  }\n\n  async getViewsForDatabase(databaseName: string): Promise<AdxTableSchema[]> {\n    const databases = await this.getDatabases();\n    const database = databases.find((db) => db.Name === databaseName);\n\n    if (!database) {\n      return [];\n    }\n    return Object.keys(database.MaterializedViews).map((key) => database.MaterializedViews[key]);\n  }\n\n  async getFunctionsForDatabase(databaseName: string): Promise<AdxFunctionSchema[]> {\n    const databases = await this.getDatabases();\n    const database = databases.find((db) => db.Name === databaseName);\n\n    if (!database) {\n      return [];\n    }\n    return Object.keys(database.Functions).map((key) => database.Functions[key]);\n  }\n\n  async getColumnsForTable(databaseName: string, tableName: string): Promise<AdxColumnSchema[]> {\n    const cacheKey = this.createCacheKey(`db.${databaseName}.${tableName}`);\n    const mapper = this.datasource.getSchemaMapper();\n\n    return cache(cacheKey, async () => {\n      const mapping = mapper.getMappingByValue(tableName);\n      const schema = await this.findSchema(databaseName, tableName, mapping);\n\n      if (!schema) {\n        return [];\n      }\n\n      if (mapping?.type === SchemaMappingType.function) {\n        schema.OrderedColumns = await this.datasource.getFunctionSchema(databaseName, mapping.value);\n      }\n\n      const dynamicColumns = schema.OrderedColumns.filter((column) => column.CslType === 'dynamic').map(\n        (column) => column.Name\n      );\n\n      const schemaByColumn = await this.datasource.getDynamicSchema(\n        databaseName,\n        mapping?.name ?? tableName,\n        dynamicColumns\n      );\n\n      return schema.OrderedColumns.reduce((columns: AdxColumnSchema[], column) => {\n        const schemaForDynamicColumn = schemaByColumn[column.Name];\n\n        if (!Array.isArray(schemaForDynamicColumn)) {\n          columns.push(column);\n          return columns;\n        }\n\n        // Handling dynamic columns\n        Array.prototype.push.apply(columns, schemaForDynamicColumn);\n        return columns;\n      }, []);\n    });\n  }\n\n  private async findSchema(\n    databaseName: string,\n    tableName: string,\n    mapping?: SchemaMapping\n  ): Promise<AdxTableSchema | undefined> {\n    const [tables, funcs, views] = await Promise.all([\n      this.getTablesForDatabase(databaseName),\n      this.getFunctionsForDatabase(databaseName),\n      this.getViewsForDatabase(databaseName),\n    ]);\n\n    const name = mapping?.name ?? tableName;\n\n    const table = tables.find((t) => t.Name === name);\n    if (table) {\n      return table;\n    }\n\n    const view = views.find((v) => v.Name === name);\n    if (view) {\n      return view;\n    }\n\n    const func = funcs.find((f) => f.Name === name);\n    if (func) {\n      return {\n        Name: func.Name,\n        OrderedColumns: func.OutputColumns,\n      };\n    }\n\n    return;\n  }\n}\n","import { SelectableValue } from '@grafana/data';\nimport React from 'react';\n\nimport { QueryEditorExpression, QueryEditorExpressionType, QueryEditorPropertyExpression } from '../../expressions';\nimport { isFieldExpression } from '../../guards';\nimport { QueryEditorProperty, QueryEditorPropertyDefinition } from '../../types';\nimport { QueryEditorSection, QueryEditorSectionProps } from '../QueryEditorSection';\nimport { QueryEditorField } from './QueryEditorField';\n\ninterface FieldSectionConfiguration {\n  defaultValue: QueryEditorExpression;\n}\n\nexport interface QueryEditorFieldSectionProps extends React.PropsWithChildren<QueryEditorSectionProps> {\n  fields: QueryEditorPropertyDefinition[];\n  templateVariableOptions: SelectableValue<string>;\n  value?: QueryEditorExpression;\n  onChange: (value: QueryEditorExpression) => void;\n  allowCustom?: boolean;\n  'aria-label'?: string;\n}\n\nexport const QueryEditorFieldSection = (config: FieldSectionConfiguration): React.FC<QueryEditorFieldSectionProps> => {\n  return function F(props) {\n    const { onChange: propsOnChange } = props;\n    const expression = props.value ?? config.defaultValue;\n\n    if (!isFieldExpression(expression)) {\n      return null;\n    }\n\n    return (\n      <QueryEditorSection label={props.label}>\n        <QueryEditorField\n          fields={props.fields}\n          templateVariableOptions={props.templateVariableOptions}\n          onChange={onChange(propsOnChange)}\n          value={expression.property}\n          allowCustom={props.allowCustom}\n          aria-label={props['aria-label']}\n        />\n        {props.children}\n      </QueryEditorSection>\n    );\n  };\n};\n\nconst onChange = (propsOnChange: (value: QueryEditorExpression) => void) => (property: QueryEditorProperty) => {\n  propsOnChange({\n    type: QueryEditorExpressionType.Property,\n    property,\n  } as QueryEditorPropertyExpression);\n};\n","import React from 'react';\nimport { QueryEditorPropertyType } from '../types';\nimport { QueryEditorFieldSectionProps, QueryEditorFieldSection } from 'editor/components/field/QueryEditorFieldSection';\nimport { QueryEditorPropertyExpression, QueryEditorExpressionType } from '../expressions';\n\nexport class QueryEditorFieldBuilder {\n  build(): React.FC<QueryEditorFieldSectionProps> {\n    return QueryEditorFieldSection({\n      defaultValue: this.buildFieldExpression(),\n    });\n  }\n\n  private buildFieldExpression(): QueryEditorPropertyExpression {\n    return {\n      type: QueryEditorExpressionType.Property,\n      property: {\n        name: '',\n        type: QueryEditorPropertyType.String,\n      },\n    };\n  }\n}\n","import React, { useCallback } from 'react';\n\nimport { QueryEditorArrayExpression, QueryEditorExpression } from '../expressions';\n\ninterface Props {\n  id: string;\n  value: QueryEditorArrayExpression;\n  onChange: (value: QueryEditorArrayExpression) => void;\n  children: (props: ChildProps) => React.ReactElement | null;\n}\n\ninterface ChildProps {\n  index: number;\n  onChange: (value: QueryEditorExpression) => void;\n  onRemove: () => void;\n  onAdd: (value: QueryEditorExpression) => void;\n  value?: QueryEditorExpression;\n}\n\nexport const QueryEditorRepeater: React.FC<Props> = (props) => {\n  const { onChange: propsOnChange, children, value } = props;\n\n  const onChange = useCallback(\n    (index: number, expression?: QueryEditorExpression) => {\n      const { expressions } = value;\n      const next = [...expressions];\n\n      if (expression) {\n        next.splice(index, 1, expression);\n      } else {\n        next.splice(index, 1);\n      }\n\n      // Remove any expressions with empty sub expressions\n      const remainingExpressions = next.filter((v) => {\n        if ('expressions' in v) {\n          return (v as QueryEditorArrayExpression).expressions.length > 0;\n        }\n        return true;\n      });\n\n      propsOnChange({\n        ...value,\n        expressions: remainingExpressions,\n      });\n    },\n    [propsOnChange, value]\n  );\n\n  if (!value?.expressions) {\n    return null;\n  }\n\n  const length = value.expressions.length;\n\n  return (\n    <>\n      {Array.from(value.expressions).map((val, idx) => {\n        return (\n          <React.Fragment key={idx}>\n            {children({\n              index: idx,\n              value: val,\n              onChange: (expression: QueryEditorExpression) => onChange(idx, expression),\n              onAdd: (expression: QueryEditorExpression) => onChange(length, expression),\n              onRemove: () => onChange(idx),\n            })}\n          </React.Fragment>\n        );\n      })}\n    </>\n  );\n};\n","import { useEffect } from 'react';\nvar useEffectOnce = function (effect) {\n    useEffect(effect, []);\n};\nexport default useEffectOnce;\n","import _ from 'lodash';\nimport { QueryEditorOperatorDefinition, QueryEditorProperty, QueryEditorPropertyType } from '../../types';\n\nexport const parseOperatorValue = (\n  property: QueryEditorProperty,\n  definition: QueryEditorOperatorDefinition,\n  value: any,\n  defaultValue: any\n) => {\n  if (definition.multipleValues) {\n    if (Array.isArray(value)) {\n      return tryToCastArrayToPropertyType(property, value);\n    }\n    return tryToCastArrayToPropertyType(property, [value]);\n  }\n\n  const casted = tryToCastToPropertyType(property, value);\n  return _.isUndefined(casted) ? defaultValue : casted;\n};\n\nconst tryToCastArrayToPropertyType = (property: QueryEditorProperty, value: any[]) => {\n  return value.reduce((all: any[], v) => {\n    const casted = tryToCastToPropertyType(property, v);\n\n    if (_.isUndefined(casted)) {\n      return all;\n    }\n\n    all.push(casted);\n    return all;\n  }, []);\n};\n\nconst tryToCastToPropertyType = (property: QueryEditorProperty, value: any) => {\n  switch (property.type) {\n    case QueryEditorPropertyType.Boolean:\n      return toBoolean(value, false);\n\n    case QueryEditorPropertyType.Number:\n      return toNumber(value, 0);\n\n    default:\n      return;\n  }\n};\n\nconst toNumber = (value: any, defaultValue: number): number => {\n  if (_.isNumber(value)) {\n    return _.toNumber(value);\n  }\n\n  if (typeof value === 'boolean') {\n    return value ? 1 : 0;\n  }\n\n  return defaultValue;\n};\n\nconst toBoolean = (value: any, defaultValue: boolean): boolean => {\n  if (typeof value === 'boolean') {\n    return value;\n  }\n\n  if (typeof value === 'string') {\n    const comparable = _.toLower(_.trim(value));\n\n    if (_.startsWith(comparable, 't')) {\n      return true;\n    }\n\n    if (_.startsWith(comparable, '1')) {\n      return true;\n    }\n\n    return false;\n  }\n\n  if (typeof value === 'number') {\n    return value > 0;\n  }\n\n  return defaultValue;\n};\n","import React, { useCallback } from 'react';\nimport { Select } from '@grafana/ui';\nimport { SelectableValue } from '@grafana/data';\nimport { QueryEditorOperatorDefinition, QueryEditorOperator } from '../../types';\n\ninterface Props {\n  value: boolean | undefined;\n  onChange: (operator: QueryEditorOperator<boolean>) => void;\n  operator: QueryEditorOperatorDefinition;\n}\n\nconst options: Array<SelectableValue<boolean>> = [\n  { value: true, label: 'True' },\n  { value: false, label: 'False' },\n];\n\nexport const QueryEditorBoolOperator: React.FC<Props> = (props) => {\n  const onChange = useCallback(\n    (selectable: SelectableValue<boolean>) => {\n      if (!selectable || typeof selectable.value !== 'boolean') {\n        return;\n      }\n\n      props.onChange({\n        name: props.operator.value,\n        value: selectable.value,\n      });\n    },\n    [props]\n  );\n\n  return <Select width={15} options={options} value={props.value} onChange={onChange} menuPlacement=\"bottom\" />;\n};\n","import React, { PureComponent } from 'react';\nimport { AsyncMultiSelect } from '@grafana/ui';\nimport { ExpressionSuggestor } from '../types';\nimport { QueryEditorOperatorDefinition, QueryEditorOperator } from '../../types';\nimport { SelectableValue } from '@grafana/data';\n\ninterface Props {\n  values: string[] | undefined;\n  onChange: (expression: QueryEditorOperator<string[]>) => void;\n  operator: QueryEditorOperatorDefinition;\n  getSuggestions: ExpressionSuggestor;\n  templateVariableOptions: SelectableValue<string>;\n}\n\ninterface State {\n  defaultOptions: Array<SelectableValue<string>>;\n  isLoading: boolean;\n}\n\nexport class QueryEditorMultiOperator extends PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      defaultOptions: [props.templateVariableOptions],\n      isLoading: false,\n    };\n  }\n\n  onCreate = (value: string) => {\n    if (!value) {\n      return;\n    }\n    // Append the new value\n    const values = (this.props.values || []).concat(value);\n    this.props.onChange({\n      value: values,\n      name: this.props.operator.value,\n    });\n  };\n\n  onChange = (selectable: any) => {\n    if (!Array.isArray(selectable)) {\n      return;\n    }\n\n    this.props.onChange({\n      value: selectable.map((s) => s.value),\n      name: this.props.operator.value,\n    });\n  };\n\n  getSuggestions = async (txt: string) => {\n    this.setState({ isLoading: true });\n\n    const options = await this.props.getSuggestions(txt);\n\n    this.setState({\n      defaultOptions: [this.props.templateVariableOptions, ...options],\n      isLoading: false,\n    });\n\n    return options;\n  };\n\n  render() {\n    const values = this.props.values || [];\n    const current = values.map((v) => {\n      return { label: v, value: v };\n    });\n\n    return (\n      <AsyncMultiSelect\n        width={30}\n        placeholder=\"Start typing to add filters...\"\n        loadOptions={this.getSuggestions}\n        onOpenMenu={() => this.getSuggestions('')}\n        defaultOptions={this.state.defaultOptions}\n        isLoading={this.state.isLoading}\n        value={current}\n        onChange={this.onChange}\n        onCreateOption={this.onCreate}\n        noOptionsMessage=\"No options found\"\n        isClearable\n      />\n    );\n  }\n}\n","import React, { useCallback, useState } from 'react';\nimport { Input } from '@grafana/ui';\nimport { QueryEditorOperatorDefinition, QueryEditorOperator } from '../../types';\n\ninterface Props {\n  value: number | undefined;\n  onChange: (operator: QueryEditorOperator<number>) => void;\n  operator: QueryEditorOperatorDefinition;\n}\n\nexport const QueryEditorNumberOperator: React.FC<Props> = (props) => {\n  const [value, setValue] = useState<string>(String(props.value ?? 0));\n  const {\n    onChange,\n    operator: { value: operatorValue },\n  } = props;\n\n  const onChangeInput = useCallback(\n    (event: React.FormEvent<HTMLInputElement>) => {\n      setValue(event.currentTarget.value);\n    },\n    [setValue]\n  );\n\n  const onBlurInput = useCallback(\n    (event: React.FocusEvent<HTMLInputElement>) => {\n      onChange({\n        name: operatorValue,\n        value: parseToNumber(event.currentTarget.value),\n      });\n    },\n    [onChange, operatorValue]\n  );\n\n  return <Input width={30} value={value} onChange={onChangeInput} onBlur={onBlurInput} />;\n};\n\nconst parseToNumber = (value: string | undefined): number => {\n  if (!value) {\n    return 0;\n  }\n\n  if (isNaN(value as unknown as number)) {\n    return 0;\n  }\n\n  return parseInt(value, 10);\n};\n","import React, { PureComponent } from 'react';\nimport { AsyncSelect } from '@grafana/ui';\nimport { ExpressionSuggestor } from '../types';\nimport { QueryEditorOperatorDefinition, QueryEditorOperator } from '../../types';\nimport { SelectableValue } from '@grafana/data';\n\ninterface Props {\n  value: string | undefined;\n  onChange: (operator: QueryEditorOperator) => void;\n  operator: QueryEditorOperatorDefinition;\n  getSuggestions: ExpressionSuggestor;\n  templateVariableOptions: SelectableValue<string>;\n}\n\ninterface State {\n  defaultOptions: Array<SelectableValue<string>>;\n  isLoading: boolean;\n}\n\nexport class QueryEditorSingleOperator extends PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      defaultOptions: [props.templateVariableOptions],\n      isLoading: false,\n    };\n  }\n\n  onChange = (evt: SelectableValue<any>) => {\n    // Handle clearing the value\n    if (evt === null) {\n      this.props.onChange({\n        value: '',\n        name: this.props.operator.value,\n      });\n      return;\n    }\n    this.props.onChange({\n      value: `${evt.value}`, // Currently strings only\n      name: this.props.operator.value,\n    });\n  };\n\n  onCreate = (value: string) => {\n    if (!value) {\n      return;\n    }\n    this.props.onChange({\n      value,\n      name: this.props.operator.value,\n    });\n  };\n\n  getSuggestions = async (txt: string) => {\n    this.setState({ isLoading: true });\n\n    const options = await this.props.getSuggestions(txt);\n\n    this.setState({\n      defaultOptions: [this.props.templateVariableOptions, ...options],\n      isLoading: false,\n    });\n\n    return options;\n  };\n\n  render() {\n    const { value } = this.props;\n    const current = value\n      ? {\n          label: value,\n          value,\n        }\n      : undefined;\n\n    return (\n      <AsyncSelect\n        width={30}\n        placeholder=\"Start typing to add filters...\"\n        loadOptions={this.getSuggestions}\n        onOpenMenu={() => this.getSuggestions(value ?? '')}\n        defaultOptions={this.state.defaultOptions}\n        isLoading={this.state.isLoading}\n        value={current}\n        onChange={this.onChange}\n        onCreateOption={this.onCreate}\n        allowCustomValue={true}\n        backspaceRemovesValue\n        isClearable\n        noOptionsMessage=\"No options found\"\n      />\n    );\n  }\n}\n","import React, { useCallback, useState } from 'react';\nimport { Input } from '@grafana/ui';\nimport { QueryEditorOperatorDefinition, QueryEditorOperator } from '../../types';\n\ninterface Props {\n  value: string | undefined;\n  onChange: (operator: QueryEditorOperator<string>) => void;\n  operator: QueryEditorOperatorDefinition;\n}\n\nexport const QueryEditorStringOperator: React.FC<Props> = (props) => {\n  const [value, setValue] = useState<string>(props.value ?? '');\n  const {\n    onChange,\n    operator: { value: operatorValue },\n  } = props;\n\n  const onChangeInput = useCallback(\n    (event: React.FormEvent<HTMLInputElement>) => {\n      setValue(event.currentTarget.value);\n    },\n    [setValue]\n  );\n\n  const onBlurInput = useCallback(\n    (event: React.FocusEvent<HTMLInputElement>) => {\n      onChange({\n        name: operatorValue,\n        value: event.currentTarget.value,\n      });\n    },\n    [onChange, operatorValue]\n  );\n\n  return <Input width={30} value={value} onChange={onChangeInput} onBlur={onBlurInput} />;\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Button, Select, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { isBoolOperator, isDateTimeOperator, isMultiOperator, isNumberOperator, isSingleOperator } from '../../guards';\nimport {\n  QueryEditorOperator,\n  QueryEditorOperatorDefinition,\n  QueryEditorProperty,\n  QueryEditorPropertyType,\n} from '../../types';\nimport { ExpressionSuggestor } from '../types';\nimport { parseOperatorValue } from './parser';\nimport { QueryEditorBoolOperator } from './QueryEditorBoolOperator';\nimport { QueryEditorMultiOperator } from './QueryEditorMultiOperator';\nimport { QueryEditorNumberOperator } from './QueryEditorNumberOperator';\nimport { QueryEditorSingleOperator } from './QueryEditorSingleOperator';\nimport { QueryEditorStringOperator } from './QueryEditorStringOperator';\n\ninterface Props {\n  value?: QueryEditorOperator;\n  property?: QueryEditorProperty;\n  operators: QueryEditorOperatorDefinition[];\n  onChange: (operator: QueryEditorOperator) => void;\n  getSuggestions: ExpressionSuggestor;\n  templateVariableOptions: SelectableValue<string>;\n}\n\nexport const definitionToOperator = (definition: QueryEditorOperatorDefinition): QueryEditorOperator => {\n  if (definition.booleanValues) {\n    const defaultValue: QueryEditorOperator<boolean> = {\n      name: definition.value,\n      value: false,\n    };\n\n    return defaultValue;\n  }\n\n  if (definition.multipleValues) {\n    const defaultValue: QueryEditorOperator<any[]> = {\n      name: definition.value,\n      value: [],\n    };\n\n    return defaultValue;\n  }\n\n  const defaultValue: QueryEditorOperator = {\n    name: definition.value,\n    value: '',\n  };\n\n  return defaultValue;\n};\n\nexport const QueryEditorOperatorComponent: React.FC<Props> = (props: Props) => {\n  const onChangeOperator = (selectable: SelectableValue<string>) => {\n    if (selectable && selectable.value) {\n      const { property, value } = props;\n      const definition = props.operators.find((o) => o.value === selectable.value);\n\n      if (!definition || !property) {\n        return;\n      }\n\n      if (!value) {\n        props.onChange(definitionToOperator(definition));\n        return;\n      }\n\n      const operator = definitionToOperator(definition);\n      const defaultValue = operator.value;\n      const currentValue = value.value;\n      operator.value = parseOperatorValue(property, definition, currentValue, defaultValue);\n\n      props.onChange(operator);\n    }\n  };\n\n  const onChangeValue = (operator: QueryEditorOperator) => {\n    props.onChange(operator);\n  };\n\n  const { operators, value, getSuggestions, templateVariableOptions, property } = props;\n  const styles = useStyles2(getStyles);\n  const definition = operators.find((o) => o.value === value?.name);\n\n  return (\n    <>\n      <div className={styles.container}>\n        <Select\n          isSearchable={true}\n          options={operators}\n          value={definition?.value}\n          onChange={onChangeOperator}\n          menuPlacement=\"bottom\"\n          renderControl={React.forwardRef(function F({ value, isOpen, invalid, ...otherProps }, ref) {\n            return (\n              <Button {...otherProps} ref={ref} variant=\"secondary\">\n                {definition?.label || definition?.value || '?'}\n              </Button>\n            );\n          })}\n        />\n      </div>\n      {renderOperatorInput(\n        definition,\n        value,\n        onChangeValue,\n        getSuggestions,\n        templateVariableOptions,\n        styles,\n        property?.type\n      )}\n    </>\n  );\n};\n\nconst renderOperatorInput = (\n  definition: QueryEditorOperatorDefinition | undefined,\n  operator: QueryEditorOperator | undefined,\n  onChangeValue: (expression: QueryEditorOperator) => void,\n  getSuggestions: ExpressionSuggestor,\n  templateVariableOptions: SelectableValue<string>,\n  styles: { [constainer: string]: string },\n  propertyType: QueryEditorPropertyType | undefined\n) => {\n  if (!definition) {\n    return null;\n  }\n\n  if (isDateTimeOperator(operator, propertyType)) {\n    return (\n      <div className={styles.container}>\n        <QueryEditorStringOperator operator={definition} value={operator?.value} onChange={onChangeValue} />\n      </div>\n    );\n  }\n\n  if (isNumberOperator(operator, propertyType)) {\n    return (\n      <div className={styles.container}>\n        <QueryEditorNumberOperator operator={definition} value={operator?.value} onChange={onChangeValue} />\n      </div>\n    );\n  }\n\n  if (definition.multipleValues && (isMultiOperator(operator) || !operator)) {\n    return (\n      <div className={styles.container}>\n        <QueryEditorMultiOperator\n          operator={definition}\n          values={operator?.value ?? []}\n          onChange={onChangeValue}\n          getSuggestions={getSuggestions}\n          templateVariableOptions={templateVariableOptions}\n        />\n      </div>\n    );\n  }\n\n  if (definition.booleanValues && (isBoolOperator(operator) || !operator)) {\n    return (\n      <div className={styles.container}>\n        <QueryEditorBoolOperator operator={definition} value={operator?.value} onChange={onChangeValue} />\n      </div>\n    );\n  }\n\n  if (!definition.multipleValues && (isSingleOperator(operator) || !operator)) {\n    return (\n      <div className={styles.container}>\n        <QueryEditorSingleOperator\n          operator={definition}\n          value={operator?.value}\n          onChange={onChangeValue}\n          getSuggestions={getSuggestions}\n          templateVariableOptions={templateVariableOptions}\n        />\n      </div>\n    );\n  }\n\n  return null;\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    margin-right: 4px;\n    /* when Grafanas Select has labels */\n    div[class*='grafana-select-option-description'] {\n      white-space: nowrap;\n    }\n    /* fallback until Grafanas Select has labels */\n    [aria-label*='Select options menu'] {\n      div {\n        div {\n          div {\n            div {\n              div {\n                white-space: nowrap;\n              }\n            }\n          }\n        }\n      }\n    }\n  `,\n});\n","import { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\nimport debounce from 'debounce-promise';\nimport { css } from '@emotion/css';\nimport React, { useState } from 'react';\nimport { useEffectOnce } from 'react-use';\n\nimport { QueryEditorExpressionType, QueryEditorOperatorExpression } from '../../expressions';\nimport {\n  QueryEditorOperator,\n  QueryEditorOperatorDefinition,\n  QueryEditorProperty,\n  QueryEditorPropertyDefinition,\n} from '../../types';\nimport { QueryEditorField } from '../field/QueryEditorField';\nimport { parseOperatorValue } from '../operators/parser';\nimport { definitionToOperator, QueryEditorOperatorComponent } from '../operators/QueryEditorOperator';\nimport { SkippableExpressionSuggestor } from '../types';\n\ninterface Props {\n  value?: QueryEditorOperatorExpression;\n  fields: QueryEditorPropertyDefinition[];\n  templateVariableOptions: SelectableValue<string>;\n  operators: QueryEditorOperatorDefinition[];\n  onChange: (expression: QueryEditorOperatorExpression) => void;\n  getSuggestions: SkippableExpressionSuggestor;\n}\n\nexport const QueryEditorFieldAndOperator: React.FC<Props> = (props: Props) => {\n  // operators we can use for the field\n  const [operators, setOperators] = useState<QueryEditorOperatorDefinition[]>([]);\n\n  // Find the valid operators to the given field and save it in state\n  const updateOperators = (field: QueryEditorProperty): QueryEditorOperatorDefinition[] => {\n    const operators: QueryEditorOperatorDefinition[] = [];\n    for (const op of props.operators) {\n      if (op.supportTypes.includes(field.type)) {\n        operators.push(op);\n      }\n    }\n    setOperators(operators);\n    return operators;\n  };\n\n  useEffectOnce(() => {\n    const field = props.value?.property;\n    if (field) {\n      updateOperators(field);\n    }\n  });\n\n  const onFieldChanged = (property: QueryEditorProperty) => {\n    let next: QueryEditorOperatorExpression = {\n      ...props.value!,\n      property,\n    };\n\n    const operators = updateOperators(property);\n    const currentOperator = next.operator?.name;\n    const definition = operators.find((op) => op.value === currentOperator);\n\n    if (operators.length && !definition) {\n      next.operator = definitionToOperator(operators[0]);\n      const defaultValue = next.operator.value;\n      const currentValue = props.value?.operator.value;\n      next.operator.value = parseOperatorValue(next.property, operators[0], currentValue, defaultValue);\n    }\n\n    if (!definition) {\n      return props.onChange(next);\n    }\n\n    // Give it default values\n    next.operator = definitionToOperator(definition);\n    const defaultValue = next.operator.value;\n    const currentValue = props.value?.operator.value;\n    next.operator.value = parseOperatorValue(next.property, definition, currentValue, defaultValue);\n    props.onChange(next);\n  };\n\n  const onOperatorChange = (operator: QueryEditorOperator) => {\n    props.onChange({\n      ...props.value!,\n      operator,\n    });\n  };\n\n  const getSuggestions = debounce(\n    async (txt: string) => {\n      if (!props.value) {\n        return [];\n      }\n\n      const filter = createFilter(props.value.property, txt);\n      const results = await props.getSuggestions(filter);\n\n      if (Array.isArray(props.templateVariableOptions?.options)) {\n        const variables = props.templateVariableOptions.options.filter((v) => {\n          if (typeof v?.value === 'string') {\n            return v.value.indexOf(txt) > -1;\n          }\n          return false;\n        });\n\n        Array.prototype.push.apply(results, variables);\n      }\n\n      return results;\n    },\n    800,\n    { leading: false }\n  );\n\n  const { value, fields, templateVariableOptions } = props;\n\n  const styles = useStyles2(getStyles);\n  const showOperators = value?.operator || value?.property;\n\n  return (\n    <div className={styles.container}>\n      <QueryEditorField\n        value={value?.property}\n        fields={fields}\n        templateVariableOptions={templateVariableOptions}\n        onChange={onFieldChanged}\n        placeholder=\"Choose column...\"\n      />\n      {showOperators && (\n        <QueryEditorOperatorComponent\n          value={value?.operator}\n          operators={operators}\n          onChange={onOperatorChange}\n          getSuggestions={getSuggestions}\n          property={value?.property}\n          templateVariableOptions={templateVariableOptions}\n        />\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    flex-direction: row;\n  `,\n});\n\nconst createFilter = (property: QueryEditorProperty, value: string): QueryEditorOperatorExpression => {\n  if (!value) {\n    return {\n      type: QueryEditorExpressionType.Operator,\n      property: property,\n      operator: {\n        name: 'isnotempty',\n        value,\n      },\n    };\n  }\n\n  return {\n    type: QueryEditorExpressionType.Operator,\n    property: property,\n    operator: {\n      name: 'contains',\n      value,\n    },\n  };\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Button, InlineFormLabel, Select, useStyles2 } from '@grafana/ui';\nimport { isFieldAndOperator, isOrExpression } from 'editor/guards';\nimport React from 'react';\n\nimport {\n  QueryEditorArrayExpression,\n  QueryEditorExpressionType,\n  QueryEditorOperatorExpression,\n} from '../../expressions';\nimport { QueryEditorOperatorDefinition, QueryEditorPropertyDefinition } from '../../types';\nimport { QueryEditorRepeater } from '../QueryEditorRepeater';\nimport { QueryEditorSection, QueryEditorSectionProps } from '../QueryEditorSection';\nimport { SearchExpressionSuggestor, SkippableExpressionSuggestor } from '../types';\nimport { QueryEditorFieldAndOperator } from './QueryEditorFieldAndOperator';\n\ninterface FilterSectionConfiguration {\n  operators: QueryEditorOperatorDefinition[];\n  defaultValue: QueryEditorOperatorExpression;\n}\n\nexport interface QueryEditorFilterSectionProps extends QueryEditorSectionProps {\n  fields: QueryEditorPropertyDefinition[];\n  templateVariableOptions: SelectableValue<string>;\n  value: QueryEditorArrayExpression;\n  onChange: (value: QueryEditorArrayExpression) => void;\n  getSuggestions: SearchExpressionSuggestor;\n}\n\nexport const QueryEditorFilterSection = (\n  config: FilterSectionConfiguration\n): React.FC<QueryEditorFilterSectionProps> => {\n  return function F(props) {\n    const styles = useStyles2(getStyles);\n\n    const getSuggestions = (index: string): SkippableExpressionSuggestor => {\n      return (search: QueryEditorOperatorExpression) => props.getSuggestions(index, search);\n    };\n\n    if (props.value?.expressions?.length === 0) {\n      return (\n        <QueryEditorSection label={props.label} tooltip={props.tooltip}>\n          <Button\n            variant=\"secondary\"\n            onClick={() => {\n              const next: QueryEditorArrayExpression = {\n                ...props.value,\n                expressions: [\n                  {\n                    type: QueryEditorExpressionType.Or,\n                    expressions: [config.defaultValue],\n                  } as QueryEditorArrayExpression,\n                ],\n              };\n\n              props.onChange(next);\n            }}\n            icon=\"plus\"\n          />\n        </QueryEditorSection>\n      );\n    }\n\n    return (\n      <QueryEditorRepeater id=\"filter-and\" value={props.value} onChange={props.onChange}>\n        {(filterProps) => {\n          if (!isOrExpression(filterProps.value)) {\n            return null;\n          }\n\n          if (filterProps.value?.expressions?.length === 0) {\n            if (filterProps.index > 0) {\n              return null;\n            }\n\n            return (\n              <QueryEditorSection label={props.label} tooltip={props.tooltip}>\n                <Button\n                  variant=\"secondary\"\n                  onClick={() => {\n                    const expression: QueryEditorArrayExpression = {\n                      type: QueryEditorExpressionType.Or,\n                      expressions: [config.defaultValue],\n                    };\n\n                    filterProps.onChange(expression);\n                  }}\n                  icon=\"plus\"\n                />\n              </QueryEditorSection>\n            );\n          }\n\n          return (\n            <QueryEditorSection label={props.label} tooltip={props.tooltip}>\n              <div className={styles.container}>\n                <QueryEditorRepeater id=\"filter-or\" value={filterProps.value} onChange={filterProps.onChange}>\n                  {(operatorProps) => {\n                    if (!isFieldAndOperator(operatorProps.value)) {\n                      console.log('invalid fieldandoperator-expression');\n                      return null;\n                    }\n\n                    const isFirst = operatorProps.index === 0;\n                    const rowStyles = isFirst ? styles.row : styles.rowWithSpacing;\n\n                    return (\n                      <div className={rowStyles}>\n                        {!isFirst && (\n                          <InlineFormLabel className=\"query-keyword\" width={3}>\n                            or\n                          </InlineFormLabel>\n                        )}\n                        <QueryEditorFieldAndOperator\n                          value={operatorProps.value}\n                          operators={config.operators}\n                          fields={props.fields}\n                          templateVariableOptions={props.templateVariableOptions}\n                          onChange={operatorProps.onChange}\n                          getSuggestions={getSuggestions(`${filterProps.index}-${operatorProps.index}`)}\n                        />\n                        <div className={styles.spacing}>\n                          <Button variant=\"secondary\" onClick={operatorProps.onRemove} icon=\"minus\" />\n                        </div>\n                        {isFirst && (\n                          <Select\n                            isSearchable={true}\n                            options={[\n                              {\n                                value: 'append-row',\n                                label: 'OR - include another option',\n                              },\n                              {\n                                value: 'new-row',\n                                label: `AND - add a new \"${props.label}\" clause`,\n                              },\n                            ]}\n                            onChange={(value) => {\n                              if (value?.value === 'append-row') {\n                                return operatorProps.onAdd(config.defaultValue);\n                              }\n\n                              if (value?.value === 'new-row') {\n                                return filterProps.onAdd({\n                                  type: QueryEditorExpressionType.Or,\n                                  expressions: [config.defaultValue],\n                                } as QueryEditorArrayExpression);\n                              }\n                            }}\n                            menuPlacement=\"bottom\"\n                            renderControl={React.forwardRef(function F({ value, isOpen, invalid, ...otherProps }, ref) {\n                              return <Button {...otherProps} ref={ref} variant=\"secondary\" icon=\"plus\" />;\n                            })}\n                          />\n                        )}\n                      </div>\n                    );\n                  }}\n                </QueryEditorRepeater>\n              </div>\n            </QueryEditorSection>\n          );\n        }}\n      </QueryEditorRepeater>\n    );\n  };\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  const row = css`\n    display: flex;\n    flex-direction: row;\n  `;\n\n  return {\n    container: css`\n      display: flex;\n      flex-direction: column;\n    `,\n    row: row,\n    rowWithSpacing: css`\n      ${row}\n      margin-top: 4px;\n    `,\n    spacing: css`\n      margin-right: 4px;\n    `,\n  };\n};\n","import { QueryEditorOperatorDefinition, QueryEditorPropertyType } from '../types';\n\nexport class QueyEditorOperatorBuilder {\n  private label: string;\n  private description: string;\n  private types: QueryEditorPropertyType[];\n  private multiple: boolean;\n  private bool: boolean;\n\n  constructor(private value: string, private operators: QueryEditorOperatorDefinition[]) {\n    this.label = value;\n    this.types = [];\n    this.description = '';\n    this.multiple = false;\n    this.bool = false;\n  }\n\n  withLabel(label: string) {\n    this.label = label;\n    return this;\n  }\n\n  withDescription(description: string) {\n    this.description = description;\n    return this;\n  }\n\n  supportTypes(types: QueryEditorPropertyType[]) {\n    this.types = types;\n    return this;\n  }\n\n  multipleValues(multiple: boolean) {\n    this.multiple = multiple;\n    return this;\n  }\n\n  booleanValues(bool: boolean) {\n    this.bool = bool;\n    return this;\n  }\n\n  add(): void {\n    this.operators.push({\n      value: this.value,\n      supportTypes: this.types,\n      label: this.label,\n      description: this.description,\n      multipleValues: this.multiple,\n      booleanValues: this.bool,\n    });\n  }\n}\n","import React from 'react';\nimport { QueryEditorFilterSectionProps, QueryEditorFilterSection } from '../components/filter/QueryEditorFilterSection';\nimport { QueryEditorOperatorDefinition, QueryEditorPropertyType, QueryEditorProperty } from '../types';\nimport { QueyEditorOperatorBuilder } from './QueryEditorOperatorBuilder';\nimport { QueryEditorOperatorExpression, QueryEditorExpressionType } from '../expressions';\nimport { definitionToOperator } from '../components/operators/QueryEditorOperator';\n\nexport class QueryEditorFilterBuilder {\n  private operators: QueryEditorOperatorDefinition[];\n  //private multipleRows: boolean;\n\n  constructor() {\n    this.operators = [];\n    // this.multipleRows = false;\n  }\n\n  withOperators(operators: (builder: (value: string) => QueyEditorOperatorBuilder) => void) {\n    operators((value) => new QueyEditorOperatorBuilder(value, this.operators));\n    return this;\n  }\n\n  withMultipleRows(value: boolean) {\n    // this.multipleRows = value;\n    return this;\n  }\n\n  build(): React.FC<QueryEditorFilterSectionProps> {\n    return QueryEditorFilterSection({\n      operators: this.operators,\n      defaultValue: this.buildOperatorExpression(),\n    });\n  }\n\n  private buildOperatorExpression(): QueryEditorOperatorExpression {\n    const operator = this.operators[0];\n\n    return {\n      type: QueryEditorExpressionType.Operator,\n      property: this.buildFieldExpression(),\n      operator: definitionToOperator(operator),\n    };\n  }\n\n  private buildFieldExpression(): QueryEditorProperty {\n    return {\n      name: '',\n      type: QueryEditorPropertyType.String,\n    };\n  }\n}\n","import React, { useState, useCallback } from 'react';\nimport { Input } from '@grafana/ui';\nimport { QueryEditorPropertyType } from '../../types';\nimport { QueryEditorFunctionParameterExpression, QueryEditorExpressionType } from '../../expressions';\n\ninterface Props {\n  name: string;\n  value: string | undefined;\n  fieldType: QueryEditorPropertyType;\n  description: string;\n  onChange: (expression: QueryEditorFunctionParameterExpression) => void;\n}\n\nexport const QueryEditorFunctionParameterSection: React.FC<Props> = (props) => {\n  const [value, setValue] = useState(props.value ?? '');\n\n  const onChange = useCallback(\n    (event: React.FormEvent<HTMLInputElement>) => {\n      if (!event || !event.currentTarget) {\n        return;\n      }\n      setValue(event.currentTarget.value);\n    },\n    [setValue]\n  );\n\n  const onBlur = useCallback(() => {\n    props.onChange({\n      type: QueryEditorExpressionType.FunctionParameter,\n      fieldType: props.fieldType,\n      value: value,\n      name: props.name,\n    });\n  }, [value, props]);\n\n  return <Input width={20} value={value} placeholder={props.description} onChange={onChange} onBlur={onBlur} />;\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { InlineFormLabel, useStyles2 } from '@grafana/ui';\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\n\nimport {\n  QueryEditorExpressionType,\n  QueryEditorFunctionParameterExpression,\n  QueryEditorReduceExpression,\n} from '../../expressions';\nimport {\n  QueryEditorFunctionDefinition,\n  QueryEditorFunctionParameter,\n  QueryEditorProperty,\n  QueryEditorPropertyDefinition,\n  QueryEditorPropertyType,\n} from '../../types';\nimport { QueryEditorField } from '../field/QueryEditorField';\nimport { QueryEditorFunctionParameterSection } from '../field/QueryEditorFunctionParameterSection';\n\ninterface Props {\n  fields: QueryEditorPropertyDefinition[];\n  templateVariableOptions: SelectableValue<string>;\n  functions: QueryEditorFunctionDefinition[];\n  value?: QueryEditorReduceExpression;\n  label?: string;\n  onChange: (expression: QueryEditorReduceExpression) => void;\n}\n\nexport const QueryEditorReduce: React.FC<Props> = (props) => {\n  const { value, functions, onChange } = props;\n  const [field, setField] = useState(props.value?.property);\n  const [reduce, setReduce] = useState(props.value?.reduce);\n  const [parameters, setParameters] = useState(props.value?.parameters);\n  const applyOnField = useApplyOnField(reduce, props.functions);\n  const styles = useStyles2(getStyles);\n\n  const onChangeField = useCallback(\n    (property: QueryEditorProperty) => {\n      setField(property);\n\n      // Set a reasonable value\n      if (!value?.reduce?.name) {\n        let reducer = functions.find((f) => f.value === 'avg');\n        if (!reducer) {\n          reducer = functions[0];\n        }\n        setReduce({\n          name: reducer.value,\n          type: QueryEditorPropertyType.Function,\n        });\n      }\n    },\n    [setField, value, functions]\n  );\n\n  const onChangeReduce = useCallback(\n    (property: QueryEditorProperty) => {\n      setReduce(property);\n    },\n    [setReduce]\n  );\n\n  const onChangeParameter = useCallback(\n    (expression: QueryEditorFunctionParameterExpression[]) => {\n      setParameters(expression);\n    },\n    [setParameters]\n  );\n\n  /* eslint-disable react-hooks/exhaustive-deps */\n  useEffect(() => {\n    if (field && reduce) {\n      const payload: QueryEditorReduceExpression = {\n        type: QueryEditorExpressionType.Reduce,\n        property: field,\n        reduce,\n        parameters: parameters,\n      };\n\n      onChange(payload); // adding onChange to dependency array below causes maximum call depth error\n    }\n  }, [field, reduce, parameters]);\n  /* eslint-enable react-hooks/exhaustive-deps */\n\n  const reduceParameters: QueryEditorFunctionParameter[] = getParameters(reduce, props.functions);\n\n  return (\n    <div className={styles.container}>\n      <QueryEditorField\n        value={reduce}\n        fields={props.functions}\n        onChange={onChangeReduce}\n        placeholder=\"Choose aggregation function...\"\n      />\n      {reduceParameters.length > 0 && (\n        <div className={styles.params}>\n          {reduceParameters.map((param) => {\n            return (\n              <QueryEditorFunctionParameterSection\n                key={param.name}\n                name={param.name}\n                value={props.value?.parameters?.find((p) => p.name === param.name)?.value}\n                description={param.description}\n                fieldType={param.type}\n                onChange={(val) => onChangeParameter([val])}\n              />\n            );\n          })}\n        </div>\n      )}\n      {applyOnField && (\n        <>\n          <InlineFormLabel width={2} className=\"query-keyword\">\n            {props.label ?? 'of'}\n          </InlineFormLabel>\n          <QueryEditorField\n            value={field}\n            fields={props.fields}\n            templateVariableOptions={props.templateVariableOptions}\n            onChange={onChangeField}\n            placeholder=\"Choose column...\"\n          />\n        </>\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    flex-direction: row;\n  `,\n  params: css`\n    margin-right: 4px;\n  `,\n});\n\nconst getParameters = (\n  reduce: QueryEditorProperty | undefined,\n  functions: QueryEditorFunctionDefinition[]\n): QueryEditorFunctionParameter[] => {\n  if (!reduce) {\n    return [];\n  }\n  const func = functions.find((func) => func.value === reduce.name);\n\n  return func?.parameters || [];\n};\n\nconst useApplyOnField = (\n  property: QueryEditorProperty | undefined,\n  functions: QueryEditorFunctionDefinition[]\n): boolean => {\n  return useMemo(() => {\n    if (!property) {\n      return functions[0]?.applyOnField ?? true;\n    }\n    const func = functions.find((f) => f.value === property.name);\n    return func?.applyOnField ?? true;\n  }, [functions, property]);\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { isReduceExpression } from 'editor/guards';\nimport React from 'react';\n\nimport { QueryEditorArrayExpression, QueryEditorExpression } from '../../expressions';\nimport { QueryEditorFunctionDefinition, QueryEditorPropertyDefinition } from '../../types';\nimport { QueryEditorRepeater } from '../QueryEditorRepeater';\nimport { QueryEditorSection, QueryEditorSectionProps } from '../QueryEditorSection';\nimport { QueryEditorReduce } from './QueryEditorReduce';\n\ninterface ReduceSectionConfiguration {\n  defaultValue: QueryEditorExpression;\n  functions: QueryEditorFunctionDefinition[];\n}\n\nexport interface QueryEditorReduceSectionProps extends QueryEditorSectionProps {\n  fields: QueryEditorPropertyDefinition[];\n  templateVariableOptions: SelectableValue<string>;\n  value: QueryEditorArrayExpression;\n  onChange: (value: QueryEditorArrayExpression) => void;\n}\n\nexport const QueryEditorReduceSection = (\n  config: ReduceSectionConfiguration\n): React.FC<QueryEditorReduceSectionProps> => {\n  return function F(props) {\n    const styles = useStyles2(getStyles);\n\n    if (props.value.expressions.length === 0) {\n      return (\n        <QueryEditorSection label={props.label} tooltip={props.tooltip}>\n          <Button\n            variant=\"secondary\"\n            onClick={() => {\n              const expression: QueryEditorArrayExpression = {\n                ...props.value,\n                expressions: [config.defaultValue],\n              };\n              props.onChange(expression);\n            }}\n            icon=\"plus\"\n          />\n        </QueryEditorSection>\n      );\n    }\n\n    return (\n      <QueryEditorSection label={props.label} tooltip={props.tooltip}>\n        <div className={styles.container}>\n          <QueryEditorRepeater id=\"reduce\" onChange={props.onChange} value={props.value}>\n            {(childProps) => {\n              if (!isReduceExpression(childProps.value)) {\n                return null;\n              }\n\n              const isFirst = childProps.index === 0;\n              const rowStyle = isFirst ? styles.row : styles.rowWithSpacing;\n\n              return (\n                <div className={rowStyle}>\n                  <QueryEditorReduce\n                    onChange={childProps.onChange}\n                    value={childProps.value}\n                    templateVariableOptions={props.templateVariableOptions}\n                    fields={props.fields}\n                    functions={config.functions}\n                  />\n                  <Button className={styles.spacing} variant=\"secondary\" onClick={childProps.onRemove} icon=\"minus\" />\n                  {isFirst && (\n                    <Button variant=\"secondary\" onClick={() => childProps.onAdd(config.defaultValue)} icon=\"plus\" />\n                  )}\n                </div>\n              );\n            }}\n          </QueryEditorRepeater>\n        </div>\n      </QueryEditorSection>\n    );\n  };\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  const row = css`\n    display: flex;\n    flex-direction: row;\n  `;\n\n  return {\n    container: css`\n      display: flex;\n      flex-direction: column;\n    `,\n    row: row,\n    rowWithSpacing: css`\n      ${row}\n      margin-top: 4px;\n    `,\n    spacing: css`\n      margin-right: 4px;\n    `,\n  };\n};\n","import { QueryEditorPropertyType, QueryEditorFunctionDefinition, QueryEditorFunctionParameter } from '../types';\n\nexport class QueryEditorFunctionBuilder {\n  private label: string;\n  private appliedOnField = true;\n  private parameters: QueryEditorFunctionParameter[] = [];\n\n  constructor(private value: string, private functions: QueryEditorFunctionDefinition[]) {\n    this.label = value;\n  }\n\n  withLabel(label: string) {\n    this.label = label;\n    return this;\n  }\n\n  withParameter(name: string, type: QueryEditorPropertyType, description: string) {\n    this.parameters.push({ name, type, description });\n    return this;\n  }\n\n  isAppliedOnField(value: boolean) {\n    this.appliedOnField = value;\n    return this;\n  }\n\n  add(): void {\n    this.functions.push({\n      value: this.value,\n      label: this.label,\n      type: QueryEditorPropertyType.Function,\n      parameters: this.parameters,\n      applyOnField: this.appliedOnField,\n    });\n  }\n}\n","import React from 'react';\nimport { QueryEditorFunctionDefinition, QueryEditorPropertyType, QueryEditorProperty } from '../types';\nimport { QueryEditorReduceSection, QueryEditorReduceSectionProps } from '../components/reduce/QueryEditorReduceSection';\nimport { QueryEditorFunctionBuilder } from './QueryEditorFunctionBuilder';\nimport { QueryEditorReduceExpression, QueryEditorExpressionType } from '../expressions';\n\nexport class QueryEditorReduceBuilder {\n  private functions: QueryEditorFunctionDefinition[];\n\n  constructor() {\n    this.functions = [];\n  }\n\n  withMultipleRows(value: boolean) {\n    return this;\n  }\n\n  withFunctions(functions: (builder: (value: string) => QueryEditorFunctionBuilder) => void) {\n    functions((value) => new QueryEditorFunctionBuilder(value, this.functions));\n    return this;\n  }\n\n  build(): React.FC<QueryEditorReduceSectionProps> {\n    return QueryEditorReduceSection({\n      functions: this.functions,\n      defaultValue: this.buildReduceExpression(),\n    });\n  }\n\n  private buildReduceExpression(): QueryEditorReduceExpression {\n    return {\n      type: QueryEditorExpressionType.Reduce,\n      property: this.buildProperty(QueryEditorPropertyType.String),\n      reduce: this.buildProperty(QueryEditorPropertyType.Function),\n    };\n  }\n\n  private buildProperty(type: QueryEditorPropertyType): QueryEditorProperty {\n    return {\n      name: '',\n      type,\n    };\n  }\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\nimport React, { useCallback, useEffect, useState } from 'react';\n\nimport { QueryEditorExpressionType, QueryEditorGroupByExpression } from '../../expressions';\nimport { QueryEditorProperty, QueryEditorPropertyDefinition, QueryEditorPropertyType } from '../../types';\nimport { QueryEditorField } from '../field/QueryEditorField';\n\ninterface Props {\n  fields: QueryEditorPropertyDefinition[];\n  templateVariableOptions: SelectableValue<string>;\n  intervals: QueryEditorPropertyDefinition[];\n  value?: QueryEditorGroupByExpression;\n  onChange: (expression: QueryEditorGroupByExpression) => void;\n}\n\nexport const QueryEditorGroupBy: React.FC<Props> = (props) => {\n  const { intervals, onChange } = props;\n  const [field, setField] = useState(props.value?.property);\n  const [interval, setInterval] = useState(props.value?.interval);\n  const styles = useStyles2(getStyles);\n\n  const onChangeField = useCallback(\n    (property: QueryEditorProperty) => {\n      setField(property);\n      if (property.type === QueryEditorPropertyType.DateTime) {\n        setInterval({\n          type: QueryEditorPropertyType.Interval,\n          name: intervals[0].value,\n        });\n      }\n    },\n    [setField, intervals]\n  );\n\n  const onChangeInterval = useCallback(\n    (property: QueryEditorProperty) => {\n      setInterval(property);\n    },\n    [setInterval]\n  );\n\n  /* eslint-disable react-hooks/exhaustive-deps */\n  useEffect(() => {\n    if (field) {\n      const payload: QueryEditorGroupByExpression = {\n        type: QueryEditorExpressionType.GroupBy,\n        property: field,\n        interval,\n      };\n\n      onChange(payload); // adding onChange to dependency array below causes maximum call depth error\n    }\n  }, [field, interval]);\n  /* eslint-enable react-hooks/exhaustive-deps */\n\n  return (\n    <div className={styles.container}>\n      <QueryEditorField\n        value={field}\n        fields={props.fields}\n        templateVariableOptions={props.templateVariableOptions}\n        onChange={onChangeField}\n        placeholder=\"Choose column...\"\n      />\n      {field?.type === QueryEditorPropertyType.DateTime && (\n        <QueryEditorField\n          value={interval}\n          fields={props.intervals}\n          templateVariableOptions={props.templateVariableOptions}\n          onChange={onChangeInterval}\n          placeholder=\"Choose interval\"\n          allowCustom={true}\n        />\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    flex-direction: row;\n  `,\n});\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { QueryEditorArrayExpression, QueryEditorExpression } from '../../expressions';\nimport { isGroupBy } from '../../guards';\nimport { QueryEditorPropertyDefinition } from '../../types';\nimport { QueryEditorRepeater } from '../QueryEditorRepeater';\nimport { QueryEditorSection, QueryEditorSectionProps } from '../QueryEditorSection';\nimport { QueryEditorGroupBy } from './QueryEditorGroupBy';\n\ninterface GroupBySectionConfiguration {\n  defaultValue: QueryEditorExpression;\n  intervals: QueryEditorPropertyDefinition[];\n}\n\nexport interface QueryEditorGroupBySectionProps extends QueryEditorSectionProps {\n  fields: QueryEditorPropertyDefinition[];\n  templateVariableOptions: SelectableValue<string>;\n  value: QueryEditorArrayExpression;\n  onChange: (value: QueryEditorArrayExpression) => void;\n}\n\nexport const QueryEditorGroupBySection = (\n  config: GroupBySectionConfiguration\n): React.FC<QueryEditorGroupBySectionProps> => {\n  return function F(props) {\n    const styles = useStyles2(getStyles);\n\n    if (props.value.expressions.length === 0) {\n      return (\n        <QueryEditorSection label={props.label} tooltip={props.tooltip}>\n          <Button\n            variant=\"secondary\"\n            onClick={() => {\n              const expression: QueryEditorArrayExpression = {\n                ...props.value,\n                expressions: [config.defaultValue],\n              };\n              props.onChange(expression);\n            }}\n            icon=\"plus\"\n          />\n        </QueryEditorSection>\n      );\n    }\n\n    return (\n      <QueryEditorSection label={props.label} tooltip={props.tooltip}>\n        <div className={styles.container}>\n          <QueryEditorRepeater id=\"group-by\" onChange={props.onChange} value={props.value}>\n            {(childProps) => {\n              if (!isGroupBy(childProps.value)) {\n                return null;\n              }\n\n              const isFirst = childProps.index === 0;\n              const rowStyle = isFirst ? styles.row : styles.rowWithSpacing;\n\n              return (\n                <div className={rowStyle}>\n                  <QueryEditorGroupBy\n                    onChange={childProps.onChange}\n                    value={childProps.value}\n                    templateVariableOptions={props.templateVariableOptions}\n                    fields={props.fields}\n                    intervals={config.intervals}\n                  />\n                  <Button className={styles.spacing} variant=\"secondary\" onClick={childProps.onRemove} icon=\"minus\" />\n                  {isFirst && (\n                    <Button variant=\"secondary\" onClick={() => childProps.onAdd(config.defaultValue)} icon=\"plus\" />\n                  )}\n                </div>\n              );\n            }}\n          </QueryEditorRepeater>\n        </div>\n      </QueryEditorSection>\n    );\n  };\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  const row = css`\n    display: flex;\n    flex-direction: row;\n  `;\n\n  return {\n    container: css`\n      display: flex;\n      flex-direction: column;\n    `,\n    row: row,\n    rowWithSpacing: css`\n      ${row}\n      margin-top: 4px;\n    `,\n    spacing: css`\n      margin-right: 4px;\n    `,\n  };\n};\n","import { QueryEditorPropertyType, QueryEditorPropertyDefinition } from '../types';\n\nexport class QueryEditorIntervalBuilder {\n  private label: string;\n\n  constructor(private value: string, private intervals: QueryEditorPropertyDefinition[]) {\n    this.label = value;\n  }\n\n  withLabel(label: string) {\n    this.label = label;\n    return this;\n  }\n\n  add(): void {\n    this.intervals.push({\n      value: this.value,\n      label: this.label,\n      type: QueryEditorPropertyType.Interval,\n    });\n  }\n}\n","import React from 'react';\nimport { QueryEditorPropertyDefinition, QueryEditorPropertyType } from '../types';\nimport {\n  QueryEditorGroupBySection,\n  QueryEditorGroupBySectionProps,\n} from '../components/groupBy/QueryEditorGroupBySection';\nimport { QueryEditorIntervalBuilder } from './QueryEditorIntervalBuilder';\nimport { QueryEditorGroupByExpression, QueryEditorExpressionType } from '../expressions';\n\nexport class QueryEditorGroupByBuilder {\n  private intervals: QueryEditorPropertyDefinition[];\n\n  constructor() {\n    this.intervals = [];\n  }\n\n  withMultipleRows(value: boolean) {\n    return this;\n  }\n\n  withIntervals(intervals: (builder: (value: string) => QueryEditorIntervalBuilder) => void) {\n    intervals((value) => new QueryEditorIntervalBuilder(value, this.intervals));\n    return this;\n  }\n\n  build(): React.FC<QueryEditorGroupBySectionProps> {\n    return QueryEditorGroupBySection({\n      intervals: this.intervals,\n      defaultValue: this.buildGroupByExpressions(),\n    });\n  }\n\n  private buildGroupByExpressions(): QueryEditorGroupByExpression {\n    return {\n      type: QueryEditorExpressionType.GroupBy,\n      property: {\n        name: '',\n        type: QueryEditorPropertyType.String,\n      },\n    };\n  }\n}\n","import {\n  buildFieldQueryEditorSection,\n  buildFilterQueryEditorSection,\n  buildGroupByQueryEditorSection,\n  buildReduceQueryEditorSection,\n} from '../editor';\nimport { QueryEditorPropertyType } from '../editor/types';\n\nexport const KustoPropertyEditorSection = buildFieldQueryEditorSection((fieldSection) => fieldSection.build());\n\nexport const KustoWhereEditorSection = buildFilterQueryEditorSection((filterSection) =>\n  filterSection\n    .withOperators((operator) => {\n      operator('==')\n        .supportTypes([\n          QueryEditorPropertyType.String,\n          QueryEditorPropertyType.Number,\n          QueryEditorPropertyType.DateTime,\n        ])\n        .withDescription('equal to')\n        .add();\n\n      operator('==')\n        .supportTypes([QueryEditorPropertyType.Boolean])\n        .withDescription('equal to')\n        .booleanValues(true)\n        .add();\n\n      operator('!=')\n        .supportTypes([\n          QueryEditorPropertyType.String,\n          QueryEditorPropertyType.Number,\n          QueryEditorPropertyType.DateTime,\n        ])\n        .withDescription('not equal to')\n        .add();\n\n      operator('!=')\n        .supportTypes([QueryEditorPropertyType.Boolean])\n        .withDescription('not equal to')\n        .booleanValues(true)\n        .add();\n\n      operator('>')\n        .supportTypes([\n          QueryEditorPropertyType.Number,\n          QueryEditorPropertyType.DateTime,\n          QueryEditorPropertyType.TimeSpan,\n        ])\n        .withDescription('greater than')\n        .add();\n\n      operator('<')\n        .supportTypes([\n          QueryEditorPropertyType.Number,\n          QueryEditorPropertyType.DateTime,\n          QueryEditorPropertyType.TimeSpan,\n        ])\n        .withDescription('less than')\n        .add();\n\n      operator('=~')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('equal to (case-insensitive)')\n        .add();\n\n      operator('!~')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('not equal to (case-insensitive)')\n        .add();\n\n      operator('in')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('in (case-sensitive)')\n        .multipleValues(true)\n        .add();\n\n      operator('in~')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('in (case-insensitive)')\n        .multipleValues(true)\n        .add();\n\n      operator('!in')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('not in (case-sensitive)')\n        .multipleValues(true)\n        .add();\n\n      operator('!in~')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('not in (case-insensitive)')\n        .multipleValues(true)\n        .add();\n\n      operator('contains')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('contains substring')\n        .multipleValues(false)\n        .add();\n\n      operator('!contains')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('does not contain substring')\n        .multipleValues(false)\n        .add();\n\n      operator('contains_cs')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('contains substring (case-sensitive)')\n        .multipleValues(false)\n        .add();\n\n      operator('!contains_cs')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('does not contain substring (case-sensitive)')\n        .multipleValues(false)\n        .add();\n\n      operator('endswith')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('ends with')\n        .multipleValues(false)\n        .add();\n\n      operator('!endswith')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('does not end with')\n        .multipleValues(false)\n        .add();\n\n      operator('endswith_cs')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('ends with (case-sensitive)')\n        .multipleValues(false)\n        .add();\n\n      operator('!endswith_cs')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('does not end with (case-sensitive)')\n        .multipleValues(false)\n        .add();\n\n      operator('startswith')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('starts with')\n        .multipleValues(false)\n        .add();\n\n      operator('!startsswith')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('does not start with')\n        .multipleValues(false)\n        .add();\n\n      operator('startswith_cs')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('starts with (case-sensitive)')\n        .multipleValues(false)\n        .add();\n\n      operator('!startswith_cs')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('does not start with (case-sensitive)')\n        .multipleValues(false)\n        .add();\n\n      operator('matches regex')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('regex string matching')\n        .multipleValues(false)\n        .add();\n\n      operator('has_any')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('any provided values matching')\n        .multipleValues(true)\n        .add();\n\n      operator('has')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('match if whole term exists in column')\n        .multipleValues(false)\n        .add();\n\n      operator('!has')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('match if whole term not exists in column')\n        .multipleValues(false)\n        .add();\n    })\n    .withMultipleRows(true)\n    .build()\n);\n\nexport const KustoValueColumnEditorSection = buildReduceQueryEditorSection((reduceSection) =>\n  reduceSection\n    .withFunctions((functions) => {\n      functions('sum').withLabel('Sum').add();\n\n      functions('avg').withLabel('Avg').add();\n\n      functions('count').isAppliedOnField(false).withLabel('Count').add();\n\n      functions('dcount').withLabel('Dcount').add();\n\n      functions('max').withLabel('Max').add();\n\n      functions('min').withLabel('Min').add();\n\n      functions('percentile')\n        .withLabel('Percentile')\n        .withParameter('percentileParam', QueryEditorPropertyType.Number, 'percentile constant')\n        .add();\n    })\n    .withMultipleRows(true)\n    .build()\n);\n\nexport const KustoGroupByEditorSection = buildGroupByQueryEditorSection((groupBySection) =>\n  groupBySection\n    .withIntervals((intervals) => {\n      intervals('$__timeInterval').withLabel('auto').add();\n      intervals('1m').withLabel('1 minute').add();\n\n      intervals('5m').withLabel('5 minutes').add();\n\n      intervals('15m').withLabel('15 minutes').add();\n\n      intervals('30m').withLabel('30 minutes').add();\n\n      intervals('1h').withLabel('1 hour').add();\n\n      intervals('6h').withLabel('6 hours').add();\n\n      intervals('12h').withLabel('12 hours').add();\n\n      intervals('1d').withLabel('1 day').add();\n    })\n    .withMultipleRows(true)\n    .build()\n);\n","import React from 'react';\nimport { QueryEditorFilterSectionProps } from './components/filter/QueryEditorFilterSection';\nimport { QueryEditorFieldSectionProps } from './components/field/QueryEditorFieldSection';\nimport { QueryEditorFieldBuilder } from './builders/QueryEditorFieldBuilder';\nimport { QueryEditorFilterBuilder } from './builders/QueryEditorFilterBuilder';\nimport { QueryEditorReduceSectionProps } from './components/reduce/QueryEditorReduceSection';\nimport { QueryEditorReduceBuilder } from './builders/QueryEditorReduceBuilder';\nimport { QueryEditorGroupBySectionProps } from './components/groupBy/QueryEditorGroupBySection';\nimport { QueryEditorGroupByBuilder } from './builders/QueryEditorGroupByBuilder';\n\nexport const buildFieldQueryEditorSection = (\n  builder: (builder: QueryEditorFieldBuilder) => React.FC<QueryEditorFieldSectionProps>\n): React.FC<QueryEditorFieldSectionProps> => builder(new QueryEditorFieldBuilder());\n\nexport const buildFilterQueryEditorSection = (\n  builder: (builder: QueryEditorFilterBuilder) => React.FC<QueryEditorFilterSectionProps>\n): React.FC<QueryEditorFilterSectionProps> => builder(new QueryEditorFilterBuilder());\n\nexport const buildReduceQueryEditorSection = (\n  builder: (builder: QueryEditorReduceBuilder) => React.FC<QueryEditorReduceSectionProps>\n): React.FC<QueryEditorReduceSectionProps> => builder(new QueryEditorReduceBuilder());\n\nexport const buildGroupByQueryEditorSection = (\n  builder: (builder: QueryEditorGroupByBuilder) => React.FC<QueryEditorGroupBySectionProps>\n): React.FC<QueryEditorGroupBySectionProps> => builder(new QueryEditorGroupByBuilder());\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { getTemplateSrv } from '@grafana/runtime';\nimport { TextArea, useStyles2 } from '@grafana/ui';\nimport {\n  QueryEditorArrayExpression,\n  QueryEditorExpression,\n  QueryEditorExpressionType,\n  QueryEditorOperatorExpression,\n  QueryEditorPropertyExpression,\n} from 'editor/expressions';\nimport React, { useCallback, useMemo } from 'react';\nimport { useAsync } from 'react-use';\nimport { selectors } from 'test/selectors';\n\nimport { QueryEditorResultFormat, selectResultFormat } from '../components/QueryEditorResultFormat';\nimport { SchemaError, SchemaLoading, SchemaWarning } from '../components/SchemaMessages';\nimport { AdxDataSource } from '../datasource';\nimport { definitionToProperty } from '../editor/components/field/QueryEditorField';\nimport { isFieldExpression } from '../editor/guards';\nimport { QueryEditorPropertyDefinition, QueryEditorPropertyType } from '../editor/types';\nimport { AdxSchemaResolver } from '../schema/AdxSchemaResolver';\nimport { columnsToDefinition } from '../schema/mapper';\nimport { AdxColumnSchema, AdxSchema, defaultQuery, KustoQuery } from '../types';\nimport {\n  KustoGroupByEditorSection,\n  KustoPropertyEditorSection,\n  KustoValueColumnEditorSection,\n  KustoWhereEditorSection,\n} from './VisualQueryEditorSections';\n\ninterface Props {\n  database: string;\n  query: KustoQuery;\n  onChangeQuery: (query: KustoQuery) => void;\n  schema?: AdxSchema;\n  datasource: AdxDataSource;\n  templateVariableOptions: SelectableValue<string>;\n}\n\nexport const VisualQueryEditor: React.FC<Props> = (props) => {\n  const { query, database, datasource, schema, onChangeQuery } = props;\n  const { id: datasourceId, parseExpression, autoCompleteQuery, getSchemaMapper } = datasource;\n\n  const resultFormat = selectResultFormat(query.resultFormat);\n  const databaseName = getTemplateSrv().replace(database);\n  const tables = useTableOptions(schema, databaseName, datasource);\n  const table = useSelectedTable(tables, query, datasource);\n  const tableName = getTemplateSrv().replace(table?.property.name ?? '');\n  const tableMapping = getSchemaMapper().getMappingByValue(table?.property.name);\n  const timeshiftOptions = useTimeshiftOptions();\n  const styles = useStyles2(getStyles);\n\n  const tableSchema = useAsync(async () => {\n    if (!table || !table.property) {\n      return [];\n    }\n\n    const name = tableMapping?.value ?? tableName;\n    const schema = await getTableSchema(datasource, databaseName, name);\n    const expression = query.expression ?? defaultQuery.expression;\n    const from = expression.from ?? table;\n\n    onChangeQuery({\n      ...query,\n      query: parseExpression(\n        {\n          ...expression,\n          from,\n        },\n        schema\n      ),\n    });\n\n    return schema;\n  }, [datasourceId, databaseName, tableName, tableMapping?.value]);\n\n  const onAutoComplete = useCallback(\n    async (index: string, search: QueryEditorOperatorExpression) => {\n      const values = await autoCompleteQuery(\n        {\n          search,\n          database: databaseName,\n          expression: query.expression,\n          index,\n        },\n        tableSchema.value\n      );\n\n      return values.map((value) => ({ value, label: value }));\n    },\n    [autoCompleteQuery, databaseName, tableSchema.value, query.expression]\n  );\n\n  const columns = useColumnOptions(tableSchema.value);\n  const groupable = useGroupableColumns(columns);\n  const aggregable = useAggregableColumns(columns);\n\n  const onChangeTable = useCallback(\n    (expression: QueryEditorExpression) => {\n      if (!isFieldExpression(expression) || !table) {\n        return;\n      }\n\n      const next = {\n        ...defaultQuery.expression,\n        from: expression,\n      };\n\n      onChangeQuery({\n        ...query,\n        resultFormat: resultFormat,\n        database: database,\n        expression: next,\n      });\n    },\n    [onChangeQuery, query, resultFormat, database, table]\n  );\n\n  const onWhereChange = useCallback(\n    (expression: QueryEditorArrayExpression) => {\n      const next = {\n        ...query.expression,\n        from: table,\n        where: expression,\n      };\n\n      onChangeQuery({\n        ...query,\n        resultFormat: resultFormat,\n        database: database,\n        expression: next,\n        query: parseExpression(next, tableSchema.value),\n      });\n    },\n    [onChangeQuery, query, tableSchema.value, resultFormat, database, table, parseExpression]\n  );\n\n  const onReduceChange = useCallback(\n    (expression: QueryEditorArrayExpression) => {\n      const next = {\n        ...query.expression,\n        from: table,\n        reduce: expression,\n      };\n\n      onChangeQuery({\n        ...query,\n        resultFormat: resultFormat,\n        database: database,\n        expression: next,\n        query: parseExpression(next, tableSchema.value),\n      });\n    },\n    [onChangeQuery, query, tableSchema.value, resultFormat, database, table, parseExpression]\n  );\n\n  const onGroupByChange = useCallback(\n    (expression: QueryEditorArrayExpression) => {\n      const next = {\n        ...query.expression,\n        from: table,\n        groupBy: expression,\n      };\n\n      onChangeQuery({\n        ...query,\n        resultFormat: resultFormat,\n        database: database,\n        expression: next,\n        query: parseExpression(next, tableSchema.value),\n      });\n    },\n    [onChangeQuery, query, tableSchema.value, resultFormat, database, table, parseExpression]\n  );\n\n  const onChangeResultFormat = useCallback(\n    (format: string) => {\n      const next = {\n        ...query.expression,\n        from: table,\n      };\n\n      onChangeQuery({\n        ...query,\n        expression: next,\n        database: database,\n        resultFormat: format,\n      });\n    },\n    [onChangeQuery, table, database, query]\n  );\n\n  const onChangeTimeshift = useCallback(\n    (expression: QueryEditorExpression) => {\n      if (!isFieldExpression(expression) || !table) {\n        return;\n      }\n\n      const next = {\n        ...defaultQuery.expression,\n        ...query.expression,\n        from: table,\n        timeshift: expression,\n      };\n\n      onChangeQuery({\n        ...query,\n        resultFormat: resultFormat,\n        database: database,\n        expression: next,\n        query: parseExpression(next, tableSchema.value),\n      });\n    },\n    [onChangeQuery, query, resultFormat, database, table, parseExpression, tableSchema.value]\n  );\n\n  const KustoTable = (kustoTableProps: { children?: React.ReactElement }) => (\n    <KustoPropertyEditorSection\n      templateVariableOptions={props.templateVariableOptions}\n      label=\"From\"\n      value={table}\n      fields={tables}\n      onChange={onChangeTable}\n      aria-label={selectors.components.queryEditor.tableFrom.input}\n    >\n      {kustoTableProps.children}\n    </KustoPropertyEditorSection>\n  );\n\n  if (tableSchema.loading) {\n    return (\n      <>\n        <KustoTable />\n        <SchemaLoading />\n      </>\n    );\n  }\n\n  if (tableSchema.error) {\n    return (\n      <>\n        <KustoTable />\n        <SchemaError message={`Could not load table schema: ${tableSchema.error?.message}`} />\n      </>\n    );\n  }\n\n  if (tableSchema.value?.length === 0) {\n    return (\n      <>\n        <KustoTable />\n        <SchemaWarning message=\"Table schema loaded successfully but without any columns\" />\n      </>\n    );\n  }\n\n  return (\n    <>\n      <KustoTable>\n        <QueryEditorResultFormat\n          format={resultFormat}\n          includeAdxTimeFormat={false}\n          onChangeFormat={onChangeResultFormat}\n        />\n      </KustoTable>\n      <KustoWhereEditorSection\n        templateVariableOptions={props.templateVariableOptions}\n        label=\"Where (filter)\"\n        value={query.expression?.where ?? defaultQuery.expression?.where}\n        fields={columns}\n        onChange={onWhereChange}\n        getSuggestions={onAutoComplete}\n      />\n      <KustoValueColumnEditorSection\n        templateVariableOptions={props.templateVariableOptions}\n        label=\"Aggregate\"\n        value={query.expression?.reduce ?? defaultQuery.expression?.reduce}\n        fields={aggregable}\n        onChange={onReduceChange}\n      />\n      <KustoGroupByEditorSection\n        templateVariableOptions={props.templateVariableOptions}\n        label=\"Group by\"\n        value={query.expression?.groupBy ?? defaultQuery.expression?.groupBy}\n        fields={groupable}\n        onChange={onGroupByChange}\n      />\n      <hr />\n      <KustoPropertyEditorSection\n        templateVariableOptions={[]}\n        label=\"Timeshift\"\n        value={query.expression?.timeshift ?? defaultQuery.expression?.timeshift}\n        fields={timeshiftOptions}\n        onChange={onChangeTimeshift}\n        allowCustom={true}\n      />\n      <div className={styles.query}>\n        <TextArea cols={80} rows={8} value={props.query.query} disabled={true} />\n      </div>\n    </>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  query: css`\n    margin-top: 12px;\n  `,\n});\n\nconst useGroupableColumns = (columns: QueryEditorPropertyDefinition[]): QueryEditorPropertyDefinition[] => {\n  return useMemo(() => {\n    return columns.filter((c) => c.type === QueryEditorPropertyType.DateTime || QueryEditorPropertyType.String);\n  }, [columns]);\n};\n\nconst useAggregableColumns = (columns: QueryEditorPropertyDefinition[]): QueryEditorPropertyDefinition[] => {\n  return useMemo(() => {\n    return columns.filter((c) => c.type === QueryEditorPropertyType.DateTime || QueryEditorPropertyType.String);\n  }, [columns]);\n};\n\nconst useColumnOptions = (tableSchema?: AdxColumnSchema[]): QueryEditorPropertyDefinition[] => {\n  return useMemo(() => {\n    if (!tableSchema) {\n      return [];\n    }\n    return columnsToDefinition(tableSchema);\n  }, [tableSchema]);\n};\n\nconst useSelectedTable = (\n  options: QueryEditorPropertyDefinition[],\n  query: KustoQuery,\n  datasource: AdxDataSource\n): QueryEditorPropertyExpression | undefined => {\n  const variables = datasource.getVariables();\n\n  const from = query.expression?.from?.property.name;\n\n  return useMemo(() => {\n    const selected = options.find((option) => option.value === from);\n\n    if (selected) {\n      return {\n        type: QueryEditorExpressionType.Property,\n        property: definitionToProperty(selected),\n      };\n    }\n\n    const variable = variables.find((variable) => variable === from);\n\n    if (variable) {\n      return {\n        type: QueryEditorExpressionType.Property,\n        property: {\n          name: variable,\n          type: QueryEditorPropertyType.String,\n        },\n      };\n    }\n\n    if (options.length > 0) {\n      return {\n        type: QueryEditorExpressionType.Property,\n        property: definitionToProperty(options[0]),\n      };\n    }\n\n    return;\n  }, [options, from, variables]);\n};\n\nconst useTableOptions = (\n  schema: AdxSchema | undefined,\n  database: string,\n  datasource: AdxDataSource\n): QueryEditorPropertyDefinition[] => {\n  const mapper = datasource.getSchemaMapper();\n\n  return useMemo(() => {\n    if (!schema || !schema.Databases) {\n      return [];\n    }\n    return mapper.getTableOptions(schema, database);\n  }, [database, schema, mapper]);\n};\n\nasync function getTableSchema(datasource: AdxDataSource, databaseName: string, tableName: string) {\n  const schemaResolver = new AdxSchemaResolver(datasource);\n  return await schemaResolver.getColumnsForTable(databaseName, tableName);\n}\n\nconst useTimeshiftOptions = (): QueryEditorPropertyDefinition[] => {\n  return useMemo((): QueryEditorPropertyDefinition[] => {\n    return [\n      {\n        label: 'No timeshift',\n        value: '',\n        type: QueryEditorPropertyType.TimeSpan,\n      },\n      {\n        label: 'Hour before',\n        value: '1h',\n        type: QueryEditorPropertyType.TimeSpan,\n      },\n      {\n        label: 'Day before',\n        value: '1d',\n        type: QueryEditorPropertyType.TimeSpan,\n      },\n      {\n        label: 'Week before',\n        value: '7d',\n        type: QueryEditorPropertyType.TimeSpan,\n      },\n    ];\n  }, []);\n};\n","import { PanelData, QueryEditorProps } from '@grafana/data';\nimport { SchemaLoading } from 'components/SchemaMessages';\nimport { migrateQuery, needsToBeMigrated } from 'migrations/query';\nimport React, { useCallback, useEffect, useMemo } from 'react';\nimport { useAsync } from 'react-use';\nimport { AdxDataSourceOptions, AdxSchema, EditorMode, KustoQuery } from 'types';\n\nimport { QueryEditorToolbar } from './QueryEditorToolbar';\nimport { RawQueryEditor } from './RawQueryEditor';\nimport { VisualQueryEditor } from './VisualQueryEditor';\nimport { AdxDataSource } from '../datasource';\nimport { QueryEditorPropertyDefinition } from '../editor/types';\nimport { databaseToDefinition } from '../schema/mapper';\n\ntype Props = QueryEditorProps<AdxDataSource, KustoQuery, AdxDataSourceOptions>;\n\nexport const QueryEditor: React.FC<Props> = (props) => {\n  const { datasource, onChange, onRunQuery, query } = props;\n  const ds = datasource as unknown as AdxDataSource;\n  const executedQuery = useExecutedQuery(props.data);\n  const executedQueryError = useExecutedQueryError(props.data);\n  const dirty = useDirty(props.query.query, executedQuery);\n  const rawMode = isRawMode(props);\n  const schema = useAsync(() => ds.getSchema(false), [datasource.id]);\n  const templateVariables = useTemplateVariables(ds);\n  const databases = useDatabaseOptions(schema.value);\n  const database = useSelectedDatabase(databases, props.query, ds);\n\n  /* eslint-disable react-hooks/exhaustive-deps */\n  useEffect(() => {\n    if (needsToBeMigrated(query)) {\n      onChange(migrateQuery(query));\n      onRunQuery();\n    }\n\n    if (isNewQuery(props) && isRawDefaultEditorMode(props)) {\n      onChange({\n        ...props.query,\n        rawMode: true,\n        querySource: EditorMode.Raw,\n      });\n      onRunQuery();\n    }\n  }, []);\n  /* eslint-enable react-hooks/exhaustive-deps */\n\n  const onChangeDatabase = useCallback(\n    (database: string) => {\n      onChange({\n        ...query,\n        database,\n      });\n    },\n    [onChange, query]\n  );\n\n  const onToggleEditorMode = useCallback(() => {\n    onChange({\n      ...query,\n      rawMode: !rawMode,\n      querySource: rawMode ? EditorMode.Visual : EditorMode.Raw,\n    });\n  }, [onChange, query, rawMode]);\n\n  if (schema.loading) {\n    return <SchemaLoading />;\n  }\n\n  if (schema.error) {\n    if ((schema.error as any)?.data?.Message) {\n      return (\n        <div className=\"gf-form\">\n          <pre className=\"gf-form-pre alert alert-error\">\n            Could not load datasource schema due too: {(schema.error as any)?.data?.Message}\n          </pre>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"gf-form\">\n        <pre className=\"gf-form-pre alert alert-error\">Could not load datasource schema: {String(schema.error)}</pre>\n      </div>\n    );\n  }\n\n  if (databases.length === 0) {\n    return (\n      <div className=\"gf-form\">\n        <pre className=\"gf-form-pre alert alert-warning\">\n          Datasource schema loaded but without any databases and tables, please try again..\n        </pre>\n      </div>\n    );\n  }\n\n  const editorMode = rawMode ? EditorMode.Raw : EditorMode.Visual;\n\n  return (\n    <>\n      {executedQueryError && (\n        <div className=\"gf-form\">\n          <pre className=\"gf-form-pre alert alert-warning\">Failed to execute query: {executedQueryError}</pre>\n        </div>\n      )}\n      <QueryEditorToolbar\n        onRunQuery={props.onRunQuery}\n        onToggleEditorMode={onToggleEditorMode}\n        editorMode={editorMode}\n        onChangeDatabase={onChangeDatabase}\n        database={database}\n        databases={[templateVariables, ...databases]}\n        dirty={dirty}\n      />\n      {editorMode === EditorMode.Raw && (\n        <RawQueryEditor\n          {...props}\n          schema={schema.value}\n          templateVariableOptions={templateVariables}\n          lastQuery={executedQuery}\n          database={database}\n        />\n      )}\n      {editorMode === EditorMode.Visual && (\n        <VisualQueryEditor\n          datasource={ds}\n          database={database}\n          onChangeQuery={props.onChange}\n          query={props.query}\n          schema={schema.value}\n          templateVariableOptions={templateVariables}\n        />\n      )}\n    </>\n  );\n};\n\nconst useSelectedDatabase = (\n  options: QueryEditorPropertyDefinition[],\n  query: KustoQuery,\n  datasource: AdxDataSource\n): string => {\n  const variables = datasource.getVariables();\n\n  return useMemo(() => {\n    const selected = options.find((option) => option.value === query.database);\n\n    if (selected) {\n      return selected.value;\n    }\n\n    const variable = variables.find((variable) => variable === query.database);\n\n    if (variable) {\n      return variable;\n    }\n\n    if (options.length > 0) {\n      return options[0].value;\n    }\n\n    return '';\n  }, [options, variables, query.database]);\n};\n\nconst useDatabaseOptions = (schema?: AdxSchema): QueryEditorPropertyDefinition[] => {\n  return useMemo(() => {\n    const databases: QueryEditorPropertyDefinition[] = [];\n\n    if (!schema || !schema.Databases) {\n      return databases;\n    }\n\n    for (const name of Object.keys(schema.Databases)) {\n      const database = schema.Databases[name];\n      databases.push(databaseToDefinition(database));\n    }\n\n    return databases;\n  }, [schema]);\n};\n\nconst useExecutedQuery = (data?: PanelData): string => {\n  return useMemo(() => {\n    return data?.series[0]?.meta?.executedQueryString ?? '';\n  }, [data]);\n};\n\nconst useDirty = (query: string, executedQuery: string): boolean => {\n  return useMemo(() => {\n    // we need to interpolate/deinterpolate it so we compare same things.\n    return query !== executedQuery;\n  }, [query, executedQuery]);\n};\n\nconst useExecutedQueryError = (data?: PanelData): string | undefined => {\n  return useMemo(() => {\n    return data?.error?.message;\n  }, [data]);\n};\n\nconst useTemplateVariables = (datasource: AdxDataSource) => {\n  const variables = datasource.getVariables();\n\n  return useMemo(() => {\n    return {\n      label: 'Template Variables',\n      expanded: false,\n      options: variables.map((variable) => {\n        return { label: variable, value: variable };\n      }),\n    };\n  }, [variables]);\n};\n\nfunction isRawMode(props: Props): boolean {\n  if (props.query.rawMode === undefined && props.query.query && !props.query.expression?.from) {\n    return true;\n  }\n\n  return props.query.rawMode || false;\n}\n\nfunction isNewQuery(props: Props): boolean {\n  return props.query.rawMode === undefined;\n}\n\nfunction isRawDefaultEditorMode(props: Props): boolean {\n  return (props.datasource as unknown as AdxDataSource).getDefaultEditorMode() === EditorMode.Raw;\n}\n","import { DataSourcePlugin } from '@grafana/data';\nimport ConfigEditor from 'components/ConfigEditor';\n\nimport { AdxDataSource } from './datasource';\nimport { QueryEditor } from './components/QueryEditor';\nimport { AdxDataSourceOptions, AdxDataSourceSecureOptions, KustoQuery } from './types';\n\nexport const plugin = new DataSourcePlugin<AdxDataSource, KustoQuery, AdxDataSourceOptions, AdxDataSourceSecureOptions>(\n  AdxDataSource\n)\n  .setConfigEditor(ConfigEditor)\n  .setQueryEditor(QueryEditor);\n"],"sourceRoot":""}